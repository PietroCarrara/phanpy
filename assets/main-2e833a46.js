import{a as F,s as In,I as w,M as At,b as T,A as zt,h as We,e as pe,E as Ke,c as Rt,L as q,d as Tn,n as Et,f as J,u as Cn,g as Ft,i as ot,j as wt,k as bt,l as Ae,T as Ge,m as vt,o as Je,p as Kt,q as Ye,r as xn,t as Tt,N as ve,R as Se,S as gt,v as $n,w as jt,x as Xe,y as Ze,z as ke,B as St,C as Qe,D as Ln,F as Rn,G as An,H as Me,J as Mn,K as Dn,O as Xt,P as En,Q as De,U as Nn,V as Pn,W as Ee,X as Un,Y as _n}from"./useTitle-16514e6e.js";import{h as C,_ as N,p as _,o as t,k as $,M as Bt,a as Z,b as Ct,S as zn,s as ce,u as xt,F as yt,y as Nt,g as Fn,c as dt,m as Ne,l as Pe,d as tn,e as Bn,J as On,C as en,f as nn,i as sn,T as ae,I as le,j as Ot,n as Mt,q as qn,r as Hn,x as Ie,t as on,v as jn,A as Vn,w as se,z as Wn,B as Ue,D as Kn,E as Gn,R as he,G as rt,H as Jn,K as Yn}from"./vendor-253ca8e5.js";function Te({list:e,onClose:n}){const{masto:l}=F(),[i,o]=C("default"),s=!!e,a=N(),r=N(),h=N();_(()=>{s&&(a.current.value=e.title,r.current.value=e.repliesPolicy,h.current&&(h.current.checked=e.exclusive))},[s]);const d=In("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})})," ",t("header",{children:t("h2",{children:s?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:c=>{c.preventDefault();const f=new FormData(c.target),m=f.get("title"),u=f.get("replies_policy"),p=f.get("exclusive")==="on";o("loading"),(async()=>{try{let g;s?g=await l.v1.lists.update(e.id,{title:m,replies_policy:u,exclusive:p}):g=await l.v1.lists.create({title:m,replies_policy:u,exclusive:p}),o("default"),n==null||n({state:"success",list:g})}catch{o("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:a,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:r,name:"replies_policy",required:!0,disabled:i==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),d&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:h,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:i==="loading",children:s?"Save":"Create"}),s&&t(At,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await l.v1.lists.remove(e.id),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const Xn=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],_e={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"};function cn({account:e,fetchAccount:n=()=>{},standalone:l,instance:i,authenticated:o}){const[s,a]=C("default"),r=typeof e=="string",[h,d]=C(r?null:e);_(()=>{if(!r){d(e);return}a("loading"),(async()=>{try{const K=await n();T.accounts[`${K.id}@${i}`]=K,d(K),a("default")}catch{d(null),a("error")}})()},[r,e,n]);const{acct:c,avatar:f,avatarStatic:m,bot:u,createdAt:p,displayName:g,emojis:b,fields:y,followersCount:k,followingCount:S,group:v,id:L,lastStatusAt:E,locked:x,note:U,statusesCount:G,url:H,username:D,memorial:P}=h||{};let Q=!1,{header:W,headerStatic:ut}=h||{};(!W||/missing\.png$/.test(W))&&f&&!/missing\.png$/.test(f)&&(W=f,Q=!0,m&&!/missing\.png$/.test(m)&&(ut=m));const[lt,tt]=C([]);return t("div",{class:`account-container  ${s==="loading"?"skeleton":""}`,style:{"--header-color-1":lt[0],"--header-color-2":lt[1],"--header-color-3":lt[2],"--header-color-4":lt[3]},children:[s==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:e,target:"_blank",children:["Go to account page ",t(w,{icon:"external"})]})})]}),s==="loading"?t($,{children:[t("header",{children:t(zt,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"████████ ███████"}),t("p",{children:"███████████████ ███████████████"})]}),t("p",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]}),t("div",{children:"Joined ██"})]})]})]}):h&&t($,{children:[W&&!/missing\.png$/.test(W)&&t("img",{src:W,alt:"",class:`header-banner ${Q?"header-is-avatar":""}`,onError:K=>{K.target.crossOrigin?K.target.src!==ut?K.target.src=ut:(K.target.removeAttribute("crossorigin"),K.target.src=W):K.target.src!==ut?K.target.src=ut:K.target.remove()},crossOrigin:"anonymous",onLoad:K=>{K.target.classList.add("loaded");try{const ft=document.createElement("canvas"),at=ft.getContext("2d");ft.width=K.target.width,ft.height=K.target.height,at.drawImage(K.target,0,0);const M=10,ct=[at.getImageData(0,0,M,M).data,at.getImageData(K.target.width-M,0,M,M).data,at.getImageData(0,K.target.height-M,M,M).data,at.getImageData(K.target.width-M,K.target.height-M,M,M).data].map(nt=>{let kt=0,pt=0,O=0,R=0;for(let A=0;A<nt.length;A+=4)kt+=nt[A],pt+=nt[A+1],O+=nt[A+2],R+=nt[A+3];const I=nt.length/4;return[kt/I,pt/I,O/I,R/I]}).map(nt=>{const[kt,pt,O,R]=Qn(nt);return`rgba(${kt}, ${pt}, ${O}, ${R})`});tt(ct)}catch{}}}),t("header",{children:t(zt,{account:h,instance:i,avatarSize:"xxxl",external:l,internal:!l})}),t("main",{tabIndex:"-1",children:[!!P&&t("span",{class:"tag",children:"In Memoriam"}),!!u&&t("span",{class:"tag",children:[t(w,{icon:"bot"})," Automated"]}),!!v&&t("span",{class:"tag",children:[t(w,{icon:"group"})," Group"]}),t("div",{class:"note",onClick:We({instance:i}),dangerouslySetInnerHTML:{__html:pe(U,{emojis:b})}}),(y==null?void 0:y.length)>0&&t("div",{class:"profile-metadata",children:y.map(({name:K,value:ft,verifiedAt:at},M)=>t("div",{class:`profile-field ${at?"profile-verified":""}`,children:[t("b",{children:[t(Ke,{text:K,emojis:b})," ",!!at&&t(w,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:pe(ft,{emojis:b})}})]},K+M))}),t("p",{class:"stats",children:[t("div",{children:[t("span",{title:k,children:Rt(k)})," ","Followers"]}),t("div",{class:"insignificant",children:[t("span",{title:S,children:Rt(S)})," ","Following",t("br",{})]}),l?t("div",{class:"insignificant",children:[t("span",{title:G,children:Rt(G)})," ","Posts"]}):t(q,{class:"insignificant",to:i?`/${i}/a/${L}`:`/a/${L}`,onClick:()=>{Tn()},children:[t("span",{title:G,children:Rt(G)})," ","Posts"]}),!!p&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:p,children:Et(p,{hideTime:!0})})]})]}),t(Zn,{info:h,instance:i,authenticated:o})]})]})]})}function Zn({info:e,instance:n,authenticated:l}){var O;if(!e)return null;const{masto:i,instance:o,authenticated:s}=F(),a=n===o,[r,h]=C("default"),[d,c]=C(null),[f,m]=C([]),{id:u,acct:p,url:g,username:b,locked:y,lastStatusAt:k,note:S,fields:v}=e,L=N(u),{following:E,showingReblogs:x,notifying:U,followedBy:G,blocking:H,blockedBy:D,muting:P,mutingNotifications:Q,requested:W,domainBlocking:ut,endorsed:lt}=d||{},[tt,K]=C(null),[ft,at]=C(!1);_(()=>{if(e){const R=J.session.get("currentAccount");let I;(async()=>{if(a&&l)I=u;else if(!a&&s){const Y=e.acct.includes("@");try{const X=await i.v2.search({q:Y?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});X.accounts.length&&(I=X.accounts[0].id,K(X.accounts[0]))}catch{}}if(!I)return;if(R===I){at(!0);return}L.current=I,h("loading"),m([]);const A=i.v1.accounts.fetchRelationships([I]),B=i.v1.accounts.fetchFamiliarFollowers(I);try{const Y=await A;if(Y.length){const X=Y[0];if(c(X),!X.following)try{const j=await B;m(j[0].accounts.slice(0,10))}catch{}}h("default")}catch{h("error")}})()}},[e,l]),_(()=>{e&&ft&&Cn(e)},[e,ft]);const M=r==="loading",et=N(null),[ct,nt]=C(!1),[kt,pt]=C(!1);return t($,{children:[t("div",{class:"common-followers shazam-container no-animation",hidden:!(f!=null&&f.length),children:t("div",{class:"shazam-container-inner",children:t("p",{children:["Followed by"," ",t("span",{class:"ib",children:f.map(R=>t("a",{href:R.url,rel:"noopener noreferrer",onClick:I=>{I.preventDefault(),T.showAccount={account:R,instance:n}},children:t(Ft,{url:R.avatarStatic,size:"l",alt:`${R.displayName} @${R.acct}`,squircle:R==null?void 0:R.bot})}))})]})})}),t("p",{class:"actions",children:[t("span",{children:[G?t("span",{class:"tag",children:"Following you"}):k?t("small",{class:"insignificant",children:["Last post:"," ",Et(k,{hideTime:!0})]}):t("span",{}),P&&t("span",{class:"tag danger",children:"Muted"}),H&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[t(Bt,{instanceRef:et,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:R=>{var I,A;R.target===R.currentTarget&&((A=(I=et.current)==null?void 0:I.closeMenu)==null||A.call(I))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:M,children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[s&&!ft&&t($,{children:[t(Z,{onClick:()=>{T.showCompose={draftStatus:{status:`@${(tt==null?void 0:tt.acct)||p} `}}},children:[t(w,{icon:"at"}),t("span",{children:["Mention @",b]})]}),t(Z,{onClick:()=>{nt(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate bio"})]}),E&&t(Z,{onClick:()=>{pt(!0)},children:[t(w,{icon:"list"}),t("span",{children:"Add/remove from Lists"})]}),t(Ct,{})]}),t(Z,{href:g,target:"_blank",children:[t(w,{icon:"external"}),t("small",{class:"menu-double-lines",children:ts(g)})]}),t("div",{class:"menu-horizontal",children:[t(Z,{onClick:()=>{try{navigator.clipboard.writeText(g),ot("Link copied")}catch{ot("Unable to copy link")}},children:[t(w,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((O=navigator==null?void 0:navigator.canShare)==null?void 0:O.call(navigator,{url:g}))&&t(Z,{onClick:()=>{try{navigator.share({url:g})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!d&&t($,{children:[t(Ct,{}),P?t(Z,{onClick:()=>{h("loading"),(async()=>{try{const R=await i.v1.accounts.unmute((tt==null?void 0:tt.id)||u);c(R),h("default"),ot(`Unmuted @${b}`)}catch{h("error")}})()},children:[t(w,{icon:"unmute"}),t("span",{children:["Unmute @",b]})]}):t(zn,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t($,{children:[t(w,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",b,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(w,{icon:"time"}),t(w,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:Xn.map(R=>t(Z,{onClick:()=>{h("loading"),(async()=>{try{const I=await i.v1.accounts.mute((tt==null?void 0:tt.id)||u,{duration:R});c(I),h("default"),ot(`Muted @${b} for ${_e[R]}`)}catch{h("error"),ot(`Unable to mute @${b}`)}})()},children:_e[R]}))})}),t(At,{subMenu:!0,confirm:!H,confirmLabel:t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",b,"?"]})]}),menuItemClassName:"danger",onClick:()=>{h("loading"),(async()=>{try{if(H){const R=await i.v1.accounts.unblock((tt==null?void 0:tt.id)||u);c(R),h("default"),ot(`Unblocked @${b}`)}else{const R=await i.v1.accounts.block((tt==null?void 0:tt.id)||u);c(R),h("default"),ot(`Blocked @${b}`)}}catch{h("error"),H?ot(`Unable to unblock @${b}`):ot(`Unable to block @${b}`)}})()},children:H?t($,{children:[t(w,{icon:"unblock"}),t("span",{children:["Unblock @",b]})]}):t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",b,"…"]})]})})]})]}),!d&&r==="loading"&&t(wt,{abrupt:!0}),!!d&&t(At,{confirm:E||W,confirmLabel:t("span",{children:W?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:M,onClick:()=>{h("loading"),(async()=>{try{let R;E||W?R=await i.v1.accounts.unfollow(L.current):R=await i.v1.accounts.follow(L.current),R&&c(R),h("default")}catch(R){alert(R),h("error")}})()},children:t("button",{type:"button",class:`${E||W?"light swap":""}`,"data-swap-state":E||W?"danger":"",disabled:M,children:E?t($,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):W?t($,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):y?t($,{children:[t(w,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!ct&&t(bt,{class:"light",onClick:R=>{R.target===R.currentTarget&&nt(!1)},children:t(es,{note:S,fields:v,onClose:()=>nt(!1)})}),!!kt&&t(bt,{class:"light",onClick:R=>{R.target===R.currentTarget&&pt(!1)},children:t(ns,{accountID:L.current,onClose:()=>pt(!1)})})]})}function Qn([e,n,l]){const i=.2126*e+.7152*n+.0722*l;let o;return i>=220?o=1:i<=50?o=.1:o=i/255,o=Math.min(1,o),[e,n,l,o]}function ts(e){if(!e)return;const n=new URL(e),{host:l,pathname:i}=n,o=i.replace(/\/$/,"").replace(/^\//,"");return t($,{children:[t("span",{class:"more-insignificant",children:[l,"/"]}),t("wbr",{}),t("span",{children:o})]})}function es({note:e,fields:n,onClose:l}){const i=(n==null?void 0:n.map(({name:s,value:a})=>`${s}
${Ae(a)}`).join(`

`))||"",o=Ae(e)+(i?`

${i}`:"");return t("div",{class:"sheet",children:[!!l&&t("button",{type:"button",class:"sheet-close",onClick:l,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:o}),t(Ge,{forceTranslate:!0,text:o})]})]})}function ns({accountID:e,onClose:n}){const{masto:l}=F(),[i,o]=C("default"),[s,a]=C([]),[r,h]=C([]),[d,c]=ce(u=>u+1,0);_(()=>{o("loading"),(async()=>{try{const u=await l.v1.lists.list(),p=await l.v1.accounts.listLists(e);a(u),h(p),o("default")}catch{o("error")}})()},[d]);const[f,m]=C(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[s.length>0?t("ul",{class:"list-add-remove",children:s.map(u=>{const p=r.some(g=>g.id===u.id);return t("li",{children:t("button",{type:"button",class:`light ${p?"checked":""}`,disabled:i==="loading",onClick:()=>{o("loading"),(async()=>{try{p?await l.v1.lists.removeAccount(u.id,{accountIds:[e]}):await l.v1.lists.addAccount(u.id,{accountIds:[e]}),c()}catch{o("error"),alert(p?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(w,{icon:"check-circle"}),t("span",{children:u.title})]})})})}):i==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):i==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>m(!0),disabled:i!=="default",children:[t(w,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),f&&t(bt,{class:"light",onClick:u=>{u.target===u.currentTarget&&m(!1)},children:t(Te,{list:f==null?void 0:f.list,onClose:u=>{u.state==="success"&&c(),m(!1)}})})]})}function ss({account:e,instance:n,onClose:l}){const{masto:i,instance:o,authenticated:s}=F({instance:n}),a=typeof e=="string",r=xt("esc",l,[l]);return _(()=>{a||(T.accounts[`${e.id}@${o}`]=e)},[e]),t("div",{ref:r,class:"sheet",onClick:h=>{h.target.closest(".account-block")&&l({destination:"account-statuses"})},children:[!!l&&t("button",{type:"button",class:"sheet-close outer",onClick:l,children:t(w,{icon:"x"})}),t(cn,{instance:o,authenticated:s,account:e,fetchAccount:async()=>{if(a)try{return await i.v1.accounts.lookup({acct:e,skip_webfinger:!1})}catch{const d=await i.v2.search({q:e,type:"accounts",limit:1,resolve:s});if(d.accounts.length)return d.accounts[0]}else return e}})]})}function ie(e=()=>{},n=[]){const l=N(e);_(()=>{l.current=e},[n]),_(()=>{const i=()=>{const o=document.hidden||document.visibilityState==="hidden";l.current(!o)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}function is({isLoggedIn:e}){const[n,l]=C(!0);ie(l);const i=N();_(()=>{if(e&&n){const{masto:a,instance:r}=F();(async()=>{if(T.notificationsLast){const h=a.v1.notifications.list({limit:1,since_id:T.notificationsLast.id}),{value:d}=await h.next();d!=null&&d.length&&(T.notificationsShowNew=!0)}i.current=await a.ws.stream("/api/v1/streaming",{stream:"user:notification"}),i.current.on("notification",h=>{h.status&&vt(h.status,r,{skipThreading:!0}),T.notificationsShowNew=!0}),i.current.ws.onclose=()=>{}})()}return()=>{i.current&&(i.current.ws.close(),i.current=null)}},[n,e]);const o=N(),s=()=>{o.current=Date.now(),fetch("./version.json").then(a=>a.json()).then(a=>{a&&(T.appVersion=a)}).catch(a=>{})};return Je(s,n&&1e3*60*30),ie(a=>{a&&(o.current?Date.now()-o.current>1e3*60*60&&s():s())}),null}function os({onClose:e}){const{masto:n}=F(),[l,i]=C("default"),[o,s]=C([]),[a,r]=ce(d=>d+1,0);_(()=>{i("loading"),(async()=>{try{const d=await Kt.drafts.keys();if(d.length){const c=Ye(),f=d.filter(m=>m.startsWith(c));if(f.length){const m=await Kt.drafts.getMany(f);m.sort((u,p)=>new Date(p.updatedAt).getTime()-new Date(u.updatedAt).getTime()),s(m)}else s([])}else s([]);i("default")}catch{i("error")}})()},[a]);const h=(o==null?void 0:o.length)>0;return t("div",{class:"sheet",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:[t("h2",{children:["Unsent drafts ",t(wt,{abrupt:!0,hidden:l!=="loading"})]}),h&&t("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),t("main",{children:h?t($,{children:[t("ul",{class:"drafts-list",children:o.map(d=>{const{updatedAt:c,key:f,draftStatus:m,replyTo:u}=d,p=new Date(c);return t("li",{children:[t("div",{class:"mini-draft-meta",children:[t("b",{children:[t(w,{icon:u?"reply":"quill",size:"s"})," ",t("time",{children:[!!u&&t($,{children:["@",u.account.acct,t("br",{})]}),Et(p)]})]}),t(At,{confirmLabel:t("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:l==="loading",onClick:()=>{(async()=>{try{await Kt.drafts.del(f),r()}catch{alert("Error deleting draft! Please try again.")}})()},children:t("button",{type:"button",class:"small light",disabled:l==="loading",children:"Delete…"})})]}),t("button",{type:"button",disabled:l==="loading",class:"draft-item",onClick:async()=>{let g;if(u){i("loading");try{g=await n.v1.statuses.fetch(u.id)}catch{alert("Error fetching reply-to status!"),i("default");return}i("default")}window.__COMPOSE__={draftStatus:m,replyToStatus:g},T.showCompose=!0,T.showDrafts=!1},children:t(cs,{draft:d})})]},c)})}),o.length>1&&t("p",{children:t(At,{confirmLabel:t("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:l==="loading",onClick:()=>{(async()=>{i("loading");try{await Kt.drafts.delMany(o.map(d=>d.key)),i("default"),r()}catch{alert("Error deleting drafts! Please try again."),i("error")}})()},children:t("button",{type:"button",class:"light danger",disabled:l==="loading",children:"Delete all…"})})})]}):t("p",{children:"No drafts found."})})]})}function cs({draft:e}){var f;const{draftStatus:n,replyTo:l}=e,{status:i,spoilerText:o,poll:s,mediaAttachments:a}=n,r=((f=s==null?void 0:s.options)==null?void 0:f.length)>0,h=(a==null?void 0:a.length)>0,d=r||h,c=yt(()=>{if(!h)return;const m=a.find(g=>/image/.test(g.type));if(!m)return;const{file:u}=m;return URL.createObjectURL(u)},[h,a]);return t($,{children:t("div",{class:"mini-draft",children:[d&&t("div",{class:`mini-draft-aside ${c?"has-image":""}`,style:c?{"--bg-image":`url(${c})`}:{},children:[r&&t(w,{icon:"poll"}),h&&t("span",{children:[t(w,{icon:"attachment"})," ",t("small",{children:a==null?void 0:a.length})]})]}),t("div",{class:"mini-draft-main",children:[!!o&&t("div",{class:"mini-draft-spoiler",children:o}),!!i&&t("div",{class:"mini-draft-status",children:i})]})]})})}function an({mediaAttachments:e,statusID:n,instance:l,index:i=0,onClose:o=()=>{}}){var p,g;const s=N(null),[a,r]=C(i),h=N(null);Nt(()=>{var b;(b=h.current)==null||b.scrollIntoView()},[]);const d=N(n);_(()=>{const b=i*s.current.clientWidth,y=d.current!==n;y&&(d.current=n),s.current.scrollTo({left:b,behavior:y?"auto":"smooth"}),s.current.focus()},[i,n]);const[c,f]=C(!0);_(()=>{let b=()=>{o()};return s.current&&s.current.addEventListener("swiped-down",b),()=>{s.current&&s.current.removeEventListener("swiped-down",b)}},[]),xt("esc",o,[o]);const[m,u]=C(!1);return _(()=>{let b=()=>{const{clientWidth:y,scrollLeft:k}=s.current,S=Math.round(k/y);r(S)};return s.current&&s.current.addEventListener("scroll",b,{passive:!0}),()=>{s.current&&s.current.removeEventListener("scroll",b)}},[]),_(()=>{let b=setTimeout(()=>{var y,k;(k=(y=s.current)==null?void 0:y.focus)==null||k.call(y)},100);return()=>clearTimeout(b)},[]),t("div",{class:"media-modal-container",children:[t("div",{ref:s,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:b=>{(b.target.classList.contains("carousel-item")||b.target.classList.contains("media")||b.target.classList.contains("media-zoom"))&&o()},children:e==null?void 0:e.map((b,y)=>{const{blurhash:k}=b,S=k?Fn(k):null;return t("div",{class:"carousel-item",style:{"--average-color":`rgb(${S==null?void 0:S.join(",")})`,"--average-color-alpha":`rgba(${S==null?void 0:S.join(",")}, .5)`},tabindex:"0",ref:y===a?h:null,onClick:v=>{v.target!==v.currentTarget&&f(!c)},children:[!!b.description&&t("button",{type:"button",class:"media-alt",hidden:!c,onClick:()=>{u(b.description)},children:[t(w,{icon:"info"}),t("span",{class:"media-alt-desc",children:b.description})]}),t(xn,{media:b,showOriginal:!0})]},b.id)})}),t("div",{class:"carousel-top-controls",hidden:!c,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>o(),children:t(w,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((b,y)=>t("button",{type:"button",disabled:y===a,class:`carousel-dot ${y===a?"active":""}`,onClick:k=>{k.preventDefault(),k.stopPropagation(),s.current.scrollTo({left:s.current.clientWidth*y,behavior:"smooth"}),s.current.focus()},children:t(w,{icon:"round",size:"s"})},b.id))}):t("span",{}),t("span",{children:[t(Bt,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(w,{icon:"more",alt:"More"})}),children:t(Tt,{href:((p=e[a])==null?void 0:p.remoteUrl)||((g=e[a])==null?void 0:g.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(w,{icon:"popout"}),t("span",{children:"Open original media"})]})})," ",t(q,{to:`${l?`/${l}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${a+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!c,children:[t("button",{type:"button",class:"carousel-button",hidden:a===0,onClick:b=>{b.preventDefault(),b.stopPropagation(),s.current.focus(),s.current.scrollTo({left:s.current.clientWidth*(a-1),behavior:"smooth"})},children:t(w,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:a===e.length-1,onClick:b=>{b.preventDefault(),b.stopPropagation(),s.current.focus(),s.current.scrollTo({left:s.current.clientWidth*(a+1),behavior:"smooth"})},children:t(w,{icon:"arrow-right"})})]}),!!m&&t(bt,{class:"light",onClick:b=>{b.target===b.currentTarget&&(u(!1),s.current.focus())},children:t(as,{alt:m,onClose:()=>u(!1)})})]})}function as({alt:e,onClose:n}){const[l,i]=C(!1);return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close outer",onClick:n,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:[t("h2",{children:"Media description"}),t("div",{class:"header-side",children:t(Bt,{align:"end",menuButton:t("button",{type:"button",class:"plain4",children:t(w,{icon:"more",alt:"More",size:"xl"})}),children:t(Z,{disabled:l,onClick:()=>{i(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate"})]})})})]}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:e}),l&&t(Ge,{forceTranslate:l,text:e})]})]})}function me({accountID:e,onChange:n}){const{masto:l}=F(),[i,o]=C("default"),[s,a]=C(null),[r,h]=C(null),d=r!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:i==="loading",onClick:()=>{o("loading"),a("accept"),(async()=>{try{const c=await l.v1.followRequests.authorize(e);if(!(c!=null&&c.followedBy))throw new Error("Follow request not accepted");h(c),n()}catch{}o("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:i==="loading",class:"light danger",onClick:()=>{o("loading"),a("reject"),(async()=>{try{const c=await l.v1.followRequests.reject(e);if(c!=null&&c.followedBy)throw new Error("Follow request not rejected");h(c),n()}catch{o("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:d&&s?s==="accept"?t(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(wt,{hidden:i!=="loading"})})]})}const ze={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil"},Wt={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":e=>`favourited ${e} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":e=>`boosted & favourited ${e} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply."};function Ce({notification:e,instance:n,reload:l,isStatic:i}){var S,v,L,E;const{id:o,status:s,account:a,_accounts:r,_statuses:h}=e;let{type:d}=e;const c=(s==null?void 0:s.reblog)||s,f=c==null?void 0:c.id,m=J.session.get("currentAccount"),u=m===(a==null?void 0:a.id),p=(S=s==null?void 0:s.poll)==null?void 0:S.voted,g=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==m&&((v=s==null?void 0:s.account)==null?void 0:v.id)===m;let b=0,y=0;if(d==="favourite+reblog"){for(const x of r)(L=x._types)!=null&&L.includes("favourite")&&b++,(E=x._types)!=null&&E.includes("reblog")&&y++;!y&&b&&(d="favourite"),!b&&y&&(d="reblog")}let k;return d==="poll"?k=Wt[u?"poll-self":p?"poll-voted":"poll"]:d==="reblog"||d==="favourite"||d==="favourite+reblog"?(h==null?void 0:h.length)>1?k=Wt[`${d}+account`]:g?k=Wt[`${d}_reply`]:k=Wt[d]:k=Wt[d],typeof k=="function"&&(k=k((h==null?void 0:h.length)||(r==null?void 0:r.length))),d==="mention"&&!s?null:t("div",{class:`notification notification-${d}`,tabIndex:"0",children:[t("div",{class:`notification-type notification-${d}`,title:new Date(e.createdAt).toLocaleString(),children:d==="favourite+reblog"?t($,{children:[t(w,{icon:"rocket",size:"xl",alt:d,class:"reblog-icon"}),t(w,{icon:"heart",size:"xl",alt:d,class:"favourite-icon"})]}):t(w,{icon:ze[d]||"notification",size:"xl",alt:d})}),t("div",{class:"notification-content",children:[d!=="mention"&&t($,{children:[t("p",{children:[!/poll|update/i.test(d)&&t($,{children:(r==null?void 0:r.length)>1?t($,{children:[t("b",{children:[r.length," people"]})," "]}):t($,{children:[t(ve,{account:a,showAvatar:!0})," "]})}),k,d==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(Se,{datetime:e.createdAt,format:"micro"})]})]}),d==="follow_request"&&t(me,{accountID:a.id,onChange:()=>{}})]}),(r==null?void 0:r.length)>1&&t("p",{class:"avatars-stack",children:r.map((x,U)=>t($,{children:[t("a",{href:x.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:G=>{G.preventDefault(),T.showAccount=x},children:[t(Ft,{url:x.avatarStatic,size:r.length<=10?"xxl":r.length<100?"xl":r.length<1e3?"l":r.length<2e3?"m":"s",alt:`${x.displayName} @${x.acct}`,squircle:x==null?void 0:x.bot},x.id),d==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:x._types.map(G=>t(w,{icon:ze[G],size:"s",class:`${G}-icon`}))})]})," "]}))}),(h==null?void 0:h.length)>1&&t("ul",{class:"notification-group-statuses",children:h.map(x=>t("li",{children:t(q,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${x.id}`:`/s/${x.id}`,children:t(gt,{status:x,size:"s"})})},x.id))}),s&&(!(h!=null&&h.length)||(h==null?void 0:h.length)<=1)&&t(q,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${f}`:`/s/${f}`,children:i?t(gt,{status:c,size:"s"}):t(gt,{statusID:f,size:"s"})})]})]})}function ls(){if(!("serviceWorker"in navigator))return null;const e=dt(T),{routeNotification:n}=e,{id:l,accessToken:i}=n||{},[o,s]=C(!1);Nt(()=>{if(!l||!i)return;const{instance:r}=F(),{masto:h,instance:d}=F({accessToken:i}),c=r===d,f=i?$n(i):jt();(async()=>{const m=await h.v1.notifications.fetch(l);if(m&&f){const u=f.instanceURL,{type:p,status:g,account:b}=m,y=!!document.querySelector("#modal-container > *"),k=p==="follow"&&!!(b!=null&&b.id),S=!!(b!=null&&b.id),v=!!(g!=null&&g.id);k&&c?T.showAccount={account:b,instance:u}:y||!c||S&&v?s({id:l,account:f,notification:m,sameInstance:c}):v?location.hash=`/${r}/s/${g.id}`:k?location.hash=`/${r}/a/${b.id}`:location.hash="/notifications"}})()},[l,i]),Nt(()=>{const r=h=>{const{type:d,id:c,accessToken:f}=(h==null?void 0:h.data)||{};d==="notification"&&(T.routeNotification={id:c,accessToken:f})};return navigator.serviceWorker.addEventListener("message",r),()=>{navigator.serviceWorker.removeEventListener("message",r)}},[]),ie(r=>{r&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const a=()=>{s(!1),T.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(o){const{id:r,account:h,notification:d,sameInstance:c}=o;return t(bt,{class:"light",onClick:f=>{f.target===f.currentTarget&&a()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:a,children:t(w,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!c&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:f=>{const{target:m}=f;(f.target.tagName==="BUTTON"||f.target.tagName==="A")&&a()},children:t(Ce,{instance:h.instanceURL,notification:d,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(q,{to:"/notifications",class:"button light",children:[t("span",{children:"View all notifications"})," ",t(w,{icon:"arrow-right"})]})})]})]})})}return null}const rs=""+new URL("floating-button-ef345856.svg",import.meta.url).href,ds=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,us=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function ge({children:e}){if(typeof e=="string")return e;const[n,l]=C("");return _(()=>{Promise.resolve(e).then(l)},[e]),n}const Ht=9,hs=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],ln={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},te={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},oe={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Ne(async({id:e})=>(await F().masto.v1.lists.fetch(e)).title,{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||F().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||F().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e,path:({query:e})=>`/search?q=${e}`,icon:"search"},"account-statuses":{id:"account-statuses",title:Ne(async({id:e})=>{const n=await F().masto.v1.accounts.fetch(e);return n.username||n.acct||n.displayName},{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||F().instance,path:({hashtag:e,instance:n})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}`,icon:"hashtag"}};function fs({onClose:e}){const n=dt(T),{masto:l}=F(),{shortcuts:i}=n,[o,s]=C([]),[a,r]=C([]),[h,d]=C(!1),[c,f]=C(!1);return _(()=>{(async()=>{try{const m=await l.v1.lists.list();s(m)}catch{}})(),(async()=>{try{const m=l.v1.followedTags.list(),u=[];do{const{value:p,done:g}=await m.next();if(g||(p==null?void 0:p.length)===0)break;u.push(...p)}while(!0);r(u)}catch{}})()},[]),t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[t(w,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:["Specify a list of shortcuts that'll appear as:",t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:rs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:us},{value:"multi-column",label:"Multi-column",imgURL:ds}].map(({value:m,label:u,imgURL:p})=>t("label",{children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:m,checked:n.settings.shortcutsViewMode===m||m==="float-button"&&!n.settings.shortcutsViewMode,onChange:g=>{T.settings.shortcutsViewMode=g.target.value}})," ",t("img",{src:p,alt:"",width:"80",height:"58"})," ",t("span",{children:u})]}))})]}),i.length>0?t("ol",{class:"shortcuts-list",children:i.filter(Boolean).map((m,u)=>{const p=u+Object.values(m),{type:g}=m;if(!oe[g])return null;let{icon:b,title:y,subtitle:k}=oe[g];return typeof y=="function"&&(y=y(m,u)),typeof k=="function"&&(k=k(m,u)),typeof b=="function"&&(b=b(m,u)),t("li",{children:[t(w,{icon:b}),t("span",{class:"shortcut-text",children:[t(ge,{children:y}),k&&t($,{children:[" ",t("small",{class:"ib insignificant",children:k})]})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:u===0,onClick:()=>{const S=Array.from(T.shortcuts);if(u>0){const v=T.shortcuts[u-1];S[u-1]=m,S[u]=v,T.shortcuts=S}},children:t(w,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:u===i.length-1,onClick:()=>{const S=Array.from(T.shortcuts);if(u<T.shortcuts.length-1){const v=T.shortcuts[u+1];S[u+1]=m,S[u]=v,T.shortcuts=S}},children:t(w,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{d({shortcut:m,shortcutIndex:u})},children:t(w,{icon:"pencil",alt:"Edit"})})]})]},p)})}):t("div",{class:"ui-state insignificant",children:[t("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:m=>{m.preventDefault(),T.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:i.length>=Ht&&`Max ${Ht} shortcuts`}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>f(!0),children:"Import/export"}),t("button",{type:"button",disabled:i.length>=Ht,onClick:()=>d(!0),children:[t(w,{icon:"plus"})," ",t("span",{children:"Add shortcut"})]})]})]}),h&&t(bt,{class:"light",onClick:m=>{m.target===m.currentTarget&&d(!1)},children:t(ps,{shortcut:h.shortcut,shortcutIndex:h.shortcutIndex,lists:o,followedHashtags:a,onSubmit:({result:m,mode:u})=>{u==="edit"?T.shortcuts[h.shortcutIndex]=m:T.shortcuts.push(m)},onClose:()=>d(!1)})}),c&&t(bt,{class:"light",onClick:m=>{m.target===m.currentTarget&&f(!1)},children:t(ms,{shortcuts:i,onClose:()=>f(!1)})})]})}function ps({lists:e,followedHashtags:n,onSubmit:l,disabled:i,shortcut:o,shortcutIndex:s,onClose:a}){var f,m;const r=!!o,[h,d]=C((o==null?void 0:o.type)||null),c=N();return _(()=>{if(r&&h&&te[h]){const u=c.current;te[h].forEach(({name:p,type:g})=>{const b=u.querySelector(`[name="${p}"]`);b&&o[p]&&(g==="checkbox"?b.checked=o[p]==="on":b.value=o[p])})}},[r,h]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!a&&t("button",{type:"button",class:"sheet-close",onClick:a,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[r?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:c,onSubmit:u=>{u.preventDefault();const p=new FormData(u.target),g={};p.forEach((b,y)=>{g[y]=b==null?void 0:b.trim(),y==="instance"&&(g[y]=g[y].replace(/^https?:\/\//,"").replace(/\/+$/,""),g[y]=g[y].replace(/^@?[^@]+@/,""))}),g.type&&(l({result:g,mode:r?"edit":"add"}),u.target.reset(),d(null),a==null||a())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:i,onChange:u=>{d(u.target.value)},defaultValue:r?o.type:void 0,name:"type",children:[t("option",{}),hs.map(u=>t("option",{value:u,children:ln[u]}))]})]})}),(m=(f=te[h])==null?void 0:f.map)==null?void 0:m.call(f,({text:u,name:p,type:g,placeholder:b,pattern:y,notRequired:k})=>h==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!k,disabled:i,children:e.map(S=>t("option",{value:S.id,children:S.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:u})," ",t("input",{type:g,name:p,placeholder:b,required:g==="text"&&!k,disabled:i,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:y}),h==="hashtag"&&n.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:n.map(S=>t("option",{value:S.name}))})]})})),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:i,children:r?"Save":"Add"}),r&&t("button",{type:"button",class:"light danger",onClick:()=>{T.shortcuts.splice(s,1),a==null||a()},children:"Remove"})]})]})})]})}function ms({shortcuts:e,onClose:n}){var d;const l=yt(()=>!e||!e.filter(Boolean).length?"":Pe.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[i,o]=C(""),[s,a]=C("default"),r=yt(()=>{if(!i)return a("default"),null;try{const c=JSON.parse(Pe.decompressFromEncodedURIComponent(i));if(!Array.isArray(c))throw new Error("Not an array");return a("default"),c}catch{try{const f=JSON.parse(i);if(!Array.isArray(f))throw new Error("Not an array");return a("default"),f}catch{return a("error"),null}}},[i]),h=T.shortcuts.length>0;return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{children:t("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:c=>{o(c.target.value)}})}),!!r&&Array.isArray(r)&&t($,{children:[t("p",{children:[t("b",{children:r.length})," shortcut",r.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",i.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:r.map(c=>{var f,m;return t("li",{children:[t("span",{style:{opacity:e.some(u=>Object.keys(u).every(p=>u[p]===c[p]))?1:0},children:"*"}),t("span",{children:[ln[c.type],c.type==="list"&&" ⚠️"," ",(m=(f=te[c.type])==null?void 0:f.map)==null?void 0:m.call(f,({text:u,name:p,type:g})=>c[p]?t($,{children:[t("span",{class:"tag collapsed insignificant",children:[u,":"," ",g==="checkbox"?c[p]==="on"?"✅":"❌":c[p]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[h&&t($,{children:[t(At,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const c=r.filter(u=>!T.shortcuts.some(p=>Object.keys(p).every(g=>p[g]===u[g])));if(!c.length){ot("No new shortcuts to import");return}let f=[...T.shortcuts,...c];const m=f.length>Ht;m&&(f=f.slice(0,Ht)),T.shortcuts=f,ot(m?`Shortcuts imported. Exceeded max ${Ht}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!r,children:"Import & append…"})})," "]}),t(At,{confirmLabel:h?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:h?"danger":void 0,onClick:()=>{T.shortcuts=r,ot("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!r,children:h?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:l,readOnly:!0,onClick:c=>{if(c.target.value){c.target.select();try{navigator.clipboard.writeText(c.target.value),ot("Shortcuts copied")}catch{ot("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!l,onClick:()=>{try{navigator.clipboard.writeText(l),ot("Shortcut settings copied")}catch{ot("Unable to copy shortcut settings")}},children:[t(w,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:l}))&&t("button",{type:"button",class:"plain2",disabled:!l,onClick:()=>{try{navigator.share({text:l})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"})," ",t("span",{children:"Share"})]})," ",l.length>0&&t("small",{class:"insignificant",children:[l.length," characters"]})]}),!!l&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]})]})]})}function gs(){const{instance:e}=F(),n=dt(T),{shortcuts:l}=n;if(!l.length)return null;const i=N(),o=yt(()=>l.map((a,r)=>{const{type:h,...d}=a;if(!oe[h])return null;let{id:c,path:f,title:m,subtitle:u,icon:p}=oe[h];return typeof c=="function"&&(c=c(d,r)),typeof f=="function"&&(f=f({...d,instance:d.instance||e},r)),typeof m=="function"&&(m=m(d,r)),typeof u=="function"&&(u=u(d,r)),typeof p=="function"&&(p=p(d,r)),{id:c,path:f,title:m,subtitle:u,icon:p}}).filter(Boolean),[l]),s=tn();return xt(["1","2","3","4","5","6","7","8","9"],(a,r)=>{var d,c;const h=parseInt(r.keys[0],10)-1;if(h<o.length){const{path:f}=o[h];f&&(s(f),(c=(d=i.current)==null?void 0:d.closeMenu)==null||c.call(d))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",children:t("ul",{children:o.map(({id:a,path:r,title:h,subtitle:d,icon:c},f)=>t("li",{children:t(q,{class:d?"has-subtitle":"",to:r,onClick:m=>{if(m.target.classList.contains("is-active")){m.preventDefault();const u=document.getElementById(`${a}-page`);if(u){u.scrollTop=0;const p=u.querySelector(".updates-button");p&&p.click()}}},children:[t(w,{icon:c,size:"xl",alt:h}),t("span",{children:[t(ge,{children:h}),d&&t($,{children:[t("br",{}),t("small",{children:d})]})]})]})},f+h))})}):t(Bt,{instanceRef:i,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:a=>{var r,h;try{const{target:d}=a;getComputedStyle(d).pointerEvents==="none"&&((h=(r=i.current)==null?void 0:r.closeMenu)==null||h.call(r))}catch{}},children:t(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:o.map(({path:a,title:r,subtitle:h,icon:d},c)=>t(Tt,{to:a,class:"glass-menu-item",children:[t(w,{icon:d,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(ge,{children:r})}),h&&t($,{children:[" ",t("small",{class:"more-insignificant",children:h})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:c+1})]},c+r))})})}function Jt(e){const{containerProps:n}=e,l=Bn(),i=N();return t(Bt,{boundingBoxPadding:Xe(),repositionFlag:`${l.width}x${l.height}`,...e,instanceRef:i,containerProps:{onClick:o=>{var s,a,r;o.target===o.currentTarget&&((a=(s=i.current)==null?void 0:s.closeMenu)==null||a.call(s)),(r=n==null?void 0:n.onClick)==null||r.call(n,o)},...n}})}function bs(e){var o;let n=[],l=[],i=0;for(let s=0;s<e.length;s++){const a=e[s];a.reblog&&!((o=a.account)!=null&&o.group)?(l.push(a),i++):(n.push(a),i<3&&(i=0))}if(e.length>10&&(l.length>e.length/4||i>=3)){const s=l.map(a=>a.id);if(l.length>e.length*3/4)n=[...n,{id:s,items:l,type:"boosts"}];else{const a=Math.floor(n.length/2);n=[...n.slice(0,a),{id:s,items:l,type:"boosts"},...n.slice(a)]}return n}else return e}function Fe(e,n){const l=J.account.get("boostedStatusIDs")||{},i=e.filter(s=>{if(!s.reblog)return!0;const a=`${n}-${s.reblog.id}`,r=l[a];return r&&r!==s.id?!1:(l[a]=s.id,!0)}),o=Object.keys(l);return o.length>50&&o.slice(0,o.length-50).forEach(s=>{delete l[s]}),J.account.set("boostedStatusIDs",l),i}function ys(e){const n=[];let l=0;e.forEach(s=>{for(let r=0;r<n.length;r++){if(n[r].find(h=>h.id===s.id))return;if(n[r].find(h=>h.id===s.inReplyToId)||n[r].find(h=>h.inReplyToId===s.id)){n[r].push(s);return}}const a=e.find(r=>r.id===s.inReplyToId);a&&(n[l++]=[s,a])});for(let s=0;s<n.length;s++)for(let a=s+1;a<n.length;a++)n[s].find(h=>n[a].includes(h))&&(n[s]=[...n[s],...n[a]],n[s]=n[s].filter((h,d,c)=>c.findIndex(f=>f.id===h.id)===d),n.splice(a,1),a--);n.forEach(s=>{s.sort((a,r)=>!a.inReplyToId&&!r.inReplyToId?new Date(a.createdAt)-new Date(r.createdAt):a.inReplyToId===r.id?1:r.inReplyToId===a.id||!a.inReplyToId?-1:r.inReplyToId?new Date(a.createdAt)-new Date(r.createdAt):1)}),n.forEach(s=>{const a=s[0].account.id;s.forEach(r=>{r.account.id!==a&&(r._differentAuthor=!0)})}),n.length;const i=[],o=[];return e.forEach(s=>{if(s.reblog){i.push(s);return}for(let a=0;a<n.length;a++)if(n[a].find(r=>r.id===s.id)){if(o.includes(a))return;const r=n[a];r.sort((d,c)=>{const f=new Date(d.createdAt),m=new Date(c.createdAt);return f-m});const h=r[0].account.id;i.push({id:r.map(d=>d.id),items:r,type:r.every(d=>d.account.id===h)?"thread":"conversation"}),o.push(a);return}i.push(s)}),i}function re({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:l=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:s="vertical",distanceFromStartPx:a,distanceFromEndPx:r}={}){const[h,d]=C(null),[c,f]=C(!1),[m,u]=C(!1),[p,g]=C(!1),[b,y]=C(!1),k=s==="vertical";return Nt(()=>{const S=e.current;if(!S)return{};let v=k?S.scrollTop:S.scrollLeft;function L(){const{scrollTop:E,scrollLeft:x,scrollHeight:U,scrollWidth:G,clientHeight:H,clientWidth:D}=S,P=k?E:x,Q=k?U:G,W=k?H:D,ut=Math.abs(P-v),lt=a||Math.min(W*n,Q,P),tt=r||Math.min(W*l,Q,Q-P-W);ut>=(v<P?o:i)&&(d(v<P?"end":"start"),v=P),f(P<=0),u(P+W>=Q),g(P<=lt),y(P+W>=Q-tt)}return S.addEventListener("scroll",L,{passive:!0}),()=>S.removeEventListener("scroll",L)},[n,l,i,o]),{scrollDirection:h,reachStart:c,reachEnd:m,nearReachStart:p,nearReachEnd:b,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function Yt(e){var p,g,b,y,k;const n=dt(T),{instance:l,authenticated:i}=F(),[o,s]=C(),[a,r]=C(!1);_(()=>{const S=J.local.getJSON("accounts")||[],v=S.find(L=>L.info.id===J.session.get("currentAccount"));v&&s(v),r(S.length>1)},[]);const h=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(S=>S.type==="following"),d=On(()=>{T.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),c=N(),[f,m]=C(void 0),u=Xe([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]);return t($,{children:[t("button",{ref:c,type:"button",class:`button plain nav-menu-button ${a?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{m(S=>S?void 0:"open")},onContextMenu:S=>{S.preventDefault(),T.showAccounts=!0},...d(),children:[a&&t(Ft,{url:((p=o==null?void 0:o.info)==null?void 0:p.avatar)||((g=o==null?void 0:o.info)==null?void 0:g.avatarStatic),size:"l",squircle:(b=o==null?void 0:o.info)==null?void 0:b.bot}),t(w,{icon:"menu",size:a?"s":"l"})]}),t(en,{menuClassName:"nav-menu",state:f,anchorRef:c,onClose:()=>{m(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{m(void 0)}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:u,unmountOnClose:!0,children:[!!((y=n.appVersion)!=null&&y.commitHash)&&n.appVersion.commitHash!=="cdef3b9"&&t("div",{class:"top-menu",children:[t(Z,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(Ct,{})]}),t("section",{children:[t(Tt,{to:"/",children:[t(w,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),i&&t($,{children:[h&&t(Tt,{to:"/following",children:[t(w,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(Tt,{to:"/mentions",children:[t(w,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(Tt,{to:"/notifications",children:[t(w,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(Ct,{}),t(Tt,{to:"/l",children:[t(w,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(Tt,{to:"/ft",children:[t(w,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(Tt,{to:"/b",children:[t(w,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(Tt,{to:"/f",children:[t(w,{icon:"heart",size:"l"})," ",t("span",{children:"Favourites"})]})]}),t(Ct,{}),t(Tt,{to:"/search",children:[t(w,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(Tt,{to:`/${l}/p/l`,children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Local"})]}),t(Tt,{to:`/${l}/p`,children:[t(w,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),t(Tt,{to:`/${l}/trending`,children:[t(w,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]})]}),t("section",{children:i?t($,{children:[t(Ct,{}),((k=o==null?void 0:o.info)==null?void 0:k.id)&&t(Tt,{to:`/${l}/a/${o.info.id}`,children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Z,{onClick:()=>{T.showAccounts=!0},children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]}),t(Z,{onClick:()=>{T.showShortcutsSettings=!0},children:[t(w,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts Settings…"})]}),t(Z,{onClick:()=>{T.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t($,{children:[t(Ct,{}),t(Tt,{to:"/login",children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})})]})]})}function Dt({title:e,titleComponent:n,id:l,instance:i,emptyText:o,errorText:s,useItemID:a,boostsCarousel:r,fetchItems:h=()=>{},checkForUpdates:d=()=>{},checkForUpdatesInterval:c=6e4,headerStart:f,headerEnd:m,timelineStart:u,allowFilters:p,refresh:g}){const b=dt(T),[y,k]=C([]),[S,v]=C("default"),[L,E]=C(!1),[x,U]=C(!1),[G,H]=C(!0),D=N(),P=nn(O=>{U(!1),S!=="loading"&&(v("loading"),(async()=>{try{let{done:R,value:I}=await h(O);Array.isArray(I)?(r&&(I=bs(I)),I=ys(I),k(O?I:A=>[...A,...I]),I.length||(R=!0),E(!R)):E(!1),v("default")}catch{v("error")}finally{P.cancel()}})())},1500,{leading:!0,trailing:!1}),Q=".timeline-item, .timeline-item-alt",W=xt("j, shift+j",(O,R)=>{var Y,X;const I=document.activeElement.closest(Q),A=I==null?void 0:I.getBoundingClientRect(),B=Array.from(D.current.querySelectorAll(Q));if(I&&A.top<D.current.clientHeight&&A.bottom>0){const j=B.indexOf(I);let z=B[j+1];R.shift&&(z=B.find((st,Lt)=>Lt>j&&!st.classList.contains("timeline-item-alt"))),z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=B.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),ut=xt("k, shift+k",(O,R)=>{var Y,X;const I=document.activeElement.closest(Q),A=I==null?void 0:I.getBoundingClientRect(),B=Array.from(D.current.querySelectorAll(Q));if(I&&A.top<D.current.clientHeight&&A.bottom>0){const j=B.indexOf(I);let z=B[j-1];R.shift&&(z=B.findLast((st,Lt)=>Lt<j&&!st.classList.contains("timeline-item-alt"))),z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=B.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),lt=xt(["enter","o"],()=>{const O=document.activeElement.closest(Q);O&&O.click()}),{scrollDirection:tt,nearReachStart:K,nearReachEnd:ft,reachStart:at,reachEnd:M}=re({scrollableRef:D,distanceFromEnd:2,scrollThresholdStart:44});_(()=>{var O;(O=D.current)==null||O.scrollTo({top:0}),P(!0)},[]),_(()=>{P(!0)},[g]),_(()=>{at&&P(!0)},[at]),_(()=>{(ft||M&&L)&&P()},[ft,L]);const et=N(!1),ct=sn(5e3),nt=ae(async({disableHoverCheck:O=!1}={})=>{b.settings.autoRefresh&&D.current.scrollTop===0&&(O||ct)&&!Ss()?P(!0):await d()&&U(!0)},[l,ct,P,d,b.settings.autoRefresh]),kt=N();ie(O=>{if(O){const R=Date.now()-kt.current;(!kt.current||R>1e3*60)&&nt({disableHoverCheck:!0})}else kt.current=Date.now();H(O)},[d,nt,b.settings.autoRefresh]),Je(nt,G&&!x?c:null);const pt=tt==="end"&&!K;return t("div",{id:`${l}-page`,class:"deck-container",ref:O=>{D.current=O,W.current=O,ut.current=O,lt.current=O},tabIndex:"-1",onPointerEnter:O=>{et.current=!0},onPointerLeave:()=>{et.current=!1},children:t("div",{class:"timeline-deck deck",children:[t("header",{hidden:pt,onClick:O=>{var R;O.target.closest("a, button")||(R=D.current)==null||R.scrollTo({top:0,behavior:"smooth"})},onDblClick:O=>{O.target.closest("a, button")||P(!0)},class:S==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),f??t(q,{to:"/",class:"button plain home-button",children:t(w,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!m&&m})]}),y.length>0&&S!=="loading"&&!pt&&x&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var O;P(!0),(O=D.current)==null||O.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New posts"]})]}),!!u&&t("div",{class:"timeline-start",children:u}),y.length?t($,{children:[t("ul",{class:"timeline",children:[y.map(O=>{const{id:R,reblog:I,items:A,type:B,_pinned:Y}=O,X=(I==null?void 0:I.id)||R,j=i?`/${i}/s/${X}`:`/s/${X}`;let z="";B==="boosts"?z=`${A.length} Boosts`:B==="pinned"&&(z="Pinned posts");const st=B==="boosts"||B==="pinned";if(A){if(st)return A.sort((it,ht)=>it._filtered&&!ht._filtered?1:!it._filtered&&ht._filtered?-1:0),t("li",{class:"timeline-item-carousel",children:t(ws,{title:z,class:`${B}-carousel`,children:A.map(it=>{const{id:ht,reblog:It}=it,$t=(It==null?void 0:It.id)||ht,Ut=i?`/${i}/s/${$t}`:`/s/${$t}`;return t("li",{children:t(q,{class:"status-carousel-link timeline-item-alt",to:Ut,children:a?t(gt,{statusID:ht,instance:i,size:"s",contentTextWeight:!0}):t(gt,{status:it,instance:i,size:"s",contentTextWeight:!0})})},ht)})})},`timeline-${R}`);const Lt=A.length>3;return A.map((it,ht)=>{const{id:It,_differentAuthor:$t}=it,Ut=i?`/${i}/s/${It}`:`/s/${It}`,ue=ht>0&&ht<A.length-1,Vt=it.sensitive&&!!it.spoilerText&&ht>0||Lt&&ue&&B==="thread";return t("li",{class:`timeline-item-container timeline-item-container-type-${B} timeline-item-container-${ht===0?"start":ht===A.length-1?"end":"middle"} ${$t?"timeline-item-diff-author":""}`,children:t(q,{class:"status-link timeline-item",to:Ut,children:Vt?t(vs,{status:it,instance:i}):a?t(gt,{statusID:It,instance:i,allowFilters:p}):t(gt,{status:it,instance:i,allowFilters:p})})},`timeline-${It}`)})}return t("li",{children:t(q,{class:"status-link timeline-item",to:j,children:a?t(gt,{statusID:R,instance:i,allowFilters:p}):t(gt,{status:O,instance:i,allowFilters:p})})},`timeline-${R+Y}`)}),L&&S==="loading"&&t($,{children:[t("li",{style:{height:"20vh"},children:t(gt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(gt,{skeleton:!0})})]})]}),S==="default"&&(L?t(le,{onChange:O=>{O&&P()},children:t("button",{type:"button",class:"plain block",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):S==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((O,R)=>t("li",{children:t(gt,{skeleton:!0})},R))}):S!=="error"&&t("p",{class:"ui-state",children:o}),S==="error"&&t("p",{class:"ui-state",children:[s,t("br",{}),t("br",{}),t("button",{class:"button plain",onClick:()=>P(!y.length),children:"Try again"})]})]})})}function ws({title:e,class:n,children:l}){const i=N(),{reachStart:o,reachEnd:s,init:a}=re({scrollableRef:i,direction:"horizontal"});return _(()=>{a==null||a()},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{type:"button",class:"small plain2",disabled:o,onClick:()=>{var r,h;(h=i.current)==null||h.scrollBy({left:-Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-left"})})," ",t("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var r,h;(h=i.current)==null||h.scrollBy({left:Math.min(320,(r=i.current)==null?void 0:r.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-right"})})]})]}),t("ul",{ref:i,children:l})]})}function vs({status:e,instance:n}){const l=dt(T),{id:i}=e,o=Ze(e),s=ke(i,n);return t("article",{class:"status compact-thread",tabindex:"-1",children:[l.statusThreadNumber[s]?t("div",{class:"status-thread-badge",children:[t(w,{icon:"thread",size:"s"}),l.statusThreadNumber[s]?` ${l.statusThreadNumber[s]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(w,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:o,children:[o,e.sensitive&&e.spoilerText&&t($,{children:[" ",t("span",{class:"spoiler-badge",children:t(w,{icon:"eye-close",size:"s"})})]})]})]})}function Ss(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const ks=20;function Is(){const e=dt(T),{id:n,...l}=Ot(),[i,o]=Mt(),s=!i.get("replies"),a=!!i.get("boosts"),r=i.get("tagged"),h=!!i.get("media"),{masto:d,instance:c,authenticated:f}=F({instance:l.instance}),m=N();async function u(H){const D=[];if(H){const{value:W}=await d.v1.accounts.listStatuses(n,{pinned:!0}).next();if(W!=null&&W.length&&!r&&!h)if(W.forEach(ut=>{ut._pinned=!0,vt(ut,c)}),W.length>=3){const ut=W.map(lt=>lt.id);D.push({id:ut,items:W,type:"pinned"})}else D.push(...W)}(H||!m.current)&&(m.current=d.v1.accounts.listStatuses(n,{limit:ks,exclude_replies:s,exclude_reblogs:a,only_media:h,tagged:r}));const{value:P,done:Q}=await m.current.next();return P!=null&&P.length&&(D.push(...P),P.forEach(W=>{vt(W,c)})),{value:D,done:Q}}const[p,g]=C(),[b,y]=C([]);St(`${p!=null&&p.displayName?p.displayName+" ":""}@${p!=null&&p.acct?p.acct:"Account posts"}`,"/:instance?/a/:id"),_(()=>{(async()=>{try{const H=await d.v1.accounts.fetch(n);g(H)}catch{}try{const H=await d.v1.accounts.listFeaturedTags(n);y(H)}catch{}})()},[n]);const{displayName:k,acct:S,emojis:v}=p||{},L=N(),E=yt(()=>{const H=e.accounts[`${n}@${c}`],D=!s||a||r||h;return t($,{children:[t(cn,{instance:c,account:H||n,fetchAccount:()=>d.v1.accounts.fetch(n),authenticated:f,standalone:!0}),t("div",{class:"filter-bar",ref:L,children:[D?t(q,{to:`/${c}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(w,{icon:"x",size:"l"})}):t(w,{icon:"filter",class:"insignificant",size:"l"}),t(q,{to:`/${c}/a/${n}${s?"?replies=1":""}`,onClick:()=>{s&&ot("Showing post with replies")},class:s?"":"is-active",children:"+ Replies"}),t(q,{to:`/${c}/a/${n}${a?"":"?boosts=0"}`,onClick:()=>{a||ot("Showing posts without boosts")},class:a?"is-active":"",children:"- Boosts"}),t(q,{to:`/${c}/a/${n}${h?"":"?media=1"}`,onClick:()=>{h||ot("Showing posts with media")},class:h?"is-active":"",children:"Media"}),b.map(P=>t(q,{to:`/${c}/a/${n}${r===P.name?"":`?tagged=${encodeURIComponent(P.name)}`}`,onClick:()=>{r!==P.name&&ot(`Showing posts tagged with #${P.name}`)},class:r===P.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),P.name]})}))]})]})},[n,c,f,s,a,b,r,h]);_(()=>{var D;const H=(D=L.current)==null?void 0:D.querySelector(".is-active");H&&L.current.scrollTo({behavior:"smooth",left:H.offsetLeft-(L.current.offsetWidth-H.offsetWidth)/2})},[b,r,h,s,a]);const x=yt(()=>p!=null&&p.url?new URL(p.url).hostname:null,[p]),G=!!p&&!(c===x);return t(Dt,{title:`${p!=null&&p.acct?"@"+p.acct:"Posts"}`,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:t(Ke,{text:k,emojis:v})}),t("div",{children:t("span",{children:["@",S]})})]}),id:"account-statuses",instance:c,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:u,useItemID:!0,boostsCarousel:e.settings.boostsCarousel,timelineStart:E,refresh:s+a+r+h,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{disabled:!G,onClick:()=>{(async()=>{try{const{masto:H}=F({instance:x}),D=await H.v1.accounts.lookup({acct:p.acct}),{id:P}=D;location.hash=`/${x}/a/${P}`}catch{alert("Unable to fetch account info")}})()},children:[t(w,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:x}),")"]})]})})},n)}function Ts({onClose:e}){const{masto:n}=F(),l=J.local.getJSON("accounts"),i=J.session.get("currentAccount"),o=l.length>1,[s,a]=C(0),[r,h]=ce(d=>d+1,0);return t("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:t("h2",{children:"Accounts"})}),t("main",{children:t("section",{children:[t("ul",{class:"accounts-list",children:l.map((d,c)=>{const f=d.info.id===i,m=c===(s||0);return t("li",{children:[t("div",{children:[o&&t("span",{class:`current ${f?"is-current":""}`,children:t(w,{icon:"check-circle",alt:"Current"})}),t(Ft,{url:d.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(f)try{const u=await n.v1.accounts.fetch(d.info.id);d.info=u,J.local.setJSON("accounts",l),h()}catch{}}}),t(ve,{account:o?{...d.info,acct:/@/.test(d.info.acct)?d.info.acct:`${d.info.acct}@${d.instanceURL}`}:d.info,showAcct:!0,onClick:()=>{f?T.showAccount=`${d.info.username}@${d.instanceURL}`:(J.session.set("currentAccount",d.info.id),location.reload())}})]}),t("div",{class:"actions",children:[m&&o&&t($,{children:[t("span",{class:"tag",children:"Default"})," "]}),t(Bt,{align:"end",menuButton:t("button",{type:"button",title:"More",class:"plain more-button",children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[t(Z,{onClick:()=>{T.showAccount=`${d.info.username}@${d.instanceURL}`},children:[t(w,{icon:"user"}),t("span",{children:"View profile…"})]}),t(Ct,{}),o&&t(Z,{disabled:m,onClick:()=>{l.splice(c,1),l.unshift(d),J.local.setJSON("accounts",l),a(c)},children:[t(w,{icon:"check-circle"}),t("span",{children:"Set as default"})]}),t(At,{subMenu:!0,confirmLabel:t($,{children:[t(w,{icon:"exit"}),t("span",{children:["Log out @",d.info.acct,"?"]})]}),disabled:!f,menuItemClassName:"danger",onClick:()=>{l.splice(c,1),J.local.setJSON("accounts",l),location.href=location.pathname||"/"},children:[t(w,{icon:"exit"}),t("span",{children:"Log out…"})]})]})]})]},c+d.id)})}),t("p",{children:t(q,{to:"/login",class:"button plain2",onClick:e,children:[t(w,{icon:"plus"})," ",t("span",{children:"Add an existing account"})]})}),o&&t("p",{children:t("small",{children:["Note: ",t("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const Cs=20;function rn(){St("Bookmarks","/b");const{masto:e,instance:n}=F(),l=N();async function i(o){return(o||!l.current)&&(l.current=e.v1.bookmarks.list({limit:Cs})),await l.current.next()}return t(Dt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const xs=20;function dn(){St("Favourites","/f");const{masto:e,instance:n}=F(),l=N();async function i(o){return(o||!l.current)&&(l.current=e.v1.favourites.list({limit:xs})),await l.current.next()}return t(Dt,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:i})}const $s=200;function Ls(){const{masto:e,instance:n}=F();St("Followed Hashtags","/ft");const[l,i]=C("default"),[o,s]=C([]);return _(()=>{i("loading"),(async()=>{try{const a=e.v1.followedTags.list({limit:$s}),r=[];do{const{value:h,done:d}=await a.next();if(d||(h==null?void 0:h.length)===0)break;r.push(...h)}while(!0);r.sort((h,d)=>h.name.localeCompare(d.name)),s(r),i("default")}catch{i("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),t(q,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:o.length>0?t("ul",{class:"link-list",children:o.map(a=>t("li",{children:t(q,{to:n?`/${n}/t/${a.name}`:`/t/${a.name}`,children:[t(w,{icon:"hashtag"})," ",t("span",{children:a.name})]})}))}):l==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):l==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function Rs(e,n,l){var h;const{filtered:i}=e;if(!(i!=null&&i.length)||l&&((h=e.account)==null?void 0:h.id)===l)return!0;const s=i.filter(d=>{const{filter:c}=d,f=c.context.includes(n);return f?c.expiresAt?new Date(c.expiresAt)>new Date:f:!1});if(!s.length)return!0;if(s.some(d=>d.filter.filterAction==="hide"))return!1;const r=s.some(d=>d.filter.filterAction==="warn");if(r){const d=s.map(c=>c.filter.title);e._filtered={titles:d,titlesStr:d.join(" • ")}}return r}function Pt(e,n){if(!(e!=null&&e.length))return[];if(!n)return e;const l=J.session.get("currentAccount");return e.filter(i=>Rs(i,n,l))}const As=20;function xe({title:e,path:n,id:l,...i}){St(e||"Following",n||"/following");const{masto:o,instance:s}=F(),a=dt(T),r=N(),h=N();async function d(u){(u||!r.current)&&(r.current=o.v1.timelines.listHome({limit:As}));const p=await r.current.next();let{value:g}=p;return g!=null&&g.length&&(u&&(h.current=g[0].id),g=Pt(g,"home"),g.forEach(b=>{vt(b,s)}),g=Fe(g,s),g.sort((b,y)=>{const k=new Date(b.createdAt);return new Date(y.createdAt)-k})),{...p,value:g}}async function c(){try{const u=await o.v1.timelines.listHome({limit:5,since_id:h.current}).next();let{value:p}=u;return!!(p!=null&&p.length&&(h.current=p[0].id,p=Fe(p,s),p=Pt(p,"home"),p.some(g=>!g.reblog)))}catch{return!1}}const f=N(),m=async()=>{if(f.current&&(f.current.readyState===WebSocket.CONNECTING||f.current.readyState===WebSocket.OPEN))return;const u=await o.v1.stream.streamUser();return f.current=u.ws,f.current.__id=Math.random(),u.on("status.update",p=>{vt(p,s)}),u.on("delete",p=>{const g=Qe(p,s);g&&(g._deleted=!0)}),u.ws.onclose=()=>{},u};return _(()=>{let u;return(async()=>u=await m())(),()=>{u&&(u.ws.close(),f.current=null)}},[]),t(Dt,{title:e||"Following",id:l||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:s,fetchItems:d,checkForUpdates:c,useItemID:!0,boostsCarousel:a.settings.boostsCarousel,...i,allowFilters:!0})}const Ms=20,Ds=4,Be=Ds+1;function un({columnMode:e,...n}){let{hashtag:l,...i}=e?{}:Ot();n.hashtag&&(l=n.hashtag);let o=l.trim().split(/[\s+]+/);o.sort(),l=o[0];const{masto:s,instance:a,authenticated:r}=F({instance:(n==null?void 0:n.instance)||i.instance}),{authenticated:h}=F(),d=o.map(v=>`#${v}`).join(" "),c=a?`${d} on ${a}`:d;St(c,"/:instance?/t/:hashtag");const f=N(),m=N(void 0);async function u(v){const L=await s.v1.timelines.listHashtag(l,{limit:Ms,any:o.slice(1),maxId:v?void 0:m.current}).next(),{value:E}=L;return E!=null&&E.length&&(v&&(f.current=E[0].id),E.forEach(x=>{vt(x,a)}),m.current=E[E.length-1].id),{...L,value:E}}async function p(){try{const v=await s.v1.timelines.listHashtag(l,{limit:1,any:o.slice(1),since_id:f.current}).next(),{value:L}=v;return!!(L!=null&&L.length)}catch{return!1}}const[g,b]=C("default"),[y,k]=C();_(()=>{(async()=>{try{const v=await s.v1.tags.fetch(l);k(v)}catch{}})()},[l]);const S=o.length>=Be;return t(Dt,{title:c,titleComponent:!!a&&t("h1",{class:"header-account",children:[t("b",{children:d}),t("div",{children:a})]}),id:"hashtag",instance:a,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:u,checkForUpdates:p,useItemID:!0,headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[!!y&&o.length===1&&t($,{children:[t(At,{subMenu:!0,confirm:y.following,confirmLabel:`Unfollow #${l}?`,disabled:g==="loading"||!r,onClick:()=>{b("loading"),y.following?s.v1.tags.unfollow(l).then(()=>{k({...y,following:!1}),ot(`Unfollowed #${l}`)}).catch(v=>{alert(v)}).finally(()=>{b("default")}):s.v1.tags.follow(l).then(()=>{k({...y,following:!0}),ot(`Followed #${l}`)}).catch(v=>{alert(v)}).finally(()=>{b("default")})},children:y.following?t($,{children:[t(w,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t($,{children:[t(w,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(Ct,{})]}),t(qn,{className:"menu-field",disabled:S,children:({ref:v})=>t("form",{onSubmit:L=>{var x,U;L.preventDefault();const E=(U=(x=L.target[0].value)==null?void 0:x.trim)==null?void 0:U.call(x);E&&!o.some(G=>G.toLowerCase()===E.toLowerCase())&&(o.push(E),o.sort(),location.hash=a?`/${a}/t/${o.join("+")}`:`/t/${o.join("+")}`)},children:[t(w,{icon:"hashtag"}),t("input",{ref:v,type:"text",placeholder:S?`Max ${Be} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:S})]})}),t(Hn,{takeOverflow:!0,children:o.map((v,L)=>t(Z,{disabled:o.length===1,onClick:E=>{o.splice(L,1),o.sort(),navigate(a?`/${a}/t/${o.join("+")}`:`/t/${o.join("+")}`)},children:[t(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),v]})]},v))}),t(Ct,{}),t(Z,{disabled:!h,onClick:()=>{const v={type:"hashtag",hashtag:o.join(" "),instance:a};T.shortcuts.some(E=>E.type===v.type&&E.hashtag.split(/[\s+]+/).sort().join(" ")===v.hashtag.split(/[\s+]+/).sort().join(" ")&&(E.instance?E.instance===v.instance:!0))?alert("This shortcut already exists"):(T.shortcuts.push(v),ot("Hashtag shortcut added"))},children:[t(w,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(Z,{onClick:()=>{let v=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(v)){v&&alert("Invalid instance");return}v&&(v=v.toLowerCase().trim(),navigate(`/${v}/t/${o.join("+")}`))},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},a+d)}const Es=20;function hn(e){var g;const n=dt(T),{masto:l,instance:i}=F(),o=(e==null?void 0:e.id)||((g=Ot())==null?void 0:g.id),s=N(),a=N();async function r(b){(b||!a.current)&&(a.current=l.v1.timelines.listList(o,{limit:Es}));const y=await a.current.next();let{value:k}=y;return k!=null&&k.length&&(b&&(s.current=k[0].id),k=Pt(k,"home"),k.forEach(S=>{vt(S,i)})),{...y,value:k}}async function h(){try{const b=await l.v1.timelines.listList(o,{limit:1,since_id:s.current});let{value:y}=b;return y=Pt(y,"home"),!!(y!=null&&y.length)}catch{return!1}}const[d,c]=C({title:"List"});St(d.title,"/l/:id"),_(()=>{(async()=>{try{const b=await l.v1.lists.fetch(o);c(b)}catch{}})()},[o]);const[f,m]=C(!1),[u,p]=C(!1);return t($,{children:[t(Dt,{title:d.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:r,checkForUpdates:h,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:t(q,{to:"/l",class:"button plain",children:t(w,{icon:"list",size:"l"})}),headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{onClick:()=>m({list:d}),children:[t(w,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(Z,{onClick:()=>p(!0),children:[t(w,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},o),f&&t(bt,{class:"light",onClick:b=>{b.target===b.currentTarget&&m(!1)},children:t(Te,{list:f==null?void 0:f.list,onClose:b=>{b.state==="success"&&b.list?c(b.list):b.state==="deleted"&&(location.hash="/l"),m(!1)}})}),u&&t(bt,{class:"light",onClick:b=>{b.target===b.currentTarget&&p(!1)},children:t(Ps,{listID:o,onClose:()=>p(!1)})})]})}const Ns=40;function Ps({listID:e,onClose:n}){const{masto:l,instance:i}=F(),[o,s]=C([]),[a,r]=C("default"),[h,d]=C(!1),c=N();async function f(m){d(!1),r("loading"),(async()=>{try{(m||!c.current)&&(c.current=l.v1.lists.listAccounts(e,{limit:Ns}));const u=await c.current.next();let{done:p,value:g}=u;g!=null&&g.length?(s(m?g:o.concat(g)),d(!p)):d(!1),r("default")}catch{r("error")}})()}return _(()=>{f(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[o.map(m=>t("li",{children:[t(zt,{account:m,instance:i}),t(Us,{account:m,listID:e})]},m.id)),h&&a==="default"&&t(le,{as:"li",onChange:m=>m&&f(),children:t("button",{type:"button",class:"light block",onClick:f,children:"Show more…"})})]})})]})}function Us({account:e,listID:n}){const{masto:l}=F(),[i,o]=C("default"),[s,a]=C(!1);return t(At,{confirm:!s,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(o("loading"),(async()=>{try{await l.v1.lists.addAccount(n,{accountIds:[e.id]}),o("default"),a(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await l.v1.lists.removeAccount(n,{accountIds:[e.id]}),o("default"),a(!0)}catch{o("error")}})())},children:t("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:i==="loading",children:s?"Add":"Remove…"})})}const Oe=20,_s=new URLSearchParams;function fn({columnMode:e,...n}){St("Mentions","/mentions");const{masto:l,instance:i}=F(),[o]=e?[_s]:Mt(),[s,a]=C(null),r=(n==null?void 0:n.type)||o.get("type")||s,h=N(),d=N();async function c(y){(y||!h.current)&&(h.current=l.v1.notifications.list({limit:Oe,types:["mention"]}));const k=await h.current.next();let{value:S}=k;return S!=null&&S.length&&(y&&(d.current=S[0].id),S.forEach(({status:v})=>{vt(v,i)})),{...k,value:S==null?void 0:S.map(v=>v.status)}}const f=N(),m=N();async function u(y){(y||!f.current)&&(f.current=l.v1.conversations.list({limit:Oe}));const k=await f.current.next();let{value:S}=k;return S=S==null?void 0:S.filter(v=>v.lastStatus),S!=null&&S.length&&(y&&(m.current=S[0].lastStatus.id),S.forEach(({lastStatus:v})=>{vt(v,i)})),{...k,value:S==null?void 0:S.map(v=>v.lastStatus)}}function p(...y){return r==="private"?u(...y):c(...y)}async function g(){if(r==="private")try{const y=await l.v1.conversations.list({limit:1,since_id:m.current}).next();let{value:k}=y;return k!=null&&k.length?(m.current=k[0].lastStatus.id,!0):!1}catch{return!1}else try{const y=await l.v1.notifications.list({limit:1,types:["mention"],since_id:d.current}).next();let{value:k}=y;return k!=null&&k.length?(d.current=k[0].id,!0):!1}catch{return!1}}const b=yt(()=>t("div",{class:"filter-bar centered",children:[t(q,{to:"/mentions",class:r?"":"is-active",onClick:y=>{e&&(y.preventDefault(),a(null))},children:"All"}),t(q,{to:"/mentions?type=private",class:r==="private"?"is-active":"",onClick:y=>{e&&(y.preventDefault(),a("private"))},children:"Private"})]}),[r]);return t(Dt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:p,checkForUpdates:g,useItemID:!0,timelineStart:b,refresh:r})}function pn(e){const n={},l=[];for(let s=0,a=0;s<e.length;s++){const r=e[s],{status:h,account:d,type:c,createdAt:f}=r,m=new Date(f).toLocaleDateString();let u=c;(c==="favourite"||c==="reblog")&&(u="favourite+reblog");const p=`${h==null?void 0:h.id}-${u}-${m}`,g=n[p];if(u==="follow_request")l[a++]=r;else if(g!=null&&g.account){const b=g._accounts.find(y=>y.id===d.id);b?(b._types.push(c),b._types.sort().reverse()):(d._types=[c],g._accounts.push(d))}else{d._types=[c];let b=n[p]={...r,type:u,_accounts:[d]};l[a++]=b}}const i={},o=[];for(let s=0,a=0;s<l.length;s++){const r=l[s],{account:h,_accounts:d,type:c,createdAt:f}=r,m=new Date(f).toLocaleDateString();if(c==="favourite+reblog"&&h&&d.length===1){const u=`${h==null?void 0:h.id}-${c}-${m}`,p=i[u];if(p)p._statuses.push(r.status);else{let g=i[u]={...r,type:c,_statuses:[r.status]};o[a++]=g}}else o[a++]=r}return o}function qe(e){const{masto:n}=F();return n.v1.webPushSubscriptions.create(e)}function zs(){const{masto:e}=F();return e.v1.webPushSubscriptions.fetch()}function Fs(e){const{masto:n}=F();return n.v1.webPushSubscriptions.update(e)}function Bs(){const{masto:e}=F();return e.v1.webPushSubscriptions.remove()}function de(){return"serviceWorker"in navigator&&"PushManager"in window}function mn(){return navigator.serviceWorker.getRegistration()}async function $e(){const e=await mn(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function gn(e){const n="=".repeat((4-e.length%4)%4),l=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(l),o=new Uint8Array(i.length);for(let s=0;s<i.length;++s)o[s]=i.charCodeAt(s);return o}async function Os(){if(!de())return;const{subscription:e}=await $e();let n=null;try{n=await zs()}catch(l){if(!/(not found|unknown)/i.test(l.message))throw l}if(n&&e){const l=n.endpoint===e.endpoint,{vapidKey:i}=jt(),o=n.serverKey===i;if(!l)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:l}=jt(),{applicationServerKey:i}=e.options,o=gn(l).toString(),s=new Uint8Array(i).toString();if(!(o===s))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function He({data:e,policy:n}){if(!de())return;let{registration:l,subscription:i}=await $e(),o=null;if(i)try{o=await Fs({data:e,policy:n})}catch{o=await qe({subscription:i,data:e,policy:n})}else{const{vapidKey:s}=jt();if(!s)throw new Error("No server key found");i=await l.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:gn(s)}),o=await qe({subscription:i,data:e,policy:n})}return{subscription:i,backendSubscription:o}}async function je(){if(!de())return;const{subscription:e}=await $e();e&&(await Bs(),await e.unsubscribe())}const qs=30,Hs=new URLSearchParams;function js({columnMode:e}){St("Notifications","/notifications");const{masto:n,instance:l}=F(),i=dt(T),[o,s]=C("default"),[a]=e?[Hs]:Mt(),r=a.get("id"),h=a.get("access_token"),[d,c]=C(!1),[f,m]=C(!1),u=N(),{nearReachEnd:p,scrollDirection:g,reachStart:b,nearReachStart:y}=re({scrollableRef:u}),k=g==="end"&&!y,[S,v]=C([]),[L,E]=C([]),x=N();async function U(M){(M||!x.current)&&(x.current=n.v1.notifications.list({limit:qs,excludeTypes:["follow_request"]}));const et=await x.current.next(),ct=et.value;if(ct!=null&&ct.length){ct.forEach(kt=>{vt(kt.status,l,{skipThreading:!0})});const nt=pn(ct);M?(T.notificationsLast=ct[0],T.notifications=nt):T.notifications.push(...nt)}return T.notificationsShowNew=!1,T.notificationsLastFetchTime=Date.now(),et}function G(){return n.v1.followRequests.list({limit:80})}const H=()=>{s("loading"),(async()=>{try{const M=await G();v(M),s("default")}catch{s("error")}})()};function D(){return n.v1.announcements.list()}const P=M=>{s("loading"),(async()=>{try{const et=U(M),ct=G(),nt=D();if(M){const pt=await nt;pt.sort((R,I)=>{const A=new Date(R.updatedAt||R.createdAt);return new Date(I.updatedAt||I.createdAt)-A}),E(pt);const O=await ct;v(O)}const{done:kt}=await et;c(!kt),s("default")}catch{s("error")}})()};_(()=>{P(!0)},[]),_(()=>{b&&P(!0)},[b]),_(()=>{p&&d&&P()},[p,d]);const Q=N(!1),W=sn(5e3),ut=ae(()=>{var M;i.settings.autoRefresh&&((M=u.current)==null?void 0:M.scrollTop)===0&&(!Q.current||W)&&!Vs()&&i.notificationsShowNew&&o!=="loading"&&P(!0)},[W,i.notificationsShowNew,i.settings.autoRefresh,o]);_(ut,[i.notificationsShowNew]);const lt=new Date,tt=new Date(lt-24*60*60*1e3);let K=new Date;const ft=!i.notifications.some(M=>new Date(M.createdAt).toDateString()===lt.toDateString()),at=N();return _(()=>{r&&(T.routeNotification={id:r,accessToken:atob(h)})},[r,h]),_(()=>{o==="default"&&(async()=>{const M=await mn();if(M){const et=await M.getNotifications()}})()},[o]),t("div",{id:"notifications-page",class:"deck-container",ref:u,tabIndex:"-1",onPointerEnter:()=>{Q.current=!0},onPointerLeave:()=>{Q.current=!1},children:t("div",{class:`timeline-deck deck ${f?"only-mentions":""}`,children:[t("header",{hidden:k,onClick:M=>{var et;M.target.closest("a, button")||(et=u.current)==null||et.scrollTo({top:0,behavior:"smooth"})},class:o==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),t(q,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),i.notificationsShowNew&&o!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var M;P(!0),(M=u.current)==null||M.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New notifications"]})]}),L.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",L.length>1?"s":""]})," ",t("small",{class:"insignificant",children:l})]}),L.length>1&&t("span",{class:"announcements-nav-buttons",children:L.map((M,et)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var ct;(ct=at.current)==null||ct.children[et].scrollIntoView({behavior:"smooth",block:"nearest"})},children:et+1}))})]}),t("ul",{class:`announcements-list-${L.length>1?"multiple":"single"}`,ref:at,children:L.map(M=>t("li",{children:t(Ws,{announcement:M})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(M=>t("li",{children:[t(zt,{account:M}),t(me,{accountID:M.id,onChange:()=>{}})]},M.id))})]}):t("ul",{children:S.map(M=>t("li",{children:[t(zt,{account:M}),t(me,{accountID:M.id,onChange:()=>{}})]},M.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:f,onChange:M=>{m(M.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),ft&&!!i.notifications.length&&t("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":t($,{children:"…"})}),i.notifications.length?t($,{children:i.notifications.map(M=>{if(f&&M.type!=="mention")return null;const et=new Date(M.createdAt),ct=et.toDateString()!==K.toDateString();ct&&(K=et);const nt=et.toDateString()===tt.toDateString()?"Yesterday":Et(K,{hideTime:!0});return t($,{children:[ct&&t("h2",{class:"timeline-header",children:nt}),t(Ce,{instance:l,notification:M,reload:()=>{P(!0),H()}},M.id)]})})}):t($,{children:[o==="loading"&&t($,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((M,et)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(w,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),o==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>P(!0),children:"Try again"})]})]}),d&&t("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>P(),style:{marginBlockEnd:"6em"},children:o==="loading"?t(wt,{abrupt:!0}):t($,{children:"Show more…"})})]})})}function Vs(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Ws({announcement:e}){const{instance:n}=F(),{contact:l}=Ln(),i=l==null?void 0:l.account,{id:o,content:s,startsAt:a,endsAt:r,published:h,allDay:d,publishedAt:c,updatedAt:f,read:m,mentions:u,statuses:p,tags:g,emojis:b,reactions:y}=e,k=new Date(c),S=Et(k),v=new Date(f),L=Et(v);return t("div",{class:"announcement-block",children:[t(zt,{account:i}),t("div",{class:"announcement-content",onClick:We({mentions:u,instance:n}),dangerouslySetInnerHTML:{__html:pe(s,{emojis:b})}}),t("p",{class:"insignificant",children:[t("time",{datetime:k.toISOString(),children:Et(k)}),f&&L!==S&&t($,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:v.toISOString(),children:Et(v)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:y.map(E=>{const{name:x,count:U,me:G,staticUrl:H,url:D}=E;return t("button",{type:"button",class:`plain4 small ${G?"reacted":""}`,children:[D||H?t("img",{src:D||H,alt:x,width:"16",height:"16"}):t("span",{children:x})," ",t("span",{class:"count",children:Rt(U)})]})})})]})}const bn=Ie(js),Ks=20;function ee({local:e,columnMode:n,...l}){const i=dt(T),o=!!e,s=n?{}:Ot(),{masto:a,instance:r}=F({instance:(l==null?void 0:l.instance)||s.instance}),h=`${o?"Local":"Federated"} timeline (${r})`;St(h,o?"/:instance?/p/l":"/:instance?/p");const d=N(),c=N();async function f(u){(u||!c.current)&&(c.current=a.v1.timelines.listPublic({limit:Ks,local:o}));const p=await c.current.next();let{value:g}=p;return g!=null&&g.length&&(u&&(d.current=g[0].id),g=Pt(g,"public"),g.forEach(b=>{vt(b,r)})),{...p,value:g}}async function m(){try{const u=await a.v1.timelines.listPublic({limit:1,local:o,since_id:d.current}).next();let{value:p}=u;return p=Pt(p,"public"),!!(p!=null&&p.length)}catch{return!1}}return t(Dt,{title:h,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:o?"Local timeline":"Federated timeline"}),t("div",{children:r})]}),id:"public",instance:r,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:m,useItemID:!0,headerStart:t($,{}),boostsCarousel:i.settings.boostsCarousel,allowFilters:!0,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{href:o?`/#/${r}/p`:`/#/${r}/p/l`,children:o?t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(Ct,{}),t(Z,{onClick:()=>{let u=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(u)){u&&alert("Invalid instance");return}u&&(u=u.toLowerCase().trim(),location.hash=o?`/${u}/p/l`:`/${u}/p`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},r+o)}const Gs=20;function yn({columnMode:e,...n}){const l=dt(T),i=e?{}:Ot(),{masto:o,instance:s}=F({instance:(n==null?void 0:n.instance)||i.instance}),a=`Trending (${s})`;St(a,"/:instance?/trending");const r=N(),[h,d]=C([]),c=N();async function f(p){if(p||!c.current){c.current=o.v1.trends.listStatuses({limit:Gs});try{const y=o.v1.trends.listTags(),{value:k}=await y.next();d(k)}catch{}}const g=await c.current.next();let{value:b}=g;return b!=null&&b.length&&(p&&(r.current=b[0].id),b=Pt(b,"public"),b.forEach(y=>{vt(y,s)})),{...g,value:b}}async function m(){try{const p=await o.v1.trends.listStatuses({limit:1}).next();let{value:g}=p;return g=Pt(g,"public"),g!=null&&g.length&&g[0].id!==r.current?(r.current=g[0].id,!0):!1}catch{return!1}}const u=yt(()=>h.length?t("div",{class:"filter-bar",children:[t(w,{icon:"chart",class:"insignificant",size:"l"}),h.map((p,g)=>{const{name:b,history:y}=p,k=y.reduce((S,v)=>S+ +v.uses,0);return t(q,{to:`/${s}/t/${b}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),b]}),t("span",{class:"filter-count",children:k.toLocaleString()})]})})]}):null,[h]);return t(Dt,{title:a,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:"Trending"}),t("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:f,checkForUpdates:m,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t($,{}),boostsCarousel:l.settings.boostsCarousel,allowFilters:!0,timelineStart:u,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{onClick:()=>{let p=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(p)){p&&alert("Invalid instance");return}p&&(p=p.toLowerCase().trim(),location.hash=`/${p}/trending`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})})},s)}function Js(){St("Home","/");const e=dt(T),{shortcuts:n}=e,l=n.map(i=>{if(!i)return null;const{type:o,...s}=i,a={following:xe,notifications:bn,list:hn,public:ee,bookmarks:rn,favourites:dn,hashtag:un,mentions:fn,trending:yn}[o];return a?t(a,{...s,columnMode:!0},o+JSON.stringify(s)):null});return xt(["1","2","3","4","5","6","7","8","9"],(i,o)=>{try{const s=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),t("div",{id:"columns",children:l})}function Ys(){var n;const e=dt(T);return _(()=>{(async()=>{const l=await Kt.drafts.keys();if(l.length){const i=Ye();l.filter(s=>s.startsWith(i)).length&&(T.showDrafts=!0)}})()},[]),t($,{children:(e.settings.shortcutsColumnsMode||e.settings.shortcutsViewMode==="multi-column")&&((n=e.shortcuts)!=null&&n.length)?t(Js,{}):t(xe,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(Xs,{})})})}function Xs(){const e=dt(T),n=N(),[l,i]=C(void 0);return t($,{children:[t(q,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${l}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),i(s=>s?void 0:"open"))},children:t(w,{icon:"notification",size:"l",alt:"Notifications"})}),t(ti,{state:l,anchorRef:n,onClose:()=>i(void 0)})]})}const Zs=30,Qs=5;function ti({anchorRef:e,state:n,onClose:l}){const{masto:i,instance:o}=F(),s=dt(T),[a,r]=C("default"),h=i.v1.notifications.list({limit:Zs});async function d(){const p=await h.next(),g=p.value;if(g!=null&&g.length){g.forEach(y=>{vt(y.status,o,{skipThreading:!0})});const b=pn(g);T.notificationsLast=g[0],T.notifications=b}return T.notificationsShowNew=!1,T.notificationsLastFetchTime=Date.now(),p}const[c,f]=C(!1);function m(){return i.v1.followRequests.list({limit:1})}function u(){r("loading"),(async()=>{try{await d();const p=await m();f(!!(p!=null&&p.length)),r("default")}catch{r("error")}})()}return _(()=>{n==="open"&&u()},[n]),t(en,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:l,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:s.notifications.length?t($,{children:s.notifications.slice(0,Qs).map(p=>t(Ce,{instance:o,notification:p},p.id))}):a==="loading"?t("div",{class:"ui-state",children:t(wt,{abrupt:!0})}):a==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:u,children:"Try again"})})]})}),t("footer",{children:[t(q,{to:"/mentions",class:"button plain",children:[t(w,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(q,{to:"/notifications",class:"button plain2",children:[c?t($,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(w,{icon:"arrow-right"})]})]})]})}const ei=Ie(Ys),ni=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,si=/\/notes\/([^\/]+)\/?$/i;function wn(e){const{hostname:n,pathname:l}=new URL(e),[,i,o,s]=l.match(ni)||[];if(s)return`/${n}/s/${s}`;const[,a]=l.match(si)||[];if(a)return`/${n}/s/${a}`}function ii(){const n=on().pathname.replace(/^\//,""),l=wn(n);return Nt(()=>{l&&setTimeout(()=>{window.location.hash=l+"?view=full"},300)},[l]),t("div",{class:"ui-state",tabIndex:"-1",children:[l?t($,{children:[t("h2",{children:"Redirecting…"}),t("p",{children:t("a",{href:`#${l}?view=full`,children:l})})]}):t($,{children:[t("h2",{children:"Unable to process URL"}),t("p",{children:t("a",{href:n,target:"_blank",children:n})})]}),t("hr",{}),t("p",{children:t(q,{to:"/",children:"Go home"})})]})}function oi(){const{masto:e}=F();St("Lists","/l");const[n,l]=C("default"),[i,o]=ce(d=>d+1,0),[s,a]=C([]);_(()=>{l("loading"),(async()=>{try{const d=await e.v1.lists.list();a(d),l("default")}catch{l("error")}})()},[i]);const[r,h]=C(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),t(q,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>h(!0),children:t(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:s.length>0?t("ul",{class:"link-list",children:s.map(d=>t("li",{children:t(q,{to:`/l/${d.id}`,children:t("span",{children:[t(w,{icon:"list"})," ",t("span",{children:d.title})]})})}))}):n==="loading"?t("p",{class:"ui-state",children:t(wt,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),r&&t(bt,{class:"light",onClick:d=>{d.target===d.currentTarget&&h(!1)},children:t(Te,{list:r==null?void 0:r.list,onClose:d=>{d.state==="success"&&o(),h(!1)}})})]})}const ci=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:ai,VITE_WEBSITE:li}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Le="read write follow push";async function ri({instanceURL:e}){const n=new URLSearchParams({client_name:ai,redirect_uris:location.origin+location.pathname,scopes:Le,website:li});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function di({instanceURL:e,client_id:n}){const l=new URLSearchParams({client_id:n,scope:Le,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${l.toString()}`}async function ui({instanceURL:e,client_id:n,client_secret:l,code:i}){const o=new URLSearchParams({client_id:n,client_secret:l,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:Le});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}function hi(){St("Log in");const e=N(),n=J.local.get("instanceURL"),[l,i]=C("default"),[o]=Mt(),s=o.get("instance"),[a,r]=C(s||(n==null?void 0:n.toLowerCase())||""),[h,d]=C([]);_(()=>{(async()=>{try{const p=await(await fetch(ci)).json();d(p)}catch{}})()},[]);const c=u=>{J.local.set("instanceURL",u),(async()=>{i("loading");try{const{client_id:p,client_secret:g,vapid_key:b}=await ri({instanceURL:u});p&&g?(J.session.set("clientID",p),J.session.set("clientSecret",g),J.session.set("vapidKey",b),location.href=await di({instanceURL:u,client_id:p})):alert("Failed to register application"),i("default")}catch{i("error")}})()},f=u=>{u.preventDefault();const{elements:p}=u.target;let g=p.instanceURL.value.toLowerCase();g=g.replace(/^https?:\/\//,"").replace(/\/+$/,""),g=g.replace(/^@?[^@]+@/,""),/\./.test(g)||(g=h.find(b=>b.includes(g))),c(g)},m=a?h.filter(u=>u.includes(a)).sort((u,p)=>{const g=u.toLowerCase().startsWith(a.toLowerCase()),b=p.toLowerCase().startsWith(a.toLowerCase());return g&&!b?-1:!g&&b?1:0}).slice(0,10):[];return t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:f,children:[t("h1",{children:"Log in"}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:a,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:l==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:u=>{r(u.target.value)}}),(m==null?void 0:m.length)>0?t("ul",{id:"instances-suggestions",children:m.map(u=>t("li",{children:t("button",{type:"button",class:"plain4",onClick:()=>{c(u)},children:u})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),l==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{class:"large",disabled:l==="loading",children:"Log in"})," "]}),t(wt,{hidden:l!=="loading"}),t("hr",{}),t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(q,{to:"/",children:"Go home"})})]})})}const Zt=5,fe=40;function fi(e){const n=Ot(),{masto:l,instance:i,authenticated:o}=F({instance:n.instance}),[s,a]=C("default"),[r]=Mt(),h=N(),d=(e==null?void 0:e.query)||r.get("q"),c=(e==null?void 0:e.type)||r.get("type");St(d?`Search: ${d}${c?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[c]})`:""}`:"Search","/search");const[f,m]=C(!1),u=N(0);_(()=>{u.current=0},[d,c]);const p=N();Nt(()=>{var x,U;(U=(x=p.current)==null?void 0:x.scrollTo)==null||U.call(x,0,0)},[d,c]);const[g,b]=C([]),[y,k]=C([]),[S,v]=C([]);_(()=>{b([]),k([]),v([])},[d]);const L={statuses:b,accounts:k,hashtags:v};function E(x){a("loading"),x&&!c&&(b(g.slice(0,Zt)),k(y.slice(0,Zt)),v(S.slice(0,Zt))),(async()=>{var G,H;const U={q:d,resolve:o,limit:Zt};c&&(U.limit=fe,U.type=c,U.offset=u.current);try{const D=await l.v2.search(U);if(c)if(x){L[c](D[c]);const P=(G=D[c])==null?void 0:G.length;u.current=fe,m(!!P)}else{L[c](Q=>[...Q,...D[c]]);const P=(H=D[c])==null?void 0:H.length;u.current=u.current+fe,m(!!P)}else b(D.statuses),k(D.accounts),v(D.hashtags),u.current=0,m(!1);a("default")}catch{a("error")}})()}return _(()=>{var x,U;d&&((U=(x=h.current)==null?void 0:x.setValue)==null||U.call(x,d),E(!0))},[d,c,i]),t("div",{id:"search-page",class:"deck-container",ref:p,children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(Yt,{})}),t(pi,{ref:h}),t("div",{class:"header-side",children:" "})]})}),t("main",{children:[!!d&&t("div",{class:"filter-bar",children:[!!c&&t(q,{to:`/search${d?`?q=${d}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${d}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${d}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${d}&type=statuses`}].sort((x,U)=>x.type===c?-1:U.type===c?1:0).map(x=>t(q,{to:x.to,children:x.label}))]}),d?t($,{children:[(!c||c==="accounts")&&t($,{children:[c!=="accounts"&&t("h2",{class:"timeline-header",children:"Accounts"}),y.length>0?t($,{children:[t("ul",{class:"timeline flat accounts-list",children:y.map(x=>t("li",{children:t(zt,{account:x,instance:i,showStats:!0})},x.id))}),c!=="accounts"&&t("div",{class:"ui-state",children:t(q,{class:"plain button",to:`/search?q=${d}&type=accounts`,children:["See more accounts ",t(w,{icon:"arrow-right"})]})})]}):!c&&(s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!c||c==="hashtags")&&t($,{children:[c!=="hashtags"&&t("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?t($,{children:[t("ul",{class:"link-list hashtag-list",children:S.map(x=>t("li",{children:t(q,{to:i?`/${i}/t/${x.name}`:`/t/${x.name}`,children:[t(w,{icon:"hashtag"}),t("span",{children:x.name})]})},x.name))}),c!=="hashtags"&&t("div",{class:"ui-state",children:t(q,{class:"plain button",to:`/search?q=${d}&type=hashtags`,children:["See more hashtags ",t(w,{icon:"arrow-right"})]})})]}):!c&&(s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!c||c==="statuses")&&t($,{children:[c!=="statuses"&&t("h2",{class:"timeline-header",children:"Posts"}),g.length>0?t($,{children:[t("ul",{class:"timeline",children:g.map(x=>t("li",{children:t(q,{class:"status-link",to:i?`/${i}/s/${x.id}`:`/s/${x.id}`,children:t(gt,{status:x})})},x.id))}),c!=="statuses"&&t("div",{class:"ui-state",children:t(q,{class:"plain button",to:`/search?q=${d}&type=statuses`,children:["See more posts ",t(w,{icon:"arrow-right"})]})})]}):!c&&(s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!c&&(s==="default"?f?t(le,{onChange:x=>{x&&E()},children:t("button",{type:"button",class:"plain block",onClick:()=>E(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}))]}):s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const pi=jn((e,n)=>{const{instance:l}=F(),[i,o]=Mt(),[s,a]=C(!1),[r,h]=C(i.get("q")||""),d=i.get("type"),c=N(null),f=N(null);return Vn(n,()=>({setValue:m=>{h(m)},focus:()=>{f.current.focus()}})),t("form",{ref:c,class:"search-popover-container",onSubmit:m=>{if(m.preventDefault(),r){const u={q:r};d&&(u.type=d),o(u)}else o({})},children:[t("input",{ref:f,value:r,name:"q",type:"search",placeholder:"Search",dir:"auto",onSearch:m=>{m.target.value||o({})},onInput:m=>{h(m.target.value),a(!0)},onFocus:()=>{a(!0)},onBlur:()=>{var m,u;setTimeout(()=>{a(!1)},100),(u=(m=c.current)==null?void 0:m.querySelector(".search-popover-item.focus"))==null||u.classList.remove("focus")},onKeyDown:m=>{const{key:u}=m;switch(u){case"Escape":a(!1);break;case"Down":case"ArrowDown":if(m.preventDefault(),s){const p=c.current.querySelector(".search-popover-item.focus");if(p){let g=p.nextElementSibling;for(;g&&g.hidden;)g=g.nextElementSibling;g&&(g.classList.add("focus"),Array.from(g.parentElement.children).filter(y=>y!==g).forEach(y=>{y.classList.remove("focus")}))}else{const g=c.current.querySelector(".search-popover-item");g&&g.classList.add("focus")}}break;case"Up":case"ArrowUp":if(m.preventDefault(),s){const p=document.querySelector(".search-popover-item.focus");if(p){let g=p.previousElementSibling;for(;g&&g.hidden;)g=g.previousElementSibling;g&&(g.classList.add("focus"),Array.from(g.parentElement.children).filter(y=>y!==g).forEach(y=>{y.classList.remove("focus")}))}else{const g=document.querySelector(".search-popover-item:last-child");g&&g.classList.add("focus")}}break;case"Enter":if(s){const p=document.querySelector(".search-popover-item.focus");p&&(m.preventDefault(),p.click()),a(!1)}break}}}),t("div",{class:"search-popover",hidden:!s||!r,children:!!r&&[{label:t($,{children:["Posts with ",t("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=statuses`,hidden:/^https?:/.test(r)},{label:t($,{children:["Posts tagged with ",t("mark",{children:["#",r.replace(/^#/,"")]})]}),to:`/${l}/t/${r.replace(/^#/,"")}`,hidden:/^@/.test(r)||/^https?:/.test(r)||/\s/.test(r),top:/^#/.test(r),type:"link"},{label:t($,{children:["Look up ",t("mark",{children:r})]}),to:`/${r}`,hidden:!/^https?:/.test(r),top:/^https?:/.test(r),type:"link"},{label:t($,{children:["Accounts with ",t("q",{children:r})]}),to:`/search?q=${encodeURIComponent(r)}&type=accounts`}].sort((m,u)=>m.top&&!u.top?-1:!m.top&&u.top?1:0).map(({label:m,to:u,hidden:p,type:g})=>t(q,{to:u,class:"search-popover-item",hidden:p,children:[t(w,{icon:g==="link"?"arrow-right":"search",class:"more-insignificant"}),t("span",{children:m})," "]}))})]})});const vn=""+new URL("logo-f0531a6b.svg",import.meta.url).href,Ve=16,_t=[16,17,18,19,20];function mi({onClose:e}){const n=dt(T),l=J.local.get("theme")||"auto",i=N(),o=n.settings.contentTranslationTargetLanguage||null,s=Rn(),a=An(s),r=J.local.get("textSize")||Ve,[h,d]=C(J.account.get("preferences")||{});return t("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Settings"})}),t("main",{children:[t("section",{children:t("ul",{children:[t("li",{children:[t("div",{children:t("label",{children:"Appearance"})}),t("div",{children:t("form",{ref:i,onInput:c=>{c.preventDefault();const m=new FormData(i.current).get("theme"),u=document.documentElement;m==="auto"?u.classList.remove("is-light","is-dark"):(u.classList.toggle("is-light",m==="light"),u.classList.toggle("is-dark",m==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",m==="auto"?"dark light":m),m==="auto"?J.local.del("theme"):J.local.set("theme",m)},children:t("div",{class:"radio-group",children:[t("label",{children:[t("input",{type:"radio",name:"theme",value:"light",defaultChecked:l==="light"}),t("span",{children:"Light"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"dark",defaultChecked:l==="dark"}),t("span",{children:"Dark"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"auto",defaultChecked:l!=="light"&&l!=="dark"}),t("span",{children:"Auto"})]})]})})})]}),t("li",{children:[t("div",{children:t("label",{children:"Text size"})}),t("div",{class:"range-group",children:[t("span",{style:{fontSize:_t[0]},children:"A"})," ",t("input",{type:"range",min:_t[0],max:_t[_t.length-1],step:"1",value:r,list:"sizes",onChange:c=>{const f=parseInt(c.target.value,10);document.documentElement.style.setProperty("--text-size",`${f}px`),f===Ve?J.local.del("textSize"):J.local.set("textSize",c.target.value)}})," ",t("span",{style:{fontSize:_t[_t.length-1]},children:"A"}),t("datalist",{id:"sizes",children:_t.map(c=>t("option",{value:c}))})]})]})]})}),t("h3",{children:"Posting"}),t("section",{children:t("ul",{children:t("li",{children:[t("div",{children:t("label",{for:"posting-privacy-field",children:"Default visibility"})}),t("div",{children:t("select",{id:"posting-privacy-field",value:h["posting:default:visibility"]||"public",onChange:c=>{const{value:f}=c.target,{masto:m}=F();(async()=>{try{await m.v1.accounts.updateCredentials({source:{privacy:f}}),d({...h,"posting:default:visibility":f}),J.account.set("preferences",{...h,"posting:default:visibility":f})}catch{alert("Failed to update posting privacy")}})()},children:[t("option",{value:"public",children:"Public"}),t("option",{value:"unlisted",children:"Unlisted"}),t("option",{value:"private",children:"Followers only"})]})})]})})}),t("h3",{children:"Experiments"}),t("section",{children:t("ul",{children:[t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:c=>{T.settings.autoRefresh=c.target.checked}})," ","Auto refresh timeline posts"]})}),t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:c=>{T.settings.boostsCarousel=c.target.checked}})," ","Boosts carousel"]})}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:c=>{const{checked:f}=c.target;T.settings.contentTranslation=f,f||(T.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),t("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[t("div",{children:t("label",{children:["Translate to"," ",t("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:c=>{T.settings.contentTranslationTargetLanguage=c.target.value||null},children:[t("option",{value:"",children:["System language (",a,")"]}),t("option",{disabled:!0,children:"──────────"}),Me.map(c=>t("option",{value:c.code,children:c.name}))]})]})}),t("hr",{}),t("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&t($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",t("div",{class:"checkbox-fields",children:Me.map(c=>t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(c.code),onChange:f=>{const{checked:m}=f.target;m?T.settings.contentTranslationHideLanguages.push(c.code):T.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(u=>u!==c.code)}})," ",c.name]}))})]}),t("p",{class:"insignificant",children:t("small",{children:["Note: This feature uses an external API to translate, powered by"," ",t("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",children:"Lingva Translate"}),"."]})}),t("hr",{}),t("div",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:c=>{T.settings.contentTranslationAutoInline=c.target.checked}})," ","Auto inline translation"]}),t("p",{class:"insignificant",children:t("small",{children:["Automatically show translation for posts in timeline. Only works for ",t("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:c=>{T.settings.cloakMode=c.target.checked}})," ","Cloak mode"," ",t("span",{class:"insignificant",children:["(",t("samp",{children:"Text"})," → ",t("samp",{children:"████"}),")"]})]}),t("div",{class:"sub-section insignificant",children:t("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),t("li",{children:t("button",{type:"button",class:"light",onClick:()=>{T.showDrafts=!0,T.showSettings=!1},children:"Unsent drafts"})})]})}),t(gi,{onClose:e}),t("h3",{children:"About"}),t("section",{children:[t("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[t("img",{src:vn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),t("div",{children:[t("b",{children:"Phanpy"})," ",t("a",{href:"https://hachyderm.io/@phanpy",onClick:c=>{c.preventDefault(),T.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),t("br",{}),t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",onClick:c=>{c.preventDefault(),T.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),t("p",{children:t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"})}),t("p",{children:[t("span",{class:"insignificant",children:"Last build:"})," ",t(Se,{datetime:new Date("2023-09-03T21:22:51.463Z")})," ",t($,{children:["(",t("a",{href:"https://github.com/cheeaun/phanpy/commit/cdef3b9",target:"_blank",children:t("code",{children:"cdef3b9"})}),")"]})]})]})]})]})}function gi({onClose:e}){if(!de())return null;const{instance:n}=F(),[l,i]=C("default"),o=N(),[s,a]=C(!1),[r,h]=C(!1),d=N();_(()=>{(async()=>{i("loading");try{const{subscription:f,backendSubscription:m}=await Os();if(m!=null&&m.policy&&m.policy!=="none"){a(!0);const{alerts:u,policy:p}=m;d.current=p;const{elements:g}=o.current,b=g.namedItem(p);b&&(b.value=p),Object.keys(u).forEach(y=>{const k=g.namedItem(y);(k==null?void 0:k.type)==="checkbox"&&(k.checked=!0)})}i("default")}catch(f){/outside.*authorized/i.test(f.message)?h(!0):alert((f==null?void 0:f.message)||f),i("error")}})()},[]);const c=l==="loading";return t("form",{ref:o,onChange:()=>{const f=Object.fromEntries(new FormData(o.current)),m=!!f["policy-allow"],u={policy:f.policy,data:{alerts:{mention:!!f.mention,favourite:!!f.favourite,reblog:!!f.reblog,follow:!!f.follow,follow_request:!!f.followRequest,poll:!!f.poll,update:!!f.update,status:!!f.status}}};let p=0;Object.keys(u.data.alerts).forEach(b=>{u.data.alerts[b]?p++:delete u.data.alerts[b]});const g=d.current!==u.policy;m&&p>0?g?je().then(()=>{He(u)}).catch(b=>{alert("Failed to update subscription. Please try again.")}):He(u).catch(b=>{alert("Failed to update subscription. Please try again.")}):je().catch(b=>{alert("Failed to remove subscription. Please try again.")})},children:[t("h3",{children:"Push Notifications (beta)"}),t("section",{children:t("ul",{children:t("li",{children:[t("label",{children:[t("input",{type:"checkbox",disabled:c||r,name:"policy-allow",checked:s,onChange:async f=>{const{checked:m}=f.target;if(m){const u=await Notification.requestPermission();u==="granted"?a(!0):(a(!1),u==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else a(!1)}})," ","Allow from"," ",t("select",{name:"policy",disabled:c||r||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(f=>t("option",{value:f.value,children:f.label}))})]}),t("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:t("div",{class:"shazam-container-inner",children:t("div",{class:"sub-section",children:t("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(f=>t("li",{children:t("label",{children:[t("input",{type:"checkbox",name:f.value})," ",f.label]})}))})})})}),r&&t("div",{class:"sub-section",children:t("p",{children:["Push permission was not granted since your last login. You'll need to"," ",t(q,{to:`/login?instance=${n}`,onClick:e,children:[t("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),t("p",{class:"section-postnote",children:t("small",{children:["NOTE: Push notifications only works for ",t("b",{children:"one account"}),"."]})})]})}const Qt=40,bi=10,yi=5;let be={},ne={};function ye(e){delete ne[e],delete T.scrollPositions[e]}function wi(e){const{id:n}=e,{masto:l,instance:i}=F({instance:e.instance}),o=dt(T),[s,a]=Mt(),r=s.get("media"),h=s.get("media-only"),d=parseInt(r||h,10);let c=d>0;const f=s.get("mediaStatusID"),m=Qe(f,i);f&&!m&&(c=!1);const u=c&&!!h,p=ke(n,i),[g,b]=C(T.statuses[p]);_(()=>{T.statuses[p]&&b(T.statuses[p])},[p]);const y=yt(()=>{const{prevLocation:S}=T,v=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),L=se("/:instance/s/:id",v)||se("/s/:id",v);return!v||L?"/":v},[]);_(()=>{!g&&c&&(async()=>{try{const S=await l.v1.statuses.fetch(n);vt(S,i),b(S)}catch{alert("Unable to load post."),location.hash=y}})()},[c]);const k=f?m==null?void 0:m.mediaAttachments:g==null?void 0:g.mediaAttachments;return t("div",{class:"deck-backdrop",children:[c?k!=null&&k.length?t(an,{mediaAttachments:k,statusID:f||n,instance:i,index:d-1,onClose:()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():u?location.hash=y:(s.delete("media"),s.delete("mediaStatusID"),a(s))}}):t("div",{class:"media-modal-container loading",children:t(wt,{abrupt:!0})}):t(q,{to:y}),!u&&t(vi,{id:n,instance:e.instance,closeLink:y})]})}function vi({id:e,closeLink:n="/",instance:l}){var R;const[i,o]=Mt(),s=i.get("media"),a=parseInt(s,10)>0,[r,h]=C(i.get("view")),d=!!parseInt(i.get("translate")),{masto:c,instance:f}=F({instance:l}),{masto:m,instance:u,authenticated:p}=F(),g=f===u,b=dt(T),[y,k]=C([]),[S,v]=C("default"),L=N(),E=ke(e,f),x=N(0),U=N();_(()=>{var I;(I=U.current)==null||I.focus()},[]),_(()=>{var A;const I=Wn(()=>{if(!U.current)return;const{scrollTop:B}=U.current;S!=="loading"&&(T.scrollPositions[e]=B)},50);return(A=U.current)==null||A.addEventListener("scroll",I,{passive:!0}),I(),()=>{var B;I.cancel(),(B=U.current)==null||B.removeEventListener("scroll",I)}},[e,S!=="loading"]);const G=N(),H=({reloadHero:I}={})=>{v("loading");let A;const B=ne[e];if(B){const Y=B.filter(X=>T.statuses[E]);k(Y)}else k([{id:e}]);return(async()=>{var st,Lt;const Y=()=>Ue(()=>c.v1.statuses.fetch(e),{retries:4}),X=Ue(()=>c.v1.statuses.fetchContext(e),{retries:8}),j=!!b.statuses[E];let z=b.statuses[E];if(!(j&&!I))try{z=await Y(),vt(z,f),await new Promise(it=>{setTimeout(it,100)})}catch{v("error");return}try{let it=function(V){return V==null?void 0:V.map(mt=>({id:mt.id,account:mt.account,repliesCount:mt.repliesCount,content:mt.content,weight:Gt(mt),replies:it(mt.__replies)}))};const ht=await X,{ancestors:It,descendants:$t}=ht;x.current=($t==null?void 0:$t.length)||0;const Ut=new Set;It.forEach(V=>{vt(V,f,{skipThreading:!0}),V.inReplyToId&&!It.find(mt=>mt.id===V.inReplyToId)&&Ut.add(V.inReplyToId)});const ue=It.every(V=>V.account.id===z.account.id),qt=[];$t.forEach(V=>{if(vt(V,f,{skipThreading:!0}),V.inReplyToId&&!$t.find(mt=>mt.id===V.inReplyToId)&&V.inReplyToId!==z.id&&Ut.add(V.inReplyToId),V.inReplyToAccountId===V.account.id)qt.push(V);else if(V.inReplyToId===z.id)qt.push(V);else if(!V.inReplyToAccountId&&qt.find(mt=>mt.id===V.inReplyToId)&&V.account.id===z.account.id)qt.push(V);else{const mt=$t.find(kn=>kn.id===V.inReplyToId);mt&&(mt.__replies||(mt.__replies=[]),mt.__replies.push(V))}}),Ut.size;const Vt=[...It.map(V=>({id:V.id,ancestor:!0,isThread:ue,accountID:V.account.id,account:V.account,repliesCount:V.repliesCount,weight:Gt(V)})),{id:e,accountID:z.account.id,weight:Gt(z)},...qt.map(V=>({id:V.id,account:V.account,accountID:V.account.id,descendant:!0,thread:V.account.id===z.account.id,weight:Gt(V),replies:it(V.__replies)}))];v("default"),G.current={offsetTop:(st=L.current)==null?void 0:st.offsetTop,scrollTop:(Lt=U.current)==null?void 0:Lt.scrollTop};const Re=Vt.findIndex(V=>V.id===e);Re>=lt&&tt(Re+1),k(Vt),ne[e]=Vt,Mn(z,f)}catch{v("error")}})(),()=>{clearTimeout(A)}};_(H,[e,c]),_(()=>{var A,B;if(!y.length)return;const I=b.scrollPositions[e];if(I)U.current.scrollTop=I;else if(G.current){const Y={offsetTop:(A=L.current)==null?void 0:A.offsetTop,scrollTop:(B=U.current)==null?void 0:B.scrollTop},X=Y.offsetTop-G.current.offsetTop+Y.scrollTop;U.current.scrollTop=X}else y.length===1&&(U.current.scrollTop=0);G.current=null},[y]),_(()=>{b.reloadStatusPage<=0||(async()=>{try{const{instanceURL:I}=jt(),A=`https://${I}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(A,{ignoreVary:!0}),H({reloadHero:!0})}catch{}})()},[b.reloadStatusPage]),_(()=>()=>{T.scrollPositions={},T.reloadStatusPage=0,ne={},be={},we.clear()},[]);const D=b.statuses[E]||b.statuses[e],P=yt(()=>{if(!D)return"";const{account:I}=D,A=document.createElement("div");return A.innerHTML=I.displayName,A.innerText.trim()},[D]),Q=yt(()=>{if(!D)return"";let I=Ze(D);return I.length>64&&(I=I.slice(0,64)+"…"),I},[D]);St(P&&Q?`${P}: "${Q}"`:"Status","/:instance?/s/:id");const W=yt(()=>{if(!D)return;const{url:I}=D;if(I)return new URL(I).hostname},[D]),ut=yt(()=>{if(W)return W===f},[W,f]),[lt,tt]=C(Qt),K=yt(()=>y.length-lt,[y.length,lt]),ft=y.some(I=>I.descendant),at=y.filter(I=>I.ancestor),[M,et]=C(!0),ct=nn(et,100),nt=yt(()=>{if(!L.current||M)return null;const{top:I}=L.current.getBoundingClientRect();return I>0?"down":"up"},[M]);xt("esc",()=>{location.hash=n},{enabled:!a}),xt("backspace",()=>{location.hash=n}),xt("j",()=>{var Y,X;const I=document.activeElement.closest(".status-link, .status-focus"),A=I==null?void 0:I.getBoundingClientRect(),B=Array.from(U.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(I&&A.top<U.current.clientHeight&&A.bottom>0){const j=B.indexOf(I);let z=B[j+1];z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=B.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),xt("k",()=>{var Y,X;const I=document.activeElement.closest(".status-link, .status-focus"),A=I==null?void 0:I.getBoundingClientRect(),B=Array.from(U.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(I&&A.top<U.current.clientHeight&&A.bottom>0){const j=B.indexOf(I);let z=B[j-1];z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=B.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),xt("x",()=>{const I=document.activeElement.closest(".status-link, .status-focus");if(I){const A=I.nextElementSibling;A&&A.tagName.toLowerCase()==="details"&&(A.open=!A.open)}});const{nearReachStart:kt}=re({scrollableRef:U,distanceFromStartPx:16}),pt=N(a?"media+status":"status"),O=ae((I,A,B,Y)=>{I.preventDefault(),I.stopPropagation(),o({media:A+1,mediaStatusID:Y.id})},[e]);return t("div",{tabIndex:"-1",ref:U,class:`status-deck deck contained ${y.length>1?"padded-bottom":""} ${pt.current==="status"?"slide-in":""} ${r?`deck-view-${r}`:""}`,onAnimationEnd:I=>{pt.current==="status"&&(pt.current=null)},children:[t("header",{class:`${M?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:I=>{T.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[!!/\/s\//i.test((R=b.prevLocation)==null?void 0:R.pathname)&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(w,{icon:"chevron-left",size:"xl"})}),!M&&D&&S!=="loading"?t($,{children:[t("span",{class:"hero-heading",children:[t(ve,{account:D.account,instance:f,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(Se,{datetime:D.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),L.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(w,{icon:nt==="down"?"arrow-down":"arrow-up"})})]}):t($,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),U.current.scrollTo({top:0,behavior:"smooth"})},hidden:!at.length||kt,title:`${at.length} posts above ‒ Go to top`,children:[t(w,{icon:"arrow-up"}),at.filter((I,A,B)=>B.findIndex(Y=>Y.accountID===I.accountID)===A).slice(0,3).map(I=>t(Ft,{url:I.account.avatar,alt:I.account.displayName},I.account.id)),at.length>3&&t($,{children:[" ",t("span",{class:"insignificant",children:Rt(at.length)})]})]})]})]}),t("div",{class:"header-side",children:[t(Bt,{align:"end",portal:{target:U.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(Z,{disabled:S==="loading",onClick:()=>{T.reloadStatusPage++},children:[t(w,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(Z,{className:"menu-switch-view",onClick:()=>{h(r==="full"?null:"full"),i.delete("media"),i.delete("media-only"),r==="full"?i.delete("view"):i.set("view","full"),o(i)},children:[t(w,{icon:{"":"layout5",full:"layout4"}[r||""]}),t("span",{children:["Switch to ",r==="full"?"Side Peek":"Full"," view"]})]}),t(Z,{onClick:()=>{Array.from(U.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(A=>{A.click()})},children:[t(w,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(Ct,{}),t(Kn,{className:"plain",children:"Experimental"}),t(Z,{disabled:ut,onClick:()=>{const I=wn(D.url);I?location.hash=I:alert("Unable to switch")},children:[t(w,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance (",t("b",{children:W}),")"]})]})]}),t(q,{class:"button plain deck-close",to:n,children:t(w,{icon:"x",size:"xl"})})]})]})}),y.length&&D?t("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[y.slice(0,lt).map(I=>{const{id:A,ancestor:B,isThread:Y,descendant:X,thread:j,replies:z,repliesCount:st,weight:Lt}=I,it=A===e;return t("li",{ref:it?L:null,class:`${B?"ancestor":""} ${X?"descendant":""} ${j?"thread":""} ${it?"hero":""}`,children:[it?t($,{children:[t(le,{threshold:.1,onChange:ct,class:"status-focus",tabIndex:0,children:t(gt,{statusID:A,instance:f,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:d})}),S!=="loading"&&!p?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(q,{to:"/login",class:"button",children:"Log in"})]}):!g&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:f}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:S==="loading",onClick:()=>{v("loading"),(async()=>{try{const ht=await m.v2.search({q:D.url,type:"statuses",resolve:!0,limit:1});if(ht.statuses.length){const It=ht.statuses[0];location.hash=u?`/${u}/s/${It.id}`:`/s/${It.id}`}else throw new Error("No results")}catch(ht){v("default"),alert("Error: "+ht)}})()},children:[t(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(q,{class:"status-link",to:f?`/${f}/s/${A}`:`/s/${A}`,onClick:()=>{ye(A)},children:[t(gt,{statusID:A,instance:f,withinContext:!0,size:j||B?"m":"s",enableTranslate:!0,onMediaClick:O,onStatusLinkClick:()=>{ye(A)}}),B&&Y&&st>1&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:st,children:Rt(st)})]})," "]}),X&&(z==null?void 0:z.length)>0&&t(Sn,{instance:f,replies:z,hasParentThread:j,level:1,accWeight:Lt,openAll:x.current<bi}),S==="loading"&&it&&!!(D!=null&&D.repliesCount)&&!ft&&t("div",{class:"status-loading",children:t(wt,{})}),S==="error"&&it&&!!(D!=null&&D.repliesCount)&&!ft&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{T.reloadStatusPage++},children:"Try again"})]})]},A)}),K>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>tt(I=>I+Qt),style:{marginBlockEnd:"6em"},children:[t("div",{class:"ib",children:y.slice(lt,lt+5).map(I=>t(Ft,{url:I.account.avatarStatic},I.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:K>Qt?`${Qt}+`:K})]})]})})]}):t($,{children:[S==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(gt,{skeleton:!0,size:"l"})})}),S==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{T.reloadStatusPage++},children:"Try again"})]})]})]})}function Sn({replies:e,instance:n,hasParentThread:l,level:i,accWeight:o,openAll:s}){const[a,r]=Mt(),h=y=>y.reduce((k,S)=>{const{repliesCount:v,replies:L}=S,E=(L==null?void 0:L.length)||v;return k+E+h(L||[])},0),d=e.length+h(e),c=e.length===d,f=e.map(y=>y.account).filter((y,k,S)=>S.findIndex(v=>v.id===y.id)===k).slice(0,3),m=yt(()=>e==null?void 0:e.reduce((y,k)=>y+(k==null?void 0:k.weight),o),[o,e==null?void 0:e.length]);let u=!1;(s||m<=yi||!l&&d===1&&Gt(e[0])<2)&&(u=!0);const p=be[e[0].id],g=ae((y,k,S,v)=>{y.preventDefault(),y.stopPropagation(),r({media:k+1,mediaStatusID:v.id})},[]),b=N();return Nt(()=>{var k;function y(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(k=b.current)==null||k.addEventListener("scroll",y,{passive:!0}),()=>{var S;(S=b.current)==null||S.removeEventListener("scroll",y)}},[]),t("details",{ref:b,class:"replies",open:p||u,onToggle:y=>{const{open:k}=y.target;be[e[0].id]=k},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[t("summary",{class:"replies-summary",hidden:u,children:[t("span",{class:"avatars",children:f.map(y=>t(Ft,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),t("span",{children:[t("span",{title:e.length,children:Rt(e.length)})," ","repl",e.length===1?"y":"ies"]}),!c&&d>1&&t($,{children:[" ","·"," ",t("span",{children:[t("span",{title:d,children:Rt(d)})," ","comment",d===1?"":"s"]})]})]}),t("ul",{children:e.map(y=>{var k,S;return t("li",{children:[t(q,{class:"status-link",to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{ye(y.id)},children:[t(gt,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:g}),!((k=y.replies)!=null&&k.length)&&y.repliesCount>0&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:y.repliesCount,children:Rt(y.repliesCount)})]})]}),((S=y.replies)==null?void 0:S.length)&&t(Sn,{instance:n,replies:y.replies,level:i+1,accWeight:u?m:y.weight,openAll:s})]},y.id)})})]})}const Si=140,ki=35,Ii=70,Ti=140,we=new Map;function Gt(e){var u,p;const n=we.get(e.id);if(n)return n;const{spoilerText:l,content:i,mediaAttachments:o,poll:s,card:a}=e,r=Dn(l+i),h=o!=null&&o.length?Si:0,d=(((u=s==null?void 0:s.options)==null?void 0:u.length)||0)*ki,c=a&&(o!=null&&o.length||(p=s==null?void 0:s.options)!=null&&p.length)?0:Ii,m=(r+h+d+c)/Ti;return we.set(e.id,m),m}const Ci=Ie(wi);function xi(){const e=Ot(),{id:n,instance:l}=e;return t(Ci,{id:n,instance:l})}const $i=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,Li=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,Ri=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,Ai=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,Mi=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,Di=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function Ei(){return St(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("h1",{children:[t("img",{src:vn,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:Di,alt:"Phanpy",width:"250"})]}),t("p",{children:t("big",{children:t("b",{children:t(q,{to:"/login",class:"button",children:"Log in"})})})}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:$i,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:Mi,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:Li,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:Ri,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:Ai,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),t("hr",{}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),T.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const Ni=window.alert;window.__nativeAlert||(window.__nativeAlert=Ni);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=Gn({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=T;setTimeout(()=>{var e,n,l,i;for(const o in Xt)Array.isArray(Xt[o])?(n=(e=Xt[o])[0])==null||n.call(e):(i=(l=Xt)[o])==null||i.call(l)},5e3);function Pi(){var u,p,g,b,y,k,S;const e=dt(T),[n,l]=C(!1),[i,o]=C("loading"),s=tn();Nt(()=>{const v=J.local.get("theme");v&&(document.documentElement.classList.add(`is-${v}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",v==="auto"?"dark light":v));const L=J.local.get("textSize");L&&document.documentElement.style.setProperty("--text-size",`${L}px`)},[]),_(()=>{const v=J.local.get("instanceURL"),L=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(L){window.history.replaceState({},document.title,a.pathname||"/");const E=J.session.get("clientID"),x=J.session.get("clientSecret"),U=J.session.get("vapidKey");(async()=>{o("loading");const{access_token:G}=await ui({instanceURL:v,client_id:E,client_secret:x,code:L}),H=En({instance:v,accessToken:G});await Promise.allSettled([De(H,v),Nn(H,v,G,U)]),Pn(),Ee(H),l(!0),o("default")})()}else{const E=jt();if(E){J.session.set("currentAccount",E.info.id);const{masto:x,instance:U}=F({account:E});Ee(x),o("loading"),(async()=>{try{await De(x,U)}catch{}finally{l(!0),o("default")}})()}else o("default")}},[]);let a=on();T.currentLocation=a.pathname;const r=()=>{let v=setTimeout(()=>{if(!document.getElementById("columns")){if(document.querySelector(".deck-backdrop"))return;const x=document.querySelectorAll(".deck-container"),U=x[x.length-1];U&&U.tabIndex===-1&&U.focus()}},100);return()=>clearTimeout(v)};_(r,[a]);const h=e.showCompose||e.showSettings||e.showAccounts||e.showAccount||e.showDrafts||e.showMediaModal||e.showShortcutsSettings;_(()=>{h||r()},[h]);const{prevLocation:d}=e,c=N(d||null);if(se("/:instance/s/:id",a.pathname)||se("/s/:id",a.pathname)?c.current||(c.current=d):c.current=null,/\/https?:/.test(a.pathname))return t(ii,{});const m=yt(()=>{const{pathname:v}=a;return!/^\/(login|welcome)/.test(v)},[a]);return _(()=>{const v=document.getElementById("app");v&&(v.dataset.shortcutsViewMode=e.settings.shortcutsViewMode)},[e.settings.shortcutsViewMode]),_(()=>{document.body.classList.toggle("cloak",e.settings.cloakMode)},[e.settings.cloakMode]),t($,{children:[t(he,{location:m||a,children:[t(rt,{path:"/",element:n?t(ei,{}):i==="loading"?t(wt,{id:"loader-root"}):a.pathname==="/"&&t(ee,{local:!0,instance:"stargate.pbcarrara.com.br"})}),t(rt,{path:"/login",element:t(hi,{})}),t(rt,{path:"/welcome",element:t(Ei,{})})]}),t(he,{location:c.current||a,children:[n&&t(rt,{path:"/notifications",element:t(bn,{})}),n&&t(rt,{path:"/mentions",element:t(fn,{})}),n&&t(rt,{path:"/following",element:t(xe,{})}),n&&t(rt,{path:"/b",element:t(rn,{})}),n&&t(rt,{path:"/f",element:t(dn,{})}),n&&t(rt,{path:"/l",children:[t(rt,{index:!0,element:t(oi,{})}),t(rt,{path:":id",element:t(hn,{})})]}),n&&t(rt,{path:"/ft",element:t(Ls,{})}),t(rt,{path:"/:instance?/t/:hashtag",element:t(un,{})}),t(rt,{path:"/:instance?/a/:id",element:t(Is,{})}),t(rt,{path:"/:instance?/p",children:[t(rt,{index:!0,element:t(ee,{})}),t(rt,{path:"l",element:t(ee,{local:!0})})]}),t(rt,{path:"/:instance?/trending",element:t(yn,{})}),t(rt,{path:"/:instance?/search",element:t(fi,{})})]}),i==="default"&&t(he,{children:t(rt,{path:"/:instance?/s/:id",element:t(xi,{})})}),n&&t("button",{type:"button",id:"compose-button",onClick:v=>{v.shiftKey?Un()||(alert("Looks like your browser is blocking popups."),T.showCompose=!0):T.showCompose=!0},children:t(w,{icon:"quill",size:"xl",alt:"Compose"})}),n&&!e.settings.shortcutsColumnsMode&&e.settings.shortcutsViewMode!=="multi-column"&&t(gs,{}),!!e.showCompose&&t(bt,{children:t(_n,{replyToStatus:typeof e.showCompose!="boolean"?e.showCompose.replyToStatus:((u=window.__COMPOSE__)==null?void 0:u.replyToStatus)||null,editStatus:((p=T.showCompose)==null?void 0:p.editStatus)||((g=window.__COMPOSE__)==null?void 0:g.editStatus)||null,draftStatus:((b=T.showCompose)==null?void 0:b.draftStatus)||((y=window.__COMPOSE__)==null?void 0:y.draftStatus)||null,onClose:v=>{const{newStatus:L,instance:E}=v||{};T.showCompose=!1,window.__COMPOSE__=null,L&&(T.reloadStatusPage++,ot({text:"Post published. Check it out.",delay:1e3,duration:1e4,onClick:x=>{x.hideToast(),T.prevLocation=a,s(E?`/${E}/s/${L.id}`:`/s/${L.id}`)}}))}})}),!!e.showSettings&&t(bt,{onClick:v=>{v.target===v.currentTarget&&(T.showSettings=!1)},children:t(mi,{onClose:()=>{T.showSettings=!1}})}),!!e.showAccounts&&t(bt,{onClick:v=>{v.target===v.currentTarget&&(T.showAccounts=!1)},children:t(Ts,{onClose:()=>{T.showAccounts=!1}})}),!!e.showAccount&&t(bt,{class:"light",onClick:v=>{v.target===v.currentTarget&&(T.showAccount=!1)},children:t(ss,{account:((k=e.showAccount)==null?void 0:k.account)||e.showAccount,instance:(S=e.showAccount)==null?void 0:S.instance,onClose:({destination:v}={})=>{T.showAccount=!1,v&&(T.showAccounts=!1)}})}),!!e.showDrafts&&t(bt,{onClick:v=>{v.target===v.currentTarget&&(T.showDrafts=!1)},children:t(os,{onClose:()=>T.showDrafts=!1})}),!!e.showMediaModal&&t(bt,{onClick:v=>{(v.target===v.currentTarget||v.target.classList.contains("media"))&&(T.showMediaModal=!1)},children:t(an,{mediaAttachments:e.showMediaModal.mediaAttachments,instance:e.showMediaModal.instance,index:e.showMediaModal.index,statusID:e.showMediaModal.statusID,onClose:()=>{T.showMediaModal=!1}})}),!!e.showShortcutsSettings&&t(bt,{class:"light",onClick:v=>{v.target===v.currentTarget&&(T.showShortcutsSettings=!1)},children:t(fs,{onClose:()=>T.showShortcutsSettings=!1})}),t(ls,{}),t(is,{isLoggedIn:n})]})}Jn(t(Yn,{children:t(Pi,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-2e833a46.js.map
