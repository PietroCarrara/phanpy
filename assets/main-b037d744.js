import{a as B,s as Tn,I as w,M as At,b as T,A as zt,h as We,e as pe,E as Ke,c as Rt,L as H,d as Cn,n as Et,f as J,u as xn,g as Ft,i as ot,j as wt,k as bt,l as Ae,T as Ge,m as vt,o as Je,p as $n,q as Kt,r as Ye,t as Ln,v as Tt,N as ve,R as Se,S as gt,w as Rn,x as Vt,y as Xe,z as Ze,B as ke,C as St,D as Qe,F as An,G as Mn,H as Dn,J as Me,K as En,O as Nn,P as Xt,Q as Pn,U as De,V as Un,W as _n,X as Ee,Y as zn}from"./useTitle-644aa295.js";import{h as C,_ as P,p as _,o as t,k as $,M as Bt,a as Z,b as xt,S as Fn,s as ce,u as Ct,F as yt,y as Nt,g as Bn,c as dt,d as On,e as Mt,A as qn,m as Ne,l as Pe,f as tn,i as Hn,J as jn,C as en,j as nn,n as sn,T as ae,I as le,q as Ot,r as Vn,t as Wn,x as Ie,v as on,w as se,z as Kn,B as Ue,D as Gn,E as Jn,R as he,G as rt,H as Yn,K as Xn}from"./vendor-4c67f001.js";function Te({list:e,onClose:n}){const{masto:r}=B(),[i,o]=C("default"),s=!!e,c=P(),a=P(),h=P();_(()=>{s&&(c.current.value=e.title,a.current.value=e.repliesPolicy,h.current&&(h.current.checked=e.exclusive))},[s]);const d=Tn("@mastodon/list-exclusive");return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})})," ",t("header",{children:t("h2",{children:s?"Edit list":"New list"})}),t("main",{children:t("form",{class:"list-form",onSubmit:l=>{l.preventDefault();const p=new FormData(l.target),g=p.get("title"),u=p.get("replies_policy"),m=p.get("exclusive")==="on";o("loading"),(async()=>{try{let b;s?b=await r.v1.lists.update(e.id,{title:g,replies_policy:u,exclusive:m}):b=await r.v1.lists.create({title:g,replies_policy:u,exclusive:m}),o("default"),n==null||n({state:"success",list:b})}catch{o("error"),alert(s?"Unable to edit list.":"Unable to create list.")}})()},children:[t("div",{class:"list-form-row",children:t("label",{for:"list-title",children:["Name"," ",t("input",{ref:c,type:"text",id:"list-title",name:"title",required:!0,disabled:i==="loading",dir:"auto"})]})}),t("div",{class:"list-form-row",children:t("select",{ref:a,name:"replies_policy",required:!0,disabled:i==="loading",children:[t("option",{value:"list",children:"Show replies to list members"}),t("option",{value:"followed",children:"Show replies to people I follow"}),t("option",{value:"none",children:"Don't show replies"})]})}),d&&t("div",{class:"list-form-row",children:t("label",{class:"label-block",children:[t("input",{ref:h,type:"checkbox",name:"exclusive",disabled:i==="loading"})," ","Hide posts on this list from Home/Following"]})}),t("div",{class:"list-form-footer",children:[t("button",{type:"submit",disabled:i==="loading",children:s?"Save":"Create"}),s&&t(At,{disabled:i==="loading",align:"end",menuItemClassName:"danger",confirmLabel:"Delete this list?",onClick:()=>{o("loading"),(async()=>{try{await r.v1.lists.remove(e.id),o("default"),n==null||n({state:"deleted"})}catch{o("error"),alert("Unable to delete list.")}})()},children:t("button",{type:"button",class:"light danger",disabled:i==="loading",children:"Delete…"})})]})]})})]})}const Zn=[1e3*60*5,1e3*60*30,1e3*60*60,1e3*60*60*6,1e3*60*60*24,1e3*60*60*24*3,1e3*60*60*24*7,0],_e={0:"Forever",3e5:"5 minutes",18e5:"30 minutes",36e5:"1 hour",216e5:"6 hours",864e5:"1 day",2592e5:"3 days",6048e5:"1 week"};function cn({account:e,fetchAccount:n=()=>{},standalone:r,instance:i,authenticated:o}){const[s,c]=C("default"),a=typeof e=="string",[h,d]=C(a?null:e);_(()=>{if(!a){d(e);return}c("loading"),(async()=>{try{const G=await n();T.accounts[`${G.id}@${i}`]=G,d(G),c("default")}catch{d(null),c("error")}})()},[a,e,n]);const{acct:l,avatar:p,avatarStatic:g,bot:u,createdAt:m,displayName:b,emojis:f,fields:y,followersCount:k,followingCount:S,group:v,id:L,lastStatusAt:N,locked:R,note:x,statusesCount:K,url:F,username:E,memorial:U}=h||{};let Q=!1,{header:W,headerStatic:ut}=h||{};(!W||/missing\.png$/.test(W))&&p&&!/missing\.png$/.test(p)&&(W=p,Q=!0,g&&!/missing\.png$/.test(g)&&(ut=g));const[lt,tt]=C([]);return t("div",{class:`account-container  ${s==="loading"?"skeleton":""}`,style:{"--header-color-1":lt[0],"--header-color-2":lt[1],"--header-color-3":lt[2],"--header-color-4":lt[3]},children:[s==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to load account."}),t("p",{children:t("a",{href:e,target:"_blank",children:["Go to account page ",t(w,{icon:"external"})]})})]}),s==="loading"?t($,{children:[t("header",{children:t(zt,{avatarSize:"xxxl",skeleton:!0})}),t("main",{children:[t("div",{class:"note",children:[t("p",{children:"████████ ███████"}),t("p",{children:"███████████████ ███████████████"})]}),t("p",{class:"stats",children:[t("div",{children:[t("span",{children:"██"})," Followers"]}),t("div",{children:[t("span",{children:"██"})," Following"]}),t("div",{children:[t("span",{children:"██"})," Posts"]}),t("div",{children:"Joined ██"})]})]})]}):h&&t($,{children:[W&&!/missing\.png$/.test(W)&&t("img",{src:W,alt:"",class:`header-banner ${Q?"header-is-avatar":""}`,onError:G=>{G.target.crossOrigin?G.target.src!==ut?G.target.src=ut:(G.target.removeAttribute("crossorigin"),G.target.src=W):G.target.src!==ut?G.target.src=ut:G.target.remove()},crossOrigin:"anonymous",onLoad:G=>{G.target.classList.add("loaded");try{const ft=document.createElement("canvas"),at=ft.getContext("2d");ft.width=G.target.width,ft.height=G.target.height,at.drawImage(G.target,0,0);const D=10,ct=[at.getImageData(0,0,D,D).data,at.getImageData(G.target.width-D,0,D,D).data,at.getImageData(0,G.target.height-D,D,D).data,at.getImageData(G.target.width-D,G.target.height-D,D,D).data].map(nt=>{let kt=0,pt=0,q=0,A=0;for(let M=0;M<nt.length;M+=4)kt+=nt[M],pt+=nt[M+1],q+=nt[M+2],A+=nt[M+3];const I=nt.length/4;return[kt/I,pt/I,q/I,A/I]}).map(nt=>{const[kt,pt,q,A]=ts(nt);return`rgba(${kt}, ${pt}, ${q}, ${A})`});tt(ct)}catch{}}}),t("header",{children:t(zt,{account:h,instance:i,avatarSize:"xxxl",external:r,internal:!r})}),t("main",{tabIndex:"-1",children:[!!U&&t("span",{class:"tag",children:"In Memoriam"}),!!u&&t("span",{class:"tag",children:[t(w,{icon:"bot"})," Automated"]}),!!v&&t("span",{class:"tag",children:[t(w,{icon:"group"})," Group"]}),t("div",{class:"note",onClick:We({instance:i}),dangerouslySetInnerHTML:{__html:pe(x,{emojis:f})}}),(y==null?void 0:y.length)>0&&t("div",{class:"profile-metadata",children:y.map(({name:G,value:ft,verifiedAt:at},D)=>t("div",{class:`profile-field ${at?"profile-verified":""}`,children:[t("b",{children:[t(Ke,{text:G,emojis:f})," ",!!at&&t(w,{icon:"check-circle",size:"s"})]}),t("p",{dangerouslySetInnerHTML:{__html:pe(ft,{emojis:f})}})]},G+D))}),t("p",{class:"stats",children:[t("div",{children:[t("span",{title:k,children:Rt(k)})," ","Followers"]}),t("div",{class:"insignificant",children:[t("span",{title:S,children:Rt(S)})," ","Following",t("br",{})]}),r?t("div",{class:"insignificant",children:[t("span",{title:K,children:Rt(K)})," ","Posts"]}):t(H,{class:"insignificant",to:i?`/${i}/a/${L}`:`/a/${L}`,onClick:()=>{Cn()},children:[t("span",{title:K,children:Rt(K)})," ","Posts"]}),!!m&&t("div",{class:"insignificant",children:["Joined"," ",t("time",{datetime:m,children:Et(m,{hideTime:!0})})]})]}),t(Qn,{info:h,instance:i,authenticated:o})]})]})]})}function Qn({info:e,instance:n,authenticated:r}){var q;if(!e)return null;const{masto:i,instance:o,authenticated:s}=B(),c=n===o,[a,h]=C("default"),[d,l]=C(null),[p,g]=C([]),{id:u,acct:m,url:b,username:f,locked:y,lastStatusAt:k,note:S,fields:v}=e,L=P(u),{following:N,showingReblogs:R,notifying:x,followedBy:K,blocking:F,blockedBy:E,muting:U,mutingNotifications:Q,requested:W,domainBlocking:ut,endorsed:lt}=d||{},[tt,G]=C(null),[ft,at]=C(!1);_(()=>{if(e){const A=J.session.get("currentAccount");let I;(async()=>{if(c&&r)I=u;else if(!c&&s){const Y=e.acct.includes("@");try{const X=await i.v2.search({q:Y?e.acct:`${e.username}@${n}`,type:"accounts",limit:1,resolve:!0});X.accounts.length&&(I=X.accounts[0].id,G(X.accounts[0]))}catch{}}if(!I)return;if(A===I){at(!0);return}L.current=I,h("loading"),g([]);const M=i.v1.accounts.fetchRelationships([I]),O=i.v1.accounts.fetchFamiliarFollowers(I);try{const Y=await M;if(Y.length){const X=Y[0];if(l(X),!X.following)try{const j=await O;g(j[0].accounts.slice(0,10))}catch{}}h("default")}catch{h("error")}})()}},[e,r]),_(()=>{e&&ft&&xn(e)},[e,ft]);const D=a==="loading",et=P(null),[ct,nt]=C(!1),[kt,pt]=C(!1);return t($,{children:[t("div",{class:"common-followers shazam-container no-animation",hidden:!(p!=null&&p.length),children:t("div",{class:"shazam-container-inner",children:t("p",{children:["Followed by"," ",t("span",{class:"ib",children:p.map(A=>t("a",{href:A.url,rel:"noopener noreferrer",onClick:I=>{I.preventDefault(),T.showAccount={account:A,instance:n}},children:t(Ft,{url:A.avatarStatic,size:"l",alt:`${A.displayName} @${A.acct}`,squircle:A==null?void 0:A.bot})}))})]})})}),t("p",{class:"actions",children:[t("span",{children:[K?t("span",{class:"tag",children:"Following you"}):k?t("small",{class:"insignificant",children:["Last post:"," ",Et(k,{hideTime:!0})]}):t("span",{}),U&&t("span",{class:"tag danger",children:"Muted"}),F&&t("span",{class:"tag danger",children:"Blocked"})]})," ",t("span",{class:"buttons",children:[t(Bt,{instanceRef:et,portal:{target:document.body},containerProps:{style:{zIndex:1001},onClick:A=>{var I,M;A.target===A.currentTarget&&((M=(I=et.current)==null?void 0:I.closeMenu)==null||M.call(I))}},align:"center",position:"anchor",overflow:"auto",boundingBoxPadding:"8 8 8 8",menuButton:t("button",{type:"button",title:"More",class:"plain",disabled:D,children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[s&&!ft&&t($,{children:[t(Z,{onClick:()=>{T.showCompose={draftStatus:{status:`@${(tt==null?void 0:tt.acct)||m} `}}},children:[t(w,{icon:"at"}),t("span",{children:["Mention @",f]})]}),t(Z,{onClick:()=>{nt(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate bio"})]}),N&&t(Z,{onClick:()=>{pt(!0)},children:[t(w,{icon:"list"}),t("span",{children:"Add/remove from Lists"})]}),t(xt,{})]}),t(Z,{href:b,target:"_blank",children:[t(w,{icon:"external"}),t("small",{class:"menu-double-lines",children:es(b)})]}),t("div",{class:"menu-horizontal",children:[t(Z,{onClick:()=>{try{navigator.clipboard.writeText(b),ot("Link copied")}catch{ot("Unable to copy link")}},children:[t(w,{icon:"link"}),t("span",{children:"Copy"})]}),(navigator==null?void 0:navigator.share)&&((q=navigator==null?void 0:navigator.canShare)==null?void 0:q.call(navigator,{url:b}))&&t(Z,{onClick:()=>{try{navigator.share({url:b})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"}),t("span",{children:"Share…"})]})]}),!!d&&t($,{children:[t(xt,{}),U?t(Z,{onClick:()=>{h("loading"),(async()=>{try{const A=await i.v1.accounts.unmute((tt==null?void 0:tt.id)||u);l(A),h("default"),ot(`Unmuted @${f}`)}catch{h("error")}})()},children:[t(w,{icon:"unmute"}),t("span",{children:["Unmute @",f]})]}):t(Fn,{openTrigger:"clickOnly",direction:"bottom",overflow:"auto",shift:16,label:t($,{children:[t(w,{icon:"mute"}),t("span",{class:"menu-grow",children:["Mute @",f,"…"]}),t("span",{style:{textOverflow:"clip"},children:[t(w,{icon:"time"}),t(w,{icon:"chevron-right"})]})]}),children:t("div",{class:"menu-wrap",children:Zn.map(A=>t(Z,{onClick:()=>{h("loading"),(async()=>{try{const I=await i.v1.accounts.mute((tt==null?void 0:tt.id)||u,{duration:A});l(I),h("default"),ot(`Muted @${f} for ${_e[A]}`)}catch{h("error"),ot(`Unable to mute @${f}`)}})()},children:_e[A]}))})}),t(At,{subMenu:!0,confirm:!F,confirmLabel:t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",f,"?"]})]}),menuItemClassName:"danger",onClick:()=>{h("loading"),(async()=>{try{if(F){const A=await i.v1.accounts.unblock((tt==null?void 0:tt.id)||u);l(A),h("default"),ot(`Unblocked @${f}`)}else{const A=await i.v1.accounts.block((tt==null?void 0:tt.id)||u);l(A),h("default"),ot(`Blocked @${f}`)}}catch{h("error"),F?ot(`Unable to unblock @${f}`):ot(`Unable to block @${f}`)}})()},children:F?t($,{children:[t(w,{icon:"unblock"}),t("span",{children:["Unblock @",f]})]}):t($,{children:[t(w,{icon:"block"}),t("span",{children:["Block @",f,"…"]})]})})]})]}),!d&&a==="loading"&&t(wt,{abrupt:!0}),!!d&&t(At,{confirm:N||W,confirmLabel:t("span",{children:W?"Withdraw follow request?":`Unfollow @${e.acct||e.username}?`}),menuItemClassName:"danger",align:"end",disabled:D,onClick:()=>{h("loading"),(async()=>{try{let A;N||W?A=await i.v1.accounts.unfollow(L.current):A=await i.v1.accounts.follow(L.current),A&&l(A),h("default")}catch(A){alert(A),h("error")}})()},children:t("button",{type:"button",class:`${N||W?"light swap":""}`,"data-swap-state":N||W?"danger":"",disabled:D,children:N?t($,{children:[t("span",{children:"Following"}),t("span",{children:"Unfollow…"})]}):W?t($,{children:[t("span",{children:"Requested"}),t("span",{children:"Withdraw…"})]}):y?t($,{children:[t(w,{icon:"lock"})," ",t("span",{children:"Follow"})]}):"Follow"})})]})]}),!!ct&&t(bt,{class:"light",onClick:A=>{A.target===A.currentTarget&&nt(!1)},children:t(ns,{note:S,fields:v,onClose:()=>nt(!1)})}),!!kt&&t(bt,{class:"light",onClick:A=>{A.target===A.currentTarget&&pt(!1)},children:t(ss,{accountID:L.current,onClose:()=>pt(!1)})})]})}function ts([e,n,r]){const i=.2126*e+.7152*n+.0722*r;let o;return i>=220?o=1:i<=50?o=.1:o=i/255,o=Math.min(1,o),[e,n,r,o]}function es(e){if(!e)return;const n=new URL(e),{host:r,pathname:i}=n,o=i.replace(/\/$/,"").replace(/^\//,"");return t($,{children:[t("span",{class:"more-insignificant",children:[r,"/"]}),t("wbr",{}),t("span",{children:o})]})}function ns({note:e,fields:n,onClose:r}){const i=(n==null?void 0:n.map(({name:s,value:c})=>`${s}
${Ae(c)}`).join(`

`))||"",o=Ae(e)+(i?`

${i}`:"");return t("div",{class:"sheet",children:[!!r&&t("button",{type:"button",class:"sheet-close",onClick:r,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Translated Bio"})}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:o}),t(Ge,{forceTranslate:!0,text:o})]})]})}function ss({accountID:e,onClose:n}){const{masto:r}=B(),[i,o]=C("default"),[s,c]=C([]),[a,h]=C([]),[d,l]=ce(u=>u+1,0);_(()=>{o("loading"),(async()=>{try{const u=await r.v1.lists.list(),m=await r.v1.accounts.listLists(e);c(u),h(m),o("default")}catch{o("error")}})()},[d]);const[p,g]=C(!1);return t("div",{class:"sheet",id:"list-add-remove-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Add/Remove from Lists"})}),t("main",{children:[s.length>0?t("ul",{class:"list-add-remove",children:s.map(u=>{const m=a.some(b=>b.id===u.id);return t("li",{children:t("button",{type:"button",class:`light ${m?"checked":""}`,disabled:i==="loading",onClick:()=>{o("loading"),(async()=>{try{m?await r.v1.lists.removeAccount(u.id,{accountIds:[e]}):await r.v1.lists.addAccount(u.id,{accountIds:[e]}),l()}catch{o("error"),alert(m?"Unable to remove from list.":"Unable to add to list.")}})()},children:[t(w,{icon:"check-circle"}),t("span",{children:u.title})]})})})}):i==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):i==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists."}),t("button",{type:"button",class:"plain2",onClick:()=>g(!0),disabled:i!=="default",children:[t(w,{icon:"plus",size:"l"})," ",t("span",{children:"New list"})]})]}),p&&t(bt,{class:"light",onClick:u=>{u.target===u.currentTarget&&g(!1)},children:t(Te,{list:p==null?void 0:p.list,onClose:u=>{u.state==="success"&&l(),g(!1)}})})]})}function is({account:e,instance:n,onClose:r}){const{masto:i,instance:o,authenticated:s}=B({instance:n}),c=typeof e=="string",a=Ct("esc",r,[r]);return _(()=>{c||(T.accounts[`${e.id}@${o}`]=e)},[e]),t("div",{ref:a,class:"sheet",onClick:h=>{h.target.closest(".account-block")&&r({destination:"account-statuses"})},children:[!!r&&t("button",{type:"button",class:"sheet-close outer",onClick:r,children:t(w,{icon:"x"})}),t(cn,{instance:o,authenticated:s,account:e,fetchAccount:async()=>{if(c)try{return await i.v1.accounts.lookup({acct:e,skip_webfinger:!1})}catch{const d=await i.v2.search({q:e,type:"accounts",limit:1,resolve:s});if(d.accounts.length)return d.accounts[0]}else return e}})]})}function ie(e=()=>{},n=[]){const r=P(e);_(()=>{r.current=e},[n]),_(()=>{const i=()=>{const o=document.hidden||document.visibilityState==="hidden";r.current(!o)};return document.addEventListener("visibilitychange",i),()=>document.removeEventListener("visibilitychange",i)},[])}function os({isLoggedIn:e}){const[n,r]=C(!0);ie(r);const i=P();_(()=>{if(e&&n){const{masto:c,instance:a}=B();(async()=>{if(T.notificationsLast){const h=c.v1.notifications.list({limit:1,since_id:T.notificationsLast.id}),{value:d}=await h.next();d!=null&&d.length&&(T.notificationsShowNew=!0)}i.current=await c.ws.stream("/api/v1/streaming",{stream:"user:notification"}),i.current.on("notification",h=>{h.status&&vt(h.status,a,{skipThreading:!0}),T.notificationsShowNew=!0}),i.current.ws.onclose=()=>{}})()}return()=>{i.current&&(i.current.ws.close(),i.current=null)}},[n,e]);const o=P(),s=()=>{o.current=Date.now(),fetch("./version.json").then(c=>c.json()).then(c=>{c&&(T.appVersion=c)}).catch(c=>{})};return Je(s,n&&1e3*60*30),ie(c=>{c&&(o.current?Date.now()-o.current>1e3*60*60&&s():s())}),null}function cs(){function e(n){n.shiftKey?$n()||(alert("Looks like your browser is blocking popups."),T.showCompose=!0):T.showCompose=!0}return Ct("c, shift+c",e,{ignoreEventWhen:n=>!!document.querySelector("#modal-container > *")}),t("button",{type:"button",id:"compose-button",onClick:e,children:t(w,{icon:"quill",size:"xl",alt:"Compose"})})}function as({onClose:e}){const{masto:n}=B(),[r,i]=C("default"),[o,s]=C([]),[c,a]=ce(d=>d+1,0);_(()=>{i("loading"),(async()=>{try{const d=await Kt.drafts.keys();if(d.length){const l=Ye(),p=d.filter(g=>g.startsWith(l));if(p.length){const g=await Kt.drafts.getMany(p);g.sort((u,m)=>new Date(m.updatedAt).getTime()-new Date(u.updatedAt).getTime()),s(g)}else s([])}else s([]);i("default")}catch{i("error")}})()},[c]);const h=(o==null?void 0:o.length)>0;return t("div",{class:"sheet",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:[t("h2",{children:["Unsent drafts ",t(wt,{abrupt:!0,hidden:r!=="loading"})]}),h&&t("div",{class:"insignificant",children:"Looks like you have unsent drafts. Let's continue where you left off."})]}),t("main",{children:h?t($,{children:[t("ul",{class:"drafts-list",children:o.map(d=>{const{updatedAt:l,key:p,draftStatus:g,replyTo:u}=d,m=new Date(l);return t("li",{children:[t("div",{class:"mini-draft-meta",children:[t("b",{children:[t(w,{icon:u?"reply":"quill",size:"s"})," ",t("time",{children:[!!u&&t($,{children:["@",u.account.acct,t("br",{})]}),Et(m)]})]}),t(At,{confirmLabel:t("span",{children:"Delete this draft?"}),menuItemClassName:"danger",align:"end",disabled:r==="loading",onClick:()=>{(async()=>{try{await Kt.drafts.del(p),a()}catch{alert("Error deleting draft! Please try again.")}})()},children:t("button",{type:"button",class:"small light",disabled:r==="loading",children:"Delete…"})})]}),t("button",{type:"button",disabled:r==="loading",class:"draft-item",onClick:async()=>{let b;if(u){i("loading");try{b=await n.v1.statuses.fetch(u.id)}catch{alert("Error fetching reply-to status!"),i("default");return}i("default")}window.__COMPOSE__={draftStatus:g,replyToStatus:b},T.showCompose=!0,T.showDrafts=!1},children:t(ls,{draft:d})})]},l)})}),o.length>1&&t("p",{children:t(At,{confirmLabel:t("span",{children:"Delete all drafts?"}),menuItemClassName:"danger",disabled:r==="loading",onClick:()=>{(async()=>{i("loading");try{await Kt.drafts.delMany(o.map(d=>d.key)),i("default"),a()}catch{alert("Error deleting drafts! Please try again."),i("error")}})()},children:t("button",{type:"button",class:"light danger",disabled:r==="loading",children:"Delete all…"})})})]}):t("p",{children:"No drafts found."})})]})}function ls({draft:e}){var p;const{draftStatus:n,replyTo:r}=e,{status:i,spoilerText:o,poll:s,mediaAttachments:c}=n,a=((p=s==null?void 0:s.options)==null?void 0:p.length)>0,h=(c==null?void 0:c.length)>0,d=a||h,l=yt(()=>{if(!h)return;const g=c.find(b=>/image/.test(b.type));if(!g)return;const{file:u}=g;return URL.createObjectURL(u)},[h,c]);return t($,{children:t("div",{class:"mini-draft",children:[d&&t("div",{class:`mini-draft-aside ${l?"has-image":""}`,style:l?{"--bg-image":`url(${l})`}:{},children:[a&&t(w,{icon:"poll"}),h&&t("span",{children:[t(w,{icon:"attachment"})," ",t("small",{children:c==null?void 0:c.length})]})]}),t("div",{class:"mini-draft-main",children:[!!o&&t("div",{class:"mini-draft-spoiler",children:o}),!!i&&t("div",{class:"mini-draft-status",children:i})]})]})})}function an({mediaAttachments:e,statusID:n,instance:r,index:i=0,onClose:o=()=>{}}){var m,b;const s=P(null),[c,a]=C(i),h=P(null);Nt(()=>{var f;(f=h.current)==null||f.scrollIntoView()},[]);const d=P(n);_(()=>{const f=i*s.current.clientWidth,y=d.current!==n;y&&(d.current=n),s.current.scrollTo({left:f,behavior:y?"auto":"smooth"}),s.current.focus()},[i,n]);const[l,p]=C(!0);_(()=>{let f=()=>{o()};return s.current&&s.current.addEventListener("swiped-down",f),()=>{s.current&&s.current.removeEventListener("swiped-down",f)}},[]),Ct("esc",o,[o]);const[g,u]=C(!1);return _(()=>{let f=()=>{const{clientWidth:y,scrollLeft:k}=s.current,S=Math.round(k/y);a(S)};return s.current&&s.current.addEventListener("scroll",f,{passive:!0}),()=>{s.current&&s.current.removeEventListener("scroll",f)}},[]),_(()=>{let f=setTimeout(()=>{var y,k;(k=(y=s.current)==null?void 0:y.focus)==null||k.call(y)},100);return()=>clearTimeout(f)},[]),t("div",{class:"media-modal-container",children:[t("div",{ref:s,tabIndex:"0","data-swipe-threshold":"44",class:"carousel",onClick:f=>{(f.target.classList.contains("carousel-item")||f.target.classList.contains("media")||f.target.classList.contains("media-zoom"))&&o()},children:e==null?void 0:e.map((f,y)=>{const{blurhash:k}=f,S=k?Bn(k):null;return t("div",{class:"carousel-item",style:{"--average-color":`rgb(${S==null?void 0:S.join(",")})`,"--average-color-alpha":`rgba(${S==null?void 0:S.join(",")}, .5)`},tabindex:"0",ref:y===c?h:null,onClick:v=>{v.target!==v.currentTarget&&p(!l)},children:[!!f.description&&t("button",{type:"button",class:"media-alt",hidden:!l,onClick:()=>{u(f.description)},children:[t(w,{icon:"info"}),t("span",{class:"media-alt-desc",children:f.description})]}),t(Ln,{media:f,showOriginal:!0})]},f.id)})}),t("div",{class:"carousel-top-controls",hidden:!l,children:[t("span",{children:t("button",{type:"button",class:"carousel-button",onClick:()=>o(),children:t(w,{icon:"x"})})}),(e==null?void 0:e.length)>1?t("span",{class:"carousel-dots",children:e==null?void 0:e.map((f,y)=>t("button",{type:"button",disabled:y===c,class:`carousel-dot ${y===c?"active":""}`,onClick:k=>{k.preventDefault(),k.stopPropagation(),s.current.scrollTo({left:s.current.clientWidth*y,behavior:"smooth"}),s.current.focus()},children:t(w,{icon:"round",size:"s"})},f.id))}):t("span",{}),t("span",{children:[t(Bt,{overflow:"auto",align:"end",position:"anchor",boundingBoxPadding:"8 8 8 8",gap:4,menuClassName:"glass-menu",menuButton:t("button",{type:"button",class:"carousel-button",children:t(w,{icon:"more",alt:"More"})}),children:t(Tt,{href:((m=e[c])==null?void 0:m.remoteUrl)||((b=e[c])==null?void 0:b.url),class:"carousel-button",target:"_blank",title:"Open original media in new window",children:[t(w,{icon:"popout"}),t("span",{children:"Open original media"})]})})," ",t(H,{to:`${r?`/${r}`:""}/s/${n}${window.matchMedia("(min-width: calc(40em + 350px))").matches?`?media=${c+1}`:""}`,class:"button carousel-button media-post-link",children:[t("span",{class:"button-label",children:"See post "}),"»"]})]})]}),(e==null?void 0:e.length)>1&&t("div",{class:"carousel-controls",hidden:!l,children:[t("button",{type:"button",class:"carousel-button",hidden:c===0,onClick:f=>{f.preventDefault(),f.stopPropagation(),s.current.focus(),s.current.scrollTo({left:s.current.clientWidth*(c-1),behavior:"smooth"})},children:t(w,{icon:"arrow-left"})}),t("button",{type:"button",class:"carousel-button",hidden:c===e.length-1,onClick:f=>{f.preventDefault(),f.stopPropagation(),s.current.focus(),s.current.scrollTo({left:s.current.clientWidth*(c+1),behavior:"smooth"})},children:t(w,{icon:"arrow-right"})})]}),!!g&&t(bt,{class:"light",onClick:f=>{f.target===f.currentTarget&&(u(!1),s.current.focus())},children:t(rs,{alt:g,onClose:()=>u(!1)})})]})}function rs({alt:e,onClose:n}){const[r,i]=C(!1);return t("div",{class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close outer",onClick:n,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:[t("h2",{children:"Media description"}),t("div",{class:"header-side",children:t(Bt,{align:"end",menuButton:t("button",{type:"button",class:"plain4",children:t(w,{icon:"more",alt:"More",size:"xl"})}),children:t(Z,{disabled:r,onClick:()=>{i(!0)},children:[t(w,{icon:"translate"}),t("span",{children:"Translate"})]})})})]}),t("main",{children:[t("p",{style:{whiteSpace:"pre-wrap"},children:e}),r&&t(Ge,{forceTranslate:r,text:e})]})]})}function me({accountID:e,onChange:n}){const{masto:r}=B(),[i,o]=C("default"),[s,c]=C(null),[a,h]=C(null),d=a!==null;return t("p",{class:"follow-request-buttons",children:[t("button",{type:"button",disabled:i==="loading",onClick:()=>{o("loading"),c("accept"),(async()=>{try{const l=await r.v1.followRequests.authorize(e);if(!(l!=null&&l.followedBy))throw new Error("Follow request not accepted");h(l),n()}catch{}o("default")})()},children:"Accept"})," ",t("button",{type:"button",disabled:i==="loading",class:"light danger",onClick:()=>{o("loading"),c("reject"),(async()=>{try{const l=await r.v1.followRequests.reject(e);if(l!=null&&l.followedBy)throw new Error("Follow request not rejected");h(l),n()}catch{o("default")}})()},children:"Reject"}),t("span",{class:"follow-request-states",children:d&&s?s==="accept"?t(w,{icon:"check-circle",alt:"Accepted",class:"follow-accepted"}):t(w,{icon:"x-circle",alt:"Rejected",class:"follow-rejected"}):t(wt,{hidden:i!=="loading"})})]})}const ze={mention:"comment",status:"notification",reblog:"rocket",follow:"follow",follow_request:"follow-add",favourite:"heart",poll:"poll",update:"pencil","admin.signup":"account-edit","admin.report":"account-warning"},Ht={mention:"mentioned you in their post.",status:"published a post.",reblog:"boosted your post.","reblog+account":e=>`boosted ${e} of your posts.`,reblog_reply:"boosted your reply.",follow:"followed you.",follow_request:"requested to follow you.",favourite:"favourited your post.","favourite+account":e=>`favourited ${e} of your posts.`,favourite_reply:"favourited your reply.",poll:"A poll you have voted in or created has ended.","poll-self":"A poll you have created has ended.","poll-voted":"A poll you have voted in has ended.",update:"A post you interacted with has been edited.","favourite+reblog":"boosted & favourited your post.","favourite+reblog+account":e=>`boosted & favourited ${e} of your posts.`,"favourite+reblog_reply":"boosted & favourited your reply.","admin.signup":"signed up.","admin.report":"reported a post."};function Ce({notification:e,instance:n,reload:r,isStatic:i}){var v,L,N,R;const{id:o,status:s,account:c,_accounts:a,_statuses:h}=e;let{type:d}=e;const l=(s==null?void 0:s.reblog)||s,p=l==null?void 0:l.id,g=J.session.get("currentAccount"),u=g===(c==null?void 0:c.id),m=(v=s==null?void 0:s.poll)==null?void 0:v.voted,b=!!(s!=null&&s.inReplyToAccountId)&&(s==null?void 0:s.inReplyToAccountId)!==g&&((L=s==null?void 0:s.account)==null?void 0:L.id)===g;let f=0,y=0;if(d==="favourite+reblog"){for(const x of a)(N=x._types)!=null&&N.includes("favourite")&&f++,(R=x._types)!=null&&R.includes("reblog")&&y++;!y&&f&&(d="favourite"),!f&&y&&(d="reblog")}let k;if(d==="poll"?k=Ht[u?"poll-self":m?"poll-voted":"poll"]:d==="reblog"||d==="favourite"||d==="favourite+reblog"?(h==null?void 0:h.length)>1?k=Ht[`${d}+account`]:b?k=Ht[`${d}_reply`]:k=Ht[d]:Ht[d]?k=Ht[d]:k=`[Unknown notification type: ${d}]`,typeof k=="function"&&(k=k((h==null?void 0:h.length)||(a==null?void 0:a.length))),d==="mention"&&!s)return null;const S=e.createdAt&&new Date(e.createdAt).toLocaleString();return t("div",{class:`notification notification-${d}`,tabIndex:"0",children:[t("div",{class:`notification-type notification-${d}`,title:S,children:d==="favourite+reblog"?t($,{children:[t(w,{icon:"rocket",size:"xl",alt:d,class:"reblog-icon"}),t(w,{icon:"heart",size:"xl",alt:d,class:"favourite-icon"})]}):t(w,{icon:ze[d]||"notification",size:"xl",alt:d})}),t("div",{class:"notification-content",children:[d!=="mention"&&t($,{children:[t("p",{children:[!/poll|update/i.test(d)&&t($,{children:(a==null?void 0:a.length)>1?t($,{children:[t("b",{children:[a.length," people"]})," "]}):t($,{children:[t(ve,{account:c,showAvatar:!0})," "]})}),k,d==="mention"&&t("span",{class:"insignificant",children:[" ","•"," ",t(Se,{datetime:e.createdAt,format:"micro"})]})]}),d==="follow_request"&&t(me,{accountID:c.id,onChange:()=>{}})]}),(a==null?void 0:a.length)>1&&t("p",{class:"avatars-stack",children:a.map((x,K)=>t($,{children:[t("a",{href:x.url,rel:"noopener noreferrer",class:"account-avatar-stack",onClick:F=>{F.preventDefault(),T.showAccount=x},children:[t(Ft,{url:x.avatarStatic,size:a.length<=10?"xxl":a.length<100?"xl":a.length<1e3?"l":a.length<2e3?"m":"s",alt:`${x.displayName} @${x.acct}`,squircle:x==null?void 0:x.bot},x.id),d==="favourite+reblog"&&t("div",{class:"account-sub-icons",children:x._types.map(F=>t(w,{icon:ze[F],size:"s",class:`${F}-icon`}))})]})," "]}))}),(h==null?void 0:h.length)>1&&t("ul",{class:"notification-group-statuses",children:h.map(x=>t("li",{children:t(H,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${x.id}`:`/s/${x.id}`,children:t(gt,{status:x,size:"s"})})},x.id))}),s&&(!(h!=null&&h.length)||(h==null?void 0:h.length)<=1)&&t(H,{class:`status-link status-type-${d}`,to:n?`/${n}/s/${p}`:`/s/${p}`,children:i?t(gt,{status:l,size:"s"}):t(gt,{statusID:p,size:"s"})})]})]})}function ds(){if(!("serviceWorker"in navigator))return null;const e=dt(T),{routeNotification:n}=e,{id:r,accessToken:i}=n||{},[o,s]=C(!1);Nt(()=>{if(!r||!i)return;const{instance:a}=B(),{masto:h,instance:d}=B({accessToken:i}),l=a===d,p=i?Rn(i):Vt();(async()=>{const g=await h.v1.notifications.fetch(r);if(g&&p){const u=p.instanceURL,{type:m,status:b,account:f}=g,y=!!document.querySelector("#modal-container > *"),k=m==="follow"&&!!(f!=null&&f.id),S=!!(f!=null&&f.id),v=!!(b!=null&&b.id);k&&l?T.showAccount={account:f,instance:u}:y||!l||S&&v?s({id:r,account:p,notification:g,sameInstance:l}):v?location.hash=`/${a}/s/${b.id}`:k?location.hash=`/${a}/a/${f.id}`:location.hash="/notifications"}})()},[r,i]),Nt(()=>{const a=h=>{const{type:d,id:l,accessToken:p}=(h==null?void 0:h.data)||{};d==="notification"&&(T.routeNotification={id:l,accessToken:p})};return navigator.serviceWorker.addEventListener("message",a),()=>{navigator.serviceWorker.removeEventListener("message",a)}},[]),ie(a=>{a&&(navigator!=null&&navigator.clearAppBadge)&&navigator.clearAppBadge()});const c=()=>{s(!1),T.routeNotification=null,/\/notifications\?id=/i.test(location.hash)&&(location.hash="/notifications")};if(o){const{id:a,account:h,notification:d,sameInstance:l}=o;return t(bt,{class:"light",onClick:p=>{p.target===p.currentTarget&&c()},children:t("div",{class:"sheet",tabIndex:"-1",children:[t("button",{type:"button",class:"sheet-close",onClick:c,children:t(w,{icon:"x"})}),t("header",{children:t("b",{children:"Notification"})}),t("main",{children:[!l&&t("p",{children:"This notification is from your other account."}),t("div",{class:"notification-peek",onClick:p=>{const{target:g}=p;(p.target.tagName==="BUTTON"||p.target.tagName==="A")&&c()},children:t(Ce,{instance:h.instanceURL,notification:d,isStatic:!0})}),t("div",{style:{textAlign:"end"},children:t(H,{to:"/notifications",class:"button light",onClick:c,children:[t("span",{children:"View all notifications"})," ",t(w,{icon:"arrow-right"})]})})]})]})})}return null}const ln=On((e,n)=>{const{instance:r}=B(),[i,o]=Mt(),[s,c]=C(!1),[a,h]=C(i.get("q")||""),d=i.get("type"),l=P(null),p=P(null);return qn(n,()=>({setValue:g=>{h(g)},focus:()=>{p.current.focus()},blur:()=>{p.current.blur()}})),t("form",{ref:l,class:"search-popover-container",onSubmit:g=>{var m;if(g.preventDefault(),/\/search/.test(location.hash))if(a){const b={q:a};d&&(b.type=d),o(b)}else o({});else a?location.hash=`/search?q=${encodeURIComponent(a)}${d?`&type=${d}`:""}`:location.hash="/search";(m=e==null?void 0:e.onSubmit)==null||m.call(e,g)},children:[t("input",{ref:p,value:a,name:"q",type:"search",placeholder:"Search",dir:"auto",onSearch:g=>{g.target.value||o({})},onInput:g=>{h(g.target.value),c(!0)},onFocus:()=>{c(!0)},onBlur:()=>{var g,u;setTimeout(()=>{c(!1)},100),(u=(g=l.current)==null?void 0:g.querySelector(".search-popover-item.focus"))==null||u.classList.remove("focus")},onKeyDown:g=>{var m;const{key:u}=g;switch(u){case"Escape":c(!1);break;case"Down":case"ArrowDown":if(g.preventDefault(),s){const b=l.current.querySelector(".search-popover-item.focus");if(b){let f=b.nextElementSibling;for(;f&&f.hidden;)f=f.nextElementSibling;f&&(f.classList.add("focus"),Array.from(f.parentElement.children).filter(k=>k!==f).forEach(k=>{k.classList.remove("focus")}))}else{const f=l.current.querySelector(".search-popover-item");f&&f.classList.add("focus")}}break;case"Up":case"ArrowUp":if(g.preventDefault(),s){const b=document.querySelector(".search-popover-item.focus");if(b){let f=b.previousElementSibling;for(;f&&f.hidden;)f=f.previousElementSibling;f&&(f.classList.add("focus"),Array.from(f.parentElement.children).filter(k=>k!==f).forEach(k=>{k.classList.remove("focus")}))}else{const f=document.querySelector(".search-popover-item:last-child");f&&f.classList.add("focus")}}break;case"Enter":if(s){const b=document.querySelector(".search-popover-item.focus");b&&(g.preventDefault(),b.click()),c(!1),(m=e==null?void 0:e.onSubmit)==null||m.call(e,g)}break}}}),t("div",{class:"search-popover",hidden:!s||!a,children:!!a&&[{label:t($,{children:["Posts with ",t("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=statuses`,hidden:/^https?:/.test(a)},{label:t($,{children:["Posts tagged with ",t("mark",{children:["#",a.replace(/^#/,"")]})]}),to:`/${r}/t/${a.replace(/^#/,"")}`,hidden:/^@/.test(a)||/^https?:/.test(a)||/\s/.test(a),top:/^#/.test(a),type:"link"},{label:t($,{children:["Look up ",t("mark",{children:a})]}),to:`/${a}`,hidden:!/^https?:/.test(a),top:/^https?:/.test(a),type:"link"},{label:t($,{children:["Accounts with ",t("q",{children:a})]}),to:`/search?q=${encodeURIComponent(a)}&type=accounts`}].sort((g,u)=>g.top&&!u.top?-1:!g.top&&u.top?1:0).map(({label:g,to:u,hidden:m,type:b})=>t(H,{to:u,class:"search-popover-item",hidden:m,onClick:f=>{var y;(y=e==null?void 0:e.onSubmit)==null||y.call(e,f)},children:[t(w,{icon:b==="link"?"arrow-right":"search",class:"more-insignificant"}),t("span",{children:g})," "]}))})]})});function us({onClose:e=()=>{}}){const[n,r]=C(!1),i=P(null);Ct("/",s=>{r(!0),setTimeout(()=>{var c,a;(a=(c=i.current)==null?void 0:c.focus)==null||a.call(c)},0)},{preventDefault:!0,ignoreEventWhen:s=>{const c=/\/search/.test(location.hash),a=!!document.querySelector("#modal-container > *");return c||a}});const o=()=>{r(!1),e()};return Ct("esc",s=>{var c,a;(a=(c=i.current)==null?void 0:c.blur)==null||a.call(c),o()},{enabled:n,enableOnFormTags:!0,preventDefault:!0}),t("div",{id:"search-command-container",hidden:!n,onClick:s=>{s.target===s.currentTarget&&o()},children:t(ln,{ref:i,onSubmit:()=>{o()}})})}const hs=""+new URL("floating-button-ef345856.svg",import.meta.url).href,fs=""+new URL("multi-column-d7f22033.svg",import.meta.url).href,ps=""+new URL("tab-menu-bar-0b1df8b5.svg",import.meta.url).href;function ge({children:e}){if(typeof e=="string")return e;const[n,r]=C("");return _(()=>{Promise.resolve(e).then(r)},[e]),n}const jt=9,ms=["following","mentions","notifications","list","public","trending","hashtag","bookmarks","favourites"],rn={following:"Home / Following",notifications:"Notifications",list:"List",public:"Public (Local / Federated)",search:"Search","account-statuses":"Account",bookmarks:"Bookmarks",favourites:"Favourites",hashtag:"Hashtag",trending:"Trending",mentions:"Mentions"},te={list:[{text:"List ID",name:"id"}],public:[{text:"Local only",name:"local",type:"checkbox"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],trending:[{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}],search:[{text:"Search term",name:"query",type:"text"}],"account-statuses":[{text:"@",name:"id",type:"text",placeholder:"cheeaun@mastodon.social"}],hashtag:[{text:"#",name:"hashtag",type:"text",placeholder:"e.g. PixelArt (Max 5, space-separated)",pattern:"[^#]+"},{text:"Instance",name:"instance",type:"text",placeholder:"Optional, e.g. mastodon.social",notRequired:!0}]},oe={following:{id:"home",title:(e,n)=>n===0?"Home":"Following",path:"/",icon:"home"},mentions:{id:"mentions",title:"Mentions",path:"/mentions",icon:"at"},notifications:{id:"notifications",title:"Notifications",path:"/notifications",icon:"notification"},list:{id:"list",title:Ne(async({id:e})=>(await B().masto.v1.lists.fetch(e)).title,{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/l/${e}`,icon:"list"},public:{id:"public",title:({local:e})=>e?"Local":"Federated",subtitle:({instance:e})=>e||B().instance,path:({local:e,instance:n})=>`/${n}/p${e?"/l":""}`,icon:({local:e})=>e?"group":"earth"},trending:{id:"trending",title:"Trending",subtitle:({instance:e})=>e||B().instance,path:({instance:e})=>`/${e}/trending`,icon:"chart"},search:{id:"search",title:({query:e})=>e,path:({query:e})=>`/search?q=${e}`,icon:"search"},"account-statuses":{id:"account-statuses",title:Ne(async({id:e})=>{const n=await B().masto.v1.accounts.fetch(e);return n.username||n.acct||n.displayName},{cacheKey:([{id:e}])=>e}),path:({id:e})=>`/a/${e}`,icon:"user"},bookmarks:{id:"bookmarks",title:"Bookmarks",path:"/b",icon:"bookmark"},favourites:{id:"favourites",title:"Favourites",path:"/f",icon:"heart"},hashtag:{id:"hashtag",title:({hashtag:e})=>e,subtitle:({instance:e})=>e||B().instance,path:({hashtag:e,instance:n})=>`${n?`/${n}`:""}/t/${e.split(/\s+/).join("+")}`,icon:"hashtag"}};function gs({onClose:e}){const n=dt(T),{masto:r}=B(),{shortcuts:i}=n,[o,s]=C([]),[c,a]=C([]),[h,d]=C(!1),[l,p]=C(!1);return _(()=>{(async()=>{try{const g=await r.v1.lists.list();s(g)}catch{}})(),(async()=>{try{const g=r.v1.followedTags.list(),u=[];do{const{value:m,done:b}=await g.next();if(b||(m==null?void 0:m.length)===0)break;u.push(...m)}while(!0);a(u)}catch{}})()},[]),t("div",{id:"shortcuts-settings-container",class:"sheet",tabindex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[t(w,{icon:"shortcut"})," Shortcuts"," ",t("sup",{style:{fontSize:12,opacity:.5,textTransform:"uppercase"},children:"beta"})]})}),t("main",{children:[t("p",{children:["Specify a list of shortcuts that'll appear as:",t("div",{class:"shortcuts-view-mode",children:[{value:"float-button",label:"Floating button",imgURL:hs},{value:"tab-menu-bar",label:"Tab/Menu bar",imgURL:ps},{value:"multi-column",label:"Multi-column",imgURL:fs}].map(({value:g,label:u,imgURL:m})=>t("label",{children:[t("input",{type:"radio",name:"shortcuts-view-mode",value:g,checked:n.settings.shortcutsViewMode===g||g==="float-button"&&!n.settings.shortcutsViewMode,onChange:b=>{T.settings.shortcutsViewMode=b.target.value}})," ",t("img",{src:m,alt:"",width:"80",height:"58"})," ",t("span",{children:u})]}))})]}),i.length>0?t("ol",{class:"shortcuts-list",children:i.filter(Boolean).map((g,u)=>{const m=u+Object.values(g),{type:b}=g;if(!oe[b])return null;let{icon:f,title:y,subtitle:k}=oe[b];return typeof y=="function"&&(y=y(g,u)),typeof k=="function"&&(k=k(g,u)),typeof f=="function"&&(f=f(g,u)),t("li",{children:[t(w,{icon:f}),t("span",{class:"shortcut-text",children:[t(ge,{children:y}),k&&t($,{children:[" ",t("small",{class:"ib insignificant",children:k})]})]}),t("span",{class:"shortcut-actions",children:[t("button",{type:"button",class:"plain small",disabled:u===0,onClick:()=>{const S=Array.from(T.shortcuts);if(u>0){const v=T.shortcuts[u-1];S[u-1]=g,S[u]=v,T.shortcuts=S}},children:t(w,{icon:"arrow-up",alt:"Move up"})}),t("button",{type:"button",class:"plain small",disabled:u===i.length-1,onClick:()=>{const S=Array.from(T.shortcuts);if(u<T.shortcuts.length-1){const v=T.shortcuts[u+1];S[u+1]=g,S[u]=v,T.shortcuts=S}},children:t(w,{icon:"arrow-down",alt:"Move down"})}),t("button",{type:"button",class:"plain small",onClick:()=>{d({shortcut:g,shortcutIndex:u})},children:t(w,{icon:"pencil",alt:"Edit"})})]})]},m)})}):t("div",{class:"ui-state insignificant",children:[t("p",{children:"No shortcuts yet. Tap on the Add shortcut button."}),t("p",{children:["Not sure what to add?",t("br",{}),"Try adding"," ",t("a",{href:"#",onClick:g=>{g.preventDefault(),T.shortcuts=[{type:"following"},{type:"notifications"}]},children:"Home / Following and Notifications"})," ","first."]})]}),t("p",{class:"insignificant",children:i.length>=jt&&`Max ${jt} shortcuts`}),t("p",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t("button",{type:"button",class:"light",onClick:()=>p(!0),children:"Import/export"}),t("button",{type:"button",disabled:i.length>=jt,onClick:()=>d(!0),children:[t(w,{icon:"plus"})," ",t("span",{children:"Add shortcut"})]})]})]}),h&&t(bt,{class:"light",onClick:g=>{g.target===g.currentTarget&&d(!1)},children:t(bs,{shortcut:h.shortcut,shortcutIndex:h.shortcutIndex,lists:o,followedHashtags:c,onSubmit:({result:g,mode:u})=>{u==="edit"?T.shortcuts[h.shortcutIndex]=g:T.shortcuts.push(g)},onClose:()=>d(!1)})}),l&&t(bt,{class:"light",onClick:g=>{g.target===g.currentTarget&&p(!1)},children:t(ys,{shortcuts:i,onClose:()=>p(!1)})})]})}function bs({lists:e,followedHashtags:n,onSubmit:r,disabled:i,shortcut:o,shortcutIndex:s,onClose:c}){var p,g;const a=!!o,[h,d]=C((o==null?void 0:o.type)||null),l=P();return _(()=>{if(a&&h&&te[h]){const u=l.current;te[h].forEach(({name:m,type:b})=>{const f=u.querySelector(`[name="${m}"]`);f&&o[m]&&(b==="checkbox"?f.checked=o[m]==="on":f.value=o[m])})}},[a,h]),t("div",{id:"shortcut-settings-form",class:"sheet",children:[!!c&&t("button",{type:"button",class:"sheet-close",onClick:c,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:[a?"Edit":"Add"," shortcut"]})}),t("main",{tabindex:"-1",children:t("form",{ref:l,onSubmit:u=>{u.preventDefault();const m=new FormData(u.target),b={};m.forEach((f,y)=>{b[y]=f==null?void 0:f.trim(),y==="instance"&&(b[y]=b[y].replace(/^https?:\/\//,"").replace(/\/+$/,""),b[y]=b[y].replace(/^@?[^@]+@/,""))}),b.type&&(r({result:b,mode:a?"edit":"add"}),u.target.reset(),d(null),c==null||c())},children:[t("p",{children:t("label",{children:[t("span",{children:"Timeline"}),t("select",{required:!0,disabled:i,onChange:u=>{d(u.target.value)},defaultValue:a?o.type:void 0,name:"type",children:[t("option",{}),ms.map(u=>t("option",{value:u,children:rn[u]}))]})]})}),(g=(p=te[h])==null?void 0:p.map)==null?void 0:g.call(p,({text:u,name:m,type:b,placeholder:f,pattern:y,notRequired:k})=>h==="list"?t("p",{children:t("label",{children:[t("span",{children:"List"}),t("select",{name:"id",required:!k,disabled:i,children:e.map(S=>t("option",{value:S.id,children:S.title}))})]})}):t("p",{children:t("label",{children:[t("span",{children:u})," ",t("input",{type:b,name:m,placeholder:f,required:b==="text"&&!k,disabled:i,list:h==="hashtag"?"followed-hashtags-datalist":null,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:y}),h==="hashtag"&&n.length>0&&t("datalist",{id:"followed-hashtags-datalist",children:n.map(S=>t("option",{value:S.name}))})]})})),t("footer",{children:[t("button",{type:"submit",class:"block",disabled:i,children:a?"Save":"Add"}),a&&t("button",{type:"button",class:"light danger",onClick:()=>{T.shortcuts.splice(s,1),c==null||c()},children:"Remove"})]})]})})]})}function ys({shortcuts:e,onClose:n}){var d;const r=yt(()=>!e||!e.filter(Boolean).length?"":Pe.compressToEncodedURIComponent(JSON.stringify(e.filter(Boolean))),[e]),[i,o]=C(""),[s,c]=C("default"),a=yt(()=>{if(!i)return c("default"),null;try{const l=JSON.parse(Pe.decompressFromEncodedURIComponent(i));if(!Array.isArray(l))throw new Error("Not an array");return c("default"),l}catch{try{const p=JSON.parse(i);if(!Array.isArray(p))throw new Error("Not an array");return c("default"),p}catch{return c("error"),null}}},[i]),h=T.shortcuts.length>0;return t("div",{id:"import-export-container",class:"sheet",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:["Import/Export ",t("small",{class:"ib insignificant",children:"Shortcuts"})]})}),t("main",{tabindex:"-1",children:[t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-down-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Import"})]}),t("p",{children:t("input",{type:"text",name:"import",placeholder:"Paste shortcuts here",class:"block",onInput:l=>{o(l.target.value)}})}),!!a&&Array.isArray(a)&&t($,{children:[t("p",{children:[t("b",{children:a.length})," shortcut",a.length>1?"s":""," ",t("small",{class:"insignificant",children:["(",i.length," characters)"]})]}),t("ol",{class:"import-settings-list",children:a.map(l=>{var p,g;return t("li",{children:[t("span",{style:{opacity:e.some(u=>Object.keys(u).every(m=>u[m]===l[m]))?1:0},children:"*"}),t("span",{children:[rn[l.type],l.type==="list"&&" ⚠️"," ",(g=(p=te[l.type])==null?void 0:p.map)==null?void 0:g.call(p,({text:u,name:m,type:b})=>l[m]?t($,{children:[t("span",{class:"tag collapsed insignificant",children:[u,":"," ",b==="checkbox"?l[m]==="on"?"✅":"❌":l[m]]})," "]}):null)]})]})})}),t("p",{children:[t("small",{children:"* Exists in current shortcuts"}),t("br",{}),t("small",{children:"⚠️ List may not work if it's from a different account."})]})]}),s==="error"&&t("p",{class:"error",children:t("small",{children:"⚠️ Invalid settings format"})}),t("p",{children:[h&&t($,{children:[t(At,{confirmLabel:"Append to current shortcuts?",menuFooter:t("div",{class:"footer",children:"Only shortcuts that don’t exist in current shortcuts will be appended."}),onClick:()=>{const l=a.filter(u=>!T.shortcuts.some(m=>Object.keys(m).every(b=>m[b]===u[b])));if(!l.length){ot("No new shortcuts to import");return}let p=[...T.shortcuts,...l];const g=p.length>jt;g&&(p=p.slice(0,jt)),T.shortcuts=p,ot(g?`Shortcuts imported. Exceeded max ${jt}, so the rest are not imported.`:"Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!a,children:"Import & append…"})})," "]}),t(At,{confirmLabel:h?"Override current shortcuts?":"Import shortcuts?",menuItemClassName:h?"danger":void 0,onClick:()=>{T.shortcuts=a,ot("Shortcuts imported"),n==null||n()},children:t("button",{type:"button",class:"plain2",disabled:!a,children:h?"or override…":"Import…"})})]})]}),t("section",{children:[t("h3",{children:[t(w,{icon:"arrow-up-circle",size:"l",class:"insignificant"})," ",t("span",{children:"Export"})]}),t("p",{children:t("input",{style:{width:"100%"},type:"text",value:r,readOnly:!0,onClick:l=>{if(l.target.value){l.target.select();try{navigator.clipboard.writeText(l.target.value),ot("Shortcuts copied")}catch{ot("Unable to copy shortcuts")}}}})}),t("p",{children:[t("button",{type:"button",class:"plain2",disabled:!r,onClick:()=>{try{navigator.clipboard.writeText(r),ot("Shortcut settings copied")}catch{ot("Unable to copy shortcut settings")}},children:[t(w,{icon:"clipboard"})," ",t("span",{children:"Copy"})]})," ",(navigator==null?void 0:navigator.share)&&((d=navigator==null?void 0:navigator.canShare)==null?void 0:d.call(navigator,{text:r}))&&t("button",{type:"button",class:"plain2",disabled:!r,onClick:()=>{try{navigator.share({text:r})}catch{alert("Sharing doesn't seem to work.")}},children:[t(w,{icon:"share"})," ",t("span",{children:"Share"})]})," ",r.length>0&&t("small",{class:"insignificant",children:[r.length," characters"]})]}),!!r&&t("details",{children:[t("summary",{class:"insignificant",children:t("small",{children:"Raw Shortcuts JSON"})}),t("textarea",{style:{width:"100%"},rows:10,readOnly:!0,children:JSON.stringify(e.filter(Boolean),null,2)})]})]})]})]})}function ws(){const{instance:e}=B(),n=dt(T),{shortcuts:r}=n;if(!r.length)return null;const i=P(),o=yt(()=>r.map((c,a)=>{const{type:h,...d}=c;if(!oe[h])return null;let{id:l,path:p,title:g,subtitle:u,icon:m}=oe[h];return typeof l=="function"&&(l=l(d,a)),typeof p=="function"&&(p=p({...d,instance:d.instance||e},a)),typeof g=="function"&&(g=g(d,a)),typeof u=="function"&&(u=u(d,a)),typeof m=="function"&&(m=m(d,a)),{id:l,path:p,title:g,subtitle:u,icon:m}}).filter(Boolean),[r]),s=tn();return Ct(["1","2","3","4","5","6","7","8","9"],(c,a)=>{var d,l;const h=parseInt(a.keys[0],10)-1;if(h<o.length){const{path:p}=o[h];p&&(s(p),(l=(d=i.current)==null?void 0:d.closeMenu)==null||l.call(d))}}),t("div",{id:"shortcuts",children:n.settings.shortcutsViewMode==="tab-menu-bar"?t("nav",{class:"tab-bar",children:t("ul",{children:o.map(({id:c,path:a,title:h,subtitle:d,icon:l},p)=>t("li",{children:t(H,{class:d?"has-subtitle":"",to:a,onClick:g=>{if(g.target.classList.contains("is-active")){g.preventDefault();const u=document.getElementById(`${c}-page`);if(u){u.scrollTop=0;const m=u.querySelector(".updates-button");m&&m.click()}}},children:[t(w,{icon:l,size:"xl",alt:h}),t("span",{children:[t(ge,{children:h}),d&&t($,{children:[t("br",{}),t("small",{children:d})]})]})]})},p+h))})}):t(Bt,{instanceRef:i,overflow:"auto",viewScroll:"close",boundingBoxPadding:"8 8 8 8",menuClassName:"glass-menu shortcuts-menu",gap:8,position:"anchor",menuButton:t("button",{type:"button",id:"shortcuts-button",class:"plain",onTransitionStart:c=>{var a,h;try{const{target:d}=c;getComputedStyle(d).pointerEvents==="none"&&((h=(a=i.current)==null?void 0:a.closeMenu)==null||h.call(a))}catch{}},children:t(w,{icon:"shortcut",size:"xl",alt:"Shortcuts"})}),children:o.map(({path:c,title:a,subtitle:h,icon:d},l)=>t(Tt,{to:c,class:"glass-menu-item",children:[t(w,{icon:d,size:"l"})," ",t("span",{class:"menu-grow",children:[t("span",{children:t(ge,{children:a})}),h&&t($,{children:[" ",t("small",{class:"more-insignificant",children:h})]})]}),t("span",{class:"menu-shortcut hide-until-focus-visible",children:l+1})]},l+a))})})}function Jt(e){const{containerProps:n}=e,r=Hn(),i=P();return t(Bt,{boundingBoxPadding:Xe(),repositionFlag:`${r.width}x${r.height}`,...e,instanceRef:i,containerProps:{onClick:o=>{var s,c,a;o.target===o.currentTarget&&((c=(s=i.current)==null?void 0:s.closeMenu)==null||c.call(s)),(a=n==null?void 0:n.onClick)==null||a.call(n,o)},...n}})}function vs(e){var o;let n=[],r=[],i=0;for(let s=0;s<e.length;s++){const c=e[s];c.reblog&&!((o=c.account)!=null&&o.group)?(r.push(c),i++):(n.push(c),i<3&&(i=0))}if(e.length>10&&(r.length>e.length/4||i>=3)){const s=r.map(c=>c.id);if(r.length>e.length*3/4)n=[...n,{id:s,items:r,type:"boosts"}];else{const c=Math.floor(n.length/2);n=[...n.slice(0,c),{id:s,items:r,type:"boosts"},...n.slice(c)]}return n}else return e}function Fe(e,n){const r=J.account.get("boostedStatusIDs")||{},i=e.filter(s=>{if(!s.reblog)return!0;const c=`${n}-${s.reblog.id}`,a=r[c];return a&&a!==s.id?!1:(r[c]=s.id,!0)}),o=Object.keys(r);return o.length>50&&o.slice(0,o.length-50).forEach(s=>{delete r[s]}),J.account.set("boostedStatusIDs",r),i}function Ss(e){const n=[];let r=0;e.forEach(s=>{for(let a=0;a<n.length;a++){if(n[a].find(h=>h.id===s.id))return;if(n[a].find(h=>h.id===s.inReplyToId)||n[a].find(h=>h.inReplyToId===s.id)){n[a].push(s);return}}const c=e.find(a=>a.id===s.inReplyToId);c&&(n[r++]=[s,c])});for(let s=0;s<n.length;s++)for(let c=s+1;c<n.length;c++)n[s].find(h=>n[c].includes(h))&&(n[s]=[...n[s],...n[c]],n[s]=n[s].filter((h,d,l)=>l.findIndex(p=>p.id===h.id)===d),n.splice(c,1),c--);n.forEach(s=>{s.sort((c,a)=>!c.inReplyToId&&!a.inReplyToId?new Date(c.createdAt)-new Date(a.createdAt):c.inReplyToId===a.id?1:a.inReplyToId===c.id||!c.inReplyToId?-1:a.inReplyToId?new Date(c.createdAt)-new Date(a.createdAt):1)}),n.forEach(s=>{const c=s[0].account.id;s.forEach(a=>{a.account.id!==c&&(a._differentAuthor=!0)})}),n.length;const i=[],o=[];return e.forEach(s=>{if(s.reblog){i.push(s);return}for(let c=0;c<n.length;c++)if(n[c].find(a=>a.id===s.id)){if(o.includes(c))return;const a=n[c];a.sort((d,l)=>{const p=new Date(d.createdAt),g=new Date(l.createdAt);return p-g});const h=a[0].account.id;i.push({id:a.map(d=>d.id),items:a,type:a.every(d=>d.account.id===h)?"thread":"conversation"}),o.push(c);return}i.push(s)}),i}function re({scrollableRef:e,distanceFromStart:n=1,distanceFromEnd:r=1,scrollThresholdStart:i=10,scrollThresholdEnd:o=10,direction:s="vertical",distanceFromStartPx:c,distanceFromEndPx:a}={}){const[h,d]=C(null),[l,p]=C(!1),[g,u]=C(!1),[m,b]=C(!1),[f,y]=C(!1),k=s==="vertical";return Nt(()=>{const S=e.current;if(!S)return{};let v=k?S.scrollTop:S.scrollLeft;function L(){const{scrollTop:N,scrollLeft:R,scrollHeight:x,scrollWidth:K,clientHeight:F,clientWidth:E}=S,U=k?N:R,Q=k?x:K,W=k?F:E,ut=Math.abs(U-v),lt=c||Math.min(W*n,Q,U),tt=a||Math.min(W*r,Q,Q-U-W);ut>=(v<U?o:i)&&(d(v<U?"end":"start"),v=U),p(U<=0),u(U+W>=Q),b(U<=lt),y(U+W>=Q-tt)}return S.addEventListener("scroll",L,{passive:!0}),()=>S.removeEventListener("scroll",L)},[n,r,i,o]),{scrollDirection:h,reachStart:l,reachEnd:g,nearReachStart:m,nearReachEnd:f,init:()=>{e.current&&e.current.dispatchEvent(new Event("scroll"))}}}function Yt(e){var m,b,f,y,k;const n=dt(T),{instance:r,authenticated:i}=B(),[o,s]=C(),[c,a]=C(!1);_(()=>{const S=J.local.getJSON("accounts")||[],v=S.find(L=>L.info.id===J.session.get("currentAccount"));v&&s(v),a(S.length>1)},[]);const h=(n.settings.shortcutsColumnsMode||n.settings.shortcutsViewMode==="multi-column")&&!n.shortcuts.find(S=>S.type==="following"),d=jn(()=>{T.showAccounts=!0},{threshold:600,detect:"touch",cancelOnMovement:!0}),l=P(),[p,g]=C(void 0),u=Xe([0,0,n.settings.shortcutsViewMode==="tab-menu-bar"?50:0,0]);return t($,{children:[t("button",{ref:l,type:"button",class:`button plain nav-menu-button ${c?"with-avatar":""} ${open?"active":""}`,style:{position:"relative"},onClick:()=>{g(S=>S?void 0:"open")},onContextMenu:S=>{S.preventDefault(),T.showAccounts=!0},...d(),children:[c&&t(Ft,{url:((m=o==null?void 0:o.info)==null?void 0:m.avatar)||((b=o==null?void 0:o.info)==null?void 0:b.avatarStatic),size:"l",squircle:(f=o==null?void 0:o.info)==null?void 0:f.bot}),t(w,{icon:"menu",size:c?"s":"l"})]}),t(en,{menuClassName:"nav-menu",state:p,anchorRef:l,onClose:()=>{g(void 0)},containerProps:{style:{zIndex:10},onClick:()=>{g(void 0)}},portal:{target:document.body},...e,overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:u,unmountOnClose:!0,children:[!!((y=n.appVersion)!=null&&y.commitHash)&&n.appVersion.commitHash!=="6333084"&&t("div",{class:"top-menu",children:[t(Z,{onClick:()=>{confirm("Reload page now to update?")&&(async()=>{try{location.reload()}catch{}})()},children:[t(w,{icon:"sparkles",class:"sparkle-icon",size:"l"})," ",t("span",{children:"New update available…"})]}),t(xt,{})]}),t("section",{children:[t(Tt,{to:"/",children:[t(w,{icon:"home",size:"l"})," ",t("span",{children:"Home"})]}),i&&t($,{children:[h&&t(Tt,{to:"/following",children:[t(w,{icon:"following",size:"l"})," ",t("span",{children:"Following"})]}),t(Tt,{to:"/mentions",children:[t(w,{icon:"at",size:"l"})," ",t("span",{children:"Mentions"})]}),t(Tt,{to:"/notifications",children:[t(w,{icon:"notification",size:"l"})," ",t("span",{children:"Notifications"}),n.notificationsShowNew&&t("sup",{title:"New",style:{opacity:.5},children:[" ","•"]})]}),t(xt,{}),t(Tt,{to:"/l",children:[t(w,{icon:"list",size:"l"})," ",t("span",{children:"Lists"})]}),t(Tt,{to:"/ft",children:[t(w,{icon:"hashtag",size:"l"})," ",t("span",{children:"Followed Hashtags"})]}),t(Tt,{to:"/b",children:[t(w,{icon:"bookmark",size:"l"})," ",t("span",{children:"Bookmarks"})]}),t(Tt,{to:"/f",children:[t(w,{icon:"heart",size:"l"})," ",t("span",{children:"Favourites"})]})]}),t(xt,{}),t(Tt,{to:"/search",children:[t(w,{icon:"search",size:"l"})," ",t("span",{children:"Search"})]}),t(Tt,{to:`/${r}/p/l`,children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Local"})]}),t(Tt,{to:`/${r}/p`,children:[t(w,{icon:"earth",size:"l"})," ",t("span",{children:"Federated"})]}),t(Tt,{to:`/${r}/trending`,children:[t(w,{icon:"chart",size:"l"})," ",t("span",{children:"Trending"})]})]}),t("section",{children:i?t($,{children:[t(xt,{}),((k=o==null?void 0:o.info)==null?void 0:k.id)&&t(Tt,{to:`/${r}/a/${o.info.id}`,children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Profile"})]}),t(Z,{onClick:()=>{T.showAccounts=!0},children:[t(w,{icon:"group",size:"l"})," ",t("span",{children:"Accounts…"})]}),t(Z,{onClick:()=>{T.showShortcutsSettings=!0},children:[t(w,{icon:"shortcut",size:"l"})," ",t("span",{children:"Shortcuts Settings…"})]}),t(Z,{onClick:()=>{T.showSettings=!0},children:[t(w,{icon:"gear",size:"l"})," ",t("span",{children:"Settings…"})]})]}):t($,{children:[t(xt,{}),t(Tt,{to:"/login",children:[t(w,{icon:"user",size:"l"})," ",t("span",{children:"Log in"})]})]})})]})]})}function Dt({title:e,titleComponent:n,id:r,instance:i,emptyText:o,errorText:s,useItemID:c,boostsCarousel:a,fetchItems:h=()=>{},checkForUpdates:d=()=>{},checkForUpdatesInterval:l=6e4,headerStart:p,headerEnd:g,timelineStart:u,allowFilters:m,refresh:b}){const f=dt(T),[y,k]=C([]),[S,v]=C("default"),[L,N]=C(!1),[R,x]=C(!1),[K,F]=C(!0),E=P(),U=nn(q=>{x(!1),S!=="loading"&&(v("loading"),(async()=>{try{let{done:A,value:I}=await h(q);Array.isArray(I)?(a&&(I=vs(I)),I=Ss(I),k(q?I:M=>[...M,...I]),I.length||(A=!0),N(!A)):N(!1),v("default")}catch{v("error")}finally{U.cancel()}})())},1500,{leading:!0,trailing:!1}),Q=".timeline-item, .timeline-item-alt",W=Ct("j, shift+j",(q,A)=>{var Y,X;const I=document.activeElement.closest(Q),M=I==null?void 0:I.getBoundingClientRect(),O=Array.from(E.current.querySelectorAll(Q));if(I&&M.top<E.current.clientHeight&&M.bottom>0){const j=O.indexOf(I);let z=O[j+1];A.shift&&(z=O.find((st,Lt)=>Lt>j&&!st.classList.contains("timeline-item-alt"))),z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=O.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),ut=Ct("k, shift+k",(q,A)=>{var Y,X;const I=document.activeElement.closest(Q),M=I==null?void 0:I.getBoundingClientRect(),O=Array.from(E.current.querySelectorAll(Q));if(I&&M.top<E.current.clientHeight&&M.bottom>0){const j=O.indexOf(I);let z=O[j-1];A.shift&&(z=O.findLast((st,Lt)=>Lt<j&&!st.classList.contains("timeline-item-alt"))),z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=O.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),lt=Ct(["enter","o"],()=>{const q=document.activeElement.closest(Q);q&&q.click()}),{scrollDirection:tt,nearReachStart:G,nearReachEnd:ft,reachStart:at,reachEnd:D}=re({scrollableRef:E,distanceFromEnd:2,scrollThresholdStart:44});_(()=>{var q;(q=E.current)==null||q.scrollTo({top:0}),U(!0)},[]),_(()=>{U(!0)},[b]),_(()=>{at&&U(!0)},[at]),_(()=>{(ft||D&&L)&&U()},[ft,L]);const et=P(!1),ct=sn(5e3),nt=ae(async({disableHoverCheck:q=!1}={})=>{f.settings.autoRefresh&&E.current.scrollTop===0&&(q||ct)&&!Ts()?U(!0):await d()&&x(!0)},[r,ct,U,d,f.settings.autoRefresh]),kt=P();ie(q=>{if(q){const A=Date.now()-kt.current;(!kt.current||A>1e3*60)&&nt({disableHoverCheck:!0})}else kt.current=Date.now();F(q)},[d,nt,f.settings.autoRefresh]),Je(nt,K&&!R?l:null);const pt=tt==="end"&&!G;return t("div",{id:`${r}-page`,class:"deck-container",ref:q=>{E.current=q,W.current=q,ut.current=q,lt.current=q},tabIndex:"-1",onPointerEnter:q=>{et.current=!0},onPointerLeave:()=>{et.current=!1},children:t("div",{class:"timeline-deck deck",children:[t("header",{hidden:pt,onClick:q=>{var A;q.target.closest("a, button")||(A=E.current)==null||A.scrollTo({top:0,behavior:"smooth"})},onDblClick:q=>{q.target.closest("a, button")||U(!0)},class:S==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),p??t(H,{to:"/",class:"button plain home-button",children:t(w,{icon:"home",size:"l"})})]}),e&&(n||t("h1",{children:e})),t("div",{class:"header-side",children:!!g&&g})]}),y.length>0&&S!=="loading"&&!pt&&R&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var q;U(!0),(q=E.current)==null||q.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New posts"]})]}),!!u&&t("div",{class:"timeline-start",children:u}),y.length?t($,{children:[t("ul",{class:"timeline",children:[y.map(q=>{const{id:A,reblog:I,items:M,type:O,_pinned:Y}=q,X=(I==null?void 0:I.id)||A,j=i?`/${i}/s/${X}`:`/s/${X}`;let z="";O==="boosts"?z=`${M.length} Boosts`:O==="pinned"&&(z="Pinned posts");const st=O==="boosts"||O==="pinned";if(M){if(st)return M.sort((it,ht)=>it._filtered&&!ht._filtered?1:!it._filtered&&ht._filtered?-1:0),t("li",{class:"timeline-item-carousel",children:t(ks,{title:z,class:`${O}-carousel`,children:M.map(it=>{const{id:ht,reblog:It}=it,$t=(It==null?void 0:It.id)||ht,Ut=i?`/${i}/s/${$t}`:`/s/${$t}`;return t("li",{children:t(H,{class:"status-carousel-link timeline-item-alt",to:Ut,children:c?t(gt,{statusID:ht,instance:i,size:"s",contentTextWeight:!0}):t(gt,{status:it,instance:i,size:"s",contentTextWeight:!0})})},ht)})})},`timeline-${A}`);const Lt=M.length>3;return M.map((it,ht)=>{const{id:It,_differentAuthor:$t}=it,Ut=i?`/${i}/s/${It}`:`/s/${It}`,ue=ht>0&&ht<M.length-1,Wt=it.sensitive&&!!it.spoilerText&&ht>0||Lt&&ue&&O==="thread";return t("li",{class:`timeline-item-container timeline-item-container-type-${O} timeline-item-container-${ht===0?"start":ht===M.length-1?"end":"middle"} ${$t?"timeline-item-diff-author":""}`,children:t(H,{class:"status-link timeline-item",to:Ut,children:Wt?t(Is,{status:it,instance:i}):c?t(gt,{statusID:It,instance:i,allowFilters:m}):t(gt,{status:it,instance:i,allowFilters:m})})},`timeline-${It}`)})}return t("li",{children:t(H,{class:"status-link timeline-item",to:j,children:c?t(gt,{statusID:A,instance:i,allowFilters:m}):t(gt,{status:q,instance:i,allowFilters:m})})},`timeline-${A+Y}`)}),L&&S==="loading"&&t($,{children:[t("li",{style:{height:"20vh"},children:t(gt,{skeleton:!0})}),t("li",{style:{height:"25vh"},children:t(gt,{skeleton:!0})})]})]}),S==="default"&&(L?t(le,{onChange:q=>{q&&U()},children:t("button",{type:"button",class:"plain block",onClick:()=>U(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}))]}):S==="loading"?t("ul",{class:"timeline",children:Array.from({length:5}).map((q,A)=>t("li",{children:t(gt,{skeleton:!0})},A))}):S!=="error"&&t("p",{class:"ui-state",children:o}),S==="error"&&t("p",{class:"ui-state",children:[s,t("br",{}),t("br",{}),t("button",{class:"button plain",onClick:()=>U(!y.length),children:"Try again"})]})]})})}function ks({title:e,class:n,children:r}){const i=P(),{reachStart:o,reachEnd:s,init:c}=re({scrollableRef:i,direction:"horizontal"});return _(()=>{c==null||c()},[]),t("div",{class:`status-carousel ${n}`,children:[t("header",{children:[t("h3",{children:e}),t("span",{children:[t("button",{type:"button",class:"small plain2",disabled:o,onClick:()=>{var a,h;(h=i.current)==null||h.scrollBy({left:-Math.min(320,(a=i.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-left"})})," ",t("button",{type:"button",class:"small plain2",disabled:s,onClick:()=>{var a,h;(h=i.current)==null||h.scrollBy({left:Math.min(320,(a=i.current)==null?void 0:a.offsetWidth),behavior:"smooth"})},children:t(w,{icon:"chevron-right"})})]})]}),t("ul",{ref:i,children:r})]})}function Is({status:e,instance:n}){const r=dt(T),{id:i}=e,o=Ze(e),s=ke(i,n);return t("article",{class:"status compact-thread",tabindex:"-1",children:[r.statusThreadNumber[s]?t("div",{class:"status-thread-badge",children:[t(w,{icon:"thread",size:"s"}),r.statusThreadNumber[s]?` ${r.statusThreadNumber[s]}/X`:""]}):t("div",{class:"status-thread-badge",children:t(w,{icon:"thread",size:"s"})}),t("div",{class:"content-compact",title:o,children:[o,e.sensitive&&e.spoilerText&&t($,{children:[" ",t("span",{class:"spoiler-badge",children:t(w,{icon:"eye-close",size:"s"})})]})]})]})}function Ts(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}const Cs=20;function xs(){const e=dt(T),{id:n,...r}=Ot(),[i,o]=Mt(),s=!i.get("replies"),c=!!i.get("boosts"),a=i.get("tagged"),h=!!i.get("media"),{masto:d,instance:l,authenticated:p}=B({instance:r.instance}),g=P();async function u(F){const E=[];if(F){const{value:W}=await d.v1.accounts.listStatuses(n,{pinned:!0}).next();if(W!=null&&W.length&&!a&&!h)if(W.forEach(ut=>{ut._pinned=!0,vt(ut,l)}),W.length>=3){const ut=W.map(lt=>lt.id);E.push({id:ut,items:W,type:"pinned"})}else E.push(...W)}(F||!g.current)&&(g.current=d.v1.accounts.listStatuses(n,{limit:Cs,exclude_replies:s,exclude_reblogs:c,only_media:h,tagged:a}));const{value:U,done:Q}=await g.current.next();return U!=null&&U.length&&(E.push(...U),U.forEach(W=>{vt(W,l)})),{value:E,done:Q}}const[m,b]=C(),[f,y]=C([]);St(`${m!=null&&m.displayName?m.displayName+" ":""}@${m!=null&&m.acct?m.acct:"Account posts"}`,"/:instance?/a/:id"),_(()=>{(async()=>{try{const F=await d.v1.accounts.fetch(n);b(F)}catch{}try{const F=await d.v1.accounts.listFeaturedTags(n);y(F)}catch{}})()},[n]);const{displayName:k,acct:S,emojis:v}=m||{},L=P(),N=yt(()=>{const F=e.accounts[`${n}@${l}`],E=!s||c||a||h;return t($,{children:[t(cn,{instance:l,account:F||n,fetchAccount:()=>d.v1.accounts.fetch(n),authenticated:p,standalone:!0}),t("div",{class:"filter-bar",ref:L,children:[E?t(H,{to:`/${l}/a/${n}`,class:"insignificant filter-clear",title:"Clear filters",children:t(w,{icon:"x",size:"l"})}):t(w,{icon:"filter",class:"insignificant",size:"l"}),t(H,{to:`/${l}/a/${n}${s?"?replies=1":""}`,onClick:()=>{s&&ot("Showing post with replies")},class:s?"":"is-active",children:"+ Replies"}),t(H,{to:`/${l}/a/${n}${c?"":"?boosts=0"}`,onClick:()=>{c||ot("Showing posts without boosts")},class:c?"is-active":"",children:"- Boosts"}),t(H,{to:`/${l}/a/${n}${h?"":"?media=1"}`,onClick:()=>{h||ot("Showing posts with media")},class:h?"is-active":"",children:"Media"}),f.map(U=>t(H,{to:`/${l}/a/${n}${a===U.name?"":`?tagged=${encodeURIComponent(U.name)}`}`,onClick:()=>{a!==U.name&&ot(`Showing posts tagged with #${U.name}`)},class:a===U.name?"is-active":"",children:t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),U.name]})}))]})]})},[n,l,p,s,c,f,a,h]);_(()=>{var E;const F=(E=L.current)==null?void 0:E.querySelector(".is-active");F&&L.current.scrollTo({behavior:"smooth",left:F.offsetLeft-(L.current.offsetWidth-F.offsetWidth)/2})},[f,a,h,s,c]);const R=yt(()=>m!=null&&m.url?new URL(m.url).hostname:null,[m]),K=!!m&&!(l===R);return t(Dt,{title:`${m!=null&&m.acct?"@"+m.acct:"Posts"}`,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:t(Ke,{text:k,emojis:v})}),t("div",{children:t("span",{children:["@",S]})})]}),id:"account-statuses",instance:l,emptyText:"Nothing to see here yet.",errorText:"Unable to load posts",fetchItems:u,useItemID:!0,boostsCarousel:e.settings.boostsCarousel,timelineStart:N,refresh:s+c+a+h,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{disabled:!K,onClick:()=>{(async()=>{try{const{masto:F}=B({instance:R}),E=await F.v1.accounts.lookup({acct:m.acct}),{id:U}=E;location.hash=`/${R}/a/${U}`}catch{alert("Unable to fetch account info")}})()},children:[t(w,{icon:"transfer"})," ",t("small",{class:"menu-double-lines",children:["Switch to account's instance (",t("b",{children:R}),")"]})]})})},n)}function $s({onClose:e}){const{masto:n}=B(),r=J.local.getJSON("accounts"),i=J.session.get("currentAccount"),o=r.length>1,[s,c]=C(0),[a,h]=ce(d=>d+1,0);return t("div",{id:"accounts-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{class:"header-grid",children:t("h2",{children:"Accounts"})}),t("main",{children:t("section",{children:[t("ul",{class:"accounts-list",children:r.map((d,l)=>{const p=d.info.id===i,g=l===(s||0);return t("li",{children:[t("div",{children:[o&&t("span",{class:`current ${p?"is-current":""}`,children:t(w,{icon:"check-circle",alt:"Current"})}),t(Ft,{url:d.info.avatarStatic,size:"xxl",onDblClick:async()=>{if(p)try{const u=await n.v1.accounts.fetch(d.info.id);d.info=u,J.local.setJSON("accounts",r),h()}catch{}}}),t(ve,{account:o?{...d.info,acct:/@/.test(d.info.acct)?d.info.acct:`${d.info.acct}@${d.instanceURL}`}:d.info,showAcct:!0,onClick:()=>{p?T.showAccount=`${d.info.username}@${d.instanceURL}`:(J.session.set("currentAccount",d.info.id),location.reload())}})]}),t("div",{class:"actions",children:[g&&o&&t($,{children:[t("span",{class:"tag",children:"Default"})," "]}),t(Bt,{align:"end",menuButton:t("button",{type:"button",title:"More",class:"plain more-button",children:t(w,{icon:"more",size:"l",alt:"More"})}),children:[t(Z,{onClick:()=>{T.showAccount=`${d.info.username}@${d.instanceURL}`},children:[t(w,{icon:"user"}),t("span",{children:"View profile…"})]}),t(xt,{}),o&&t(Z,{disabled:g,onClick:()=>{r.splice(l,1),r.unshift(d),J.local.setJSON("accounts",r),c(l)},children:[t(w,{icon:"check-circle"}),t("span",{children:"Set as default"})]}),t(At,{subMenu:!0,confirmLabel:t($,{children:[t(w,{icon:"exit"}),t("span",{children:["Log out @",d.info.acct,"?"]})]}),disabled:!p,menuItemClassName:"danger",onClick:()=>{r.splice(l,1),J.local.setJSON("accounts",r),location.href=location.pathname||"/"},children:[t(w,{icon:"exit"}),t("span",{children:"Log out…"})]})]})]})]},l+d.id)})}),t("p",{children:t(H,{to:"/login",class:"button plain2",onClick:e,children:[t(w,{icon:"plus"})," ",t("span",{children:"Add an existing account"})]})}),o&&t("p",{children:t("small",{children:["Note: ",t("i",{children:"Default"})," account will always be used for first load. Switched accounts will persist during the session."]})})]})})]})}const Ls=20;function dn(){St("Bookmarks","/b");const{masto:e,instance:n}=B(),r=P();async function i(o){return(o||!r.current)&&(r.current=e.v1.bookmarks.list({limit:Ls})),await r.current.next()}return t(Dt,{title:"Bookmarks",id:"bookmarks",emptyText:"No bookmarks yet. Go bookmark something!",errorText:"Unable to load bookmarks",instance:n,fetchItems:i})}const Rs=20;function un(){St("Favourites","/f");const{masto:e,instance:n}=B(),r=P();async function i(o){return(o||!r.current)&&(r.current=e.v1.favourites.list({limit:Rs})),await r.current.next()}return t(Dt,{title:"Favourites",id:"favourites",emptyText:"No favourites yet. Go favourite something!",errorText:"Unable to load favourites",instance:n,fetchItems:i})}const As=200;function Ms(){const{masto:e,instance:n}=B();St("Followed Hashtags","/ft");const[r,i]=C("default"),[o,s]=C([]);return _(()=>{i("loading"),(async()=>{try{const c=e.v1.followedTags.list({limit:As}),a=[];do{const{value:h,done:d}=await c.next();if(d||(h==null?void 0:h.length)===0)break;a.push(...h)}while(!0);a.sort((h,d)=>h.name.localeCompare(d.name)),s(a),i("default")}catch{i("error")}})()},[]),t("div",{id:"followed-hashtags-page",class:"deck-container",tabIndex:"-1",children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Followed Hashtags"}),t("div",{class:"header-side"})]})}),t("main",{children:o.length>0?t("ul",{class:"link-list",children:o.map(c=>t("li",{children:t(H,{to:n?`/${n}/t/${c.name}`:`/t/${c.name}`,children:[t(w,{icon:"hashtag"})," ",t("span",{children:c.name})]})}))}):r==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):r==="error"?t("p",{class:"ui-state",children:"Unable to load followed hashtags."}):t("p",{class:"ui-state",children:"No hashtags followed yet."})})]})})}function Ds(e,n,r){var h;const{filtered:i}=e;if(!(i!=null&&i.length)||r&&((h=e.account)==null?void 0:h.id)===r)return!0;const s=i.filter(d=>{const{filter:l}=d,p=l.context.includes(n);return p?l.expiresAt?new Date(l.expiresAt)>new Date:p:!1});if(!s.length)return!0;if(s.some(d=>d.filter.filterAction==="hide"))return!1;const a=s.some(d=>d.filter.filterAction==="warn");if(a){const d=s.map(l=>l.filter.title);e._filtered={titles:d,titlesStr:d.join(" • ")}}return a}function Pt(e,n){if(!(e!=null&&e.length))return[];if(!n)return e;const r=J.session.get("currentAccount");return e.filter(i=>Ds(i,n,r))}const Es=20;function xe({title:e,path:n,id:r,...i}){St(e||"Following",n||"/following");const{masto:o,instance:s}=B(),c=dt(T),a=P(),h=P();async function d(u){(u||!a.current)&&(a.current=o.v1.timelines.listHome({limit:Es}));const m=await a.current.next();let{value:b}=m;return b!=null&&b.length&&(u&&(h.current=b[0].id),b=Pt(b,"home"),b.forEach(f=>{vt(f,s)}),b=Fe(b,s),b.sort((f,y)=>{const k=new Date(f.createdAt);return new Date(y.createdAt)-k})),{...m,value:b}}async function l(){try{const u=await o.v1.timelines.listHome({limit:5,since_id:h.current}).next();let{value:m}=u;return!!(m!=null&&m.length&&(h.current=m[0].id,m=Fe(m,s),m=Pt(m,"home"),m.some(b=>!b.reblog)))}catch{return!1}}const p=P(),g=async()=>{if(p.current&&(p.current.readyState===WebSocket.CONNECTING||p.current.readyState===WebSocket.OPEN))return;const u=await o.v1.stream.streamUser();return p.current=u.ws,p.current.__id=Math.random(),u.on("status.update",m=>{vt(m,s)}),u.on("delete",m=>{const b=Qe(m,s);b&&(b._deleted=!0)}),u.ws.onclose=()=>{},u};return _(()=>{let u;return(async()=>u=await g())(),()=>{u&&(u.ws.close(),p.current=null)}},[]),t(Dt,{title:e||"Following",id:r||"following",emptyText:"Nothing to see here.",errorText:"Unable to load posts.",instance:s,fetchItems:d,checkForUpdates:l,useItemID:!0,boostsCarousel:c.settings.boostsCarousel,...i,allowFilters:!0})}const Ns=20,Ps=4,Be=Ps+1;function hn({columnMode:e,...n}){let{hashtag:r,...i}=e?{}:Ot();n.hashtag&&(r=n.hashtag);let o=r.trim().split(/[\s+]+/);o.sort(),r=o[0];const{masto:s,instance:c,authenticated:a}=B({instance:(n==null?void 0:n.instance)||i.instance}),{authenticated:h}=B(),d=o.map(v=>`#${v}`).join(" "),l=c?`${d} on ${c}`:d;St(l,"/:instance?/t/:hashtag");const p=P(),g=P(void 0);async function u(v){const L=await s.v1.timelines.listHashtag(r,{limit:Ns,any:o.slice(1),maxId:v?void 0:g.current}).next(),{value:N}=L;return N!=null&&N.length&&(v&&(p.current=N[0].id),N.forEach(R=>{vt(R,c)}),g.current=N[N.length-1].id),{...L,value:N}}async function m(){try{const v=await s.v1.timelines.listHashtag(r,{limit:1,any:o.slice(1),since_id:p.current}).next(),{value:L}=v;return!!(L!=null&&L.length)}catch{return!1}}const[b,f]=C("default"),[y,k]=C();_(()=>{(async()=>{try{const v=await s.v1.tags.fetch(r);k(v)}catch{}})()},[r]);const S=o.length>=Be;return t(Dt,{title:l,titleComponent:!!c&&t("h1",{class:"header-account",children:[t("b",{children:d}),t("div",{children:c})]}),id:"hashtag",instance:c,emptyText:"No one has posted anything with this tag yet.",errorText:"Unable to load posts with this tag",fetchItems:u,checkForUpdates:m,useItemID:!0,headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[!!y&&o.length===1&&t($,{children:[t(At,{subMenu:!0,confirm:y.following,confirmLabel:`Unfollow #${r}?`,disabled:b==="loading"||!a,onClick:()=>{f("loading"),y.following?s.v1.tags.unfollow(r).then(()=>{k({...y,following:!1}),ot(`Unfollowed #${r}`)}).catch(v=>{alert(v)}).finally(()=>{f("default")}):s.v1.tags.follow(r).then(()=>{k({...y,following:!0}),ot(`Followed #${r}`)}).catch(v=>{alert(v)}).finally(()=>{f("default")})},children:y.following?t($,{children:[t(w,{icon:"check-circle"})," ",t("span",{children:"Following…"})]}):t($,{children:[t(w,{icon:"plus"})," ",t("span",{children:"Follow"})]})}),t(xt,{})]}),t(Vn,{className:"menu-field",disabled:S,children:({ref:v})=>t("form",{onSubmit:L=>{var R,x;L.preventDefault();const N=(x=(R=L.target[0].value)==null?void 0:R.trim)==null?void 0:x.call(R);N&&!o.some(K=>K.toLowerCase()===N.toLowerCase())&&(o.push(N),o.sort(),location.hash=c?`/${c}/t/${o.join("+")}`:`/t/${o.join("+")}`)},children:[t(w,{icon:"hashtag"}),t("input",{ref:v,type:"text",placeholder:S?`Max ${Be} tags`:"Add hashtag",required:!0,autocorrect:"off",autocapitalize:"off",spellcheck:!1,pattern:"[^#][^\\s#]+[^#]",disabled:S})]})}),t(Wn,{takeOverflow:!0,children:o.map((v,L)=>t(Z,{disabled:o.length===1,onClick:N=>{o.splice(L,1),o.sort(),navigate(c?`/${c}/t/${o.join("+")}`:`/t/${o.join("+")}`)},children:[t(w,{icon:"x",alt:"Remove hashtag",class:"danger-icon"}),t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),v]})]},v))}),t(xt,{}),t(Z,{disabled:!h,onClick:()=>{const v={type:"hashtag",hashtag:o.join(" "),instance:c};T.shortcuts.some(N=>N.type===v.type&&N.hashtag.split(/[\s+]+/).sort().join(" ")===v.hashtag.split(/[\s+]+/).sort().join(" ")&&(N.instance?N.instance===v.instance:!0))?alert("This shortcut already exists"):(T.shortcuts.push(v),ot("Hashtag shortcut added"))},children:[t(w,{icon:"shortcut"})," ",t("span",{children:"Add to Shorcuts"})]}),t(Z,{onClick:()=>{let v=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(v)){v&&alert("Invalid instance");return}v&&(v=v.toLowerCase().trim(),navigate(`/${v}/t/${o.join("+")}`))},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},c+d)}const Us=20;function fn(e){var b;const n=dt(T),{masto:r,instance:i}=B(),o=(e==null?void 0:e.id)||((b=Ot())==null?void 0:b.id),s=P(),c=P();async function a(f){(f||!c.current)&&(c.current=r.v1.timelines.listList(o,{limit:Us}));const y=await c.current.next();let{value:k}=y;return k!=null&&k.length&&(f&&(s.current=k[0].id),k=Pt(k,"home"),k.forEach(S=>{vt(S,i)})),{...y,value:k}}async function h(){try{const f=await r.v1.timelines.listList(o,{limit:1,since_id:s.current});let{value:y}=f;return y=Pt(y,"home"),!!(y!=null&&y.length)}catch{return!1}}const[d,l]=C({title:"List"});St(d.title,"/l/:id"),_(()=>{(async()=>{try{const f=await r.v1.lists.fetch(o);l(f)}catch{}})()},[o]);const[p,g]=C(!1),[u,m]=C(!1);return t($,{children:[t(Dt,{title:d.title,id:"list",emptyText:"Nothing yet.",errorText:"Unable to load posts.",instance:i,fetchItems:a,checkForUpdates:h,useItemID:!0,boostsCarousel:n.settings.boostsCarousel,allowFilters:!0,headerStart:t(H,{to:"/l",class:"button plain",children:t(w,{icon:"list",size:"l"})}),headerEnd:t(Jt,{portal:!0,setDownOverflow:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{onClick:()=>g({list:d}),children:[t(w,{icon:"pencil",size:"l"}),t("span",{children:"Edit"})]}),t(Z,{onClick:()=>m(!0),children:[t(w,{icon:"group",size:"l"}),t("span",{children:"Manage members"})]})]})},o),p&&t(bt,{class:"light",onClick:f=>{f.target===f.currentTarget&&g(!1)},children:t(Te,{list:p==null?void 0:p.list,onClose:f=>{f.state==="success"&&f.list?l(f.list):f.state==="deleted"&&(location.hash="/l"),g(!1)}})}),u&&t(bt,{class:"light",onClick:f=>{f.target===f.currentTarget&&m(!1)},children:t(zs,{listID:o,onClose:()=>m(!1)})})]})}const _s=40;function zs({listID:e,onClose:n}){const{masto:r,instance:i}=B(),[o,s]=C([]),[c,a]=C("default"),[h,d]=C(!1),l=P();async function p(g){d(!1),a("loading"),(async()=>{try{(g||!l.current)&&(l.current=r.v1.lists.listAccounts(e,{limit:_s}));const u=await l.current.next();let{done:m,value:b}=u;b!=null&&b.length?(s(g?b:o.concat(b)),d(!m)):d(!1),a("default")}catch{a("error")}})()}return _(()=>{p(!0)},[]),t("div",{class:"sheet",id:"list-manage-members-container",children:[!!n&&t("button",{type:"button",class:"sheet-close",onClick:n,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Manage members"})}),t("main",{children:t("ul",{children:[o.map(g=>t("li",{children:[t(zt,{account:g,instance:i}),t(Fs,{account:g,listID:e})]},g.id)),h&&c==="default"&&t(le,{as:"li",onChange:g=>g&&p(),children:t("button",{type:"button",class:"light block",onClick:p,children:"Show more…"})})]})})]})}function Fs({account:e,listID:n}){const{masto:r}=B(),[i,o]=C("default"),[s,c]=C(!1);return t(At,{confirm:!s,confirmLabel:t("span",{children:["Remove @",e.username," from list?"]}),align:"end",menuItemClassName:"danger",onClick:()=>{s?(o("loading"),(async()=>{try{await r.v1.lists.addAccount(n,{accountIds:[e.id]}),o("default"),c(!1)}catch{o("error")}})()):(o("loading"),(async()=>{try{await r.v1.lists.removeAccount(n,{accountIds:[e.id]}),o("default"),c(!0)}catch{o("error")}})())},children:t("button",{type:"button",class:`light ${s?"":"danger"}`,disabled:i==="loading",children:s?"Add":"Remove…"})})}const Oe=20,Bs=new URLSearchParams;function pn({columnMode:e,...n}){St("Mentions","/mentions");const{masto:r,instance:i}=B(),[o]=e?[Bs]:Mt(),[s,c]=C(null),a=(n==null?void 0:n.type)||o.get("type")||s,h=P(),d=P();async function l(y){(y||!h.current)&&(h.current=r.v1.notifications.list({limit:Oe,types:["mention"]}));const k=await h.current.next();let{value:S}=k;return S!=null&&S.length&&(y&&(d.current=S[0].id),S.forEach(({status:v})=>{vt(v,i)})),{...k,value:S==null?void 0:S.map(v=>v.status)}}const p=P(),g=P();async function u(y){(y||!p.current)&&(p.current=r.v1.conversations.list({limit:Oe}));const k=await p.current.next();let{value:S}=k;return S=S==null?void 0:S.filter(v=>v.lastStatus),S!=null&&S.length&&(y&&(g.current=S[0].lastStatus.id),S.forEach(({lastStatus:v})=>{vt(v,i)})),{...k,value:S==null?void 0:S.map(v=>v.lastStatus)}}function m(...y){return a==="private"?u(...y):l(...y)}async function b(){if(a==="private")try{const y=await r.v1.conversations.list({limit:1,since_id:g.current}).next();let{value:k}=y;return k!=null&&k.length?(g.current=k[0].lastStatus.id,!0):!1}catch{return!1}else try{const y=await r.v1.notifications.list({limit:1,types:["mention"],since_id:d.current}).next();let{value:k}=y;return k!=null&&k.length?(d.current=k[0].id,!0):!1}catch{return!1}}const f=yt(()=>t("div",{class:"filter-bar centered",children:[t(H,{to:"/mentions",class:a?"":"is-active",onClick:y=>{e&&(y.preventDefault(),c(null))},children:"All"}),t(H,{to:"/mentions?type=private",class:a==="private"?"is-active":"",onClick:y=>{e&&(y.preventDefault(),c("private"))},children:"Private"})]}),[a]);return t(Dt,{title:"Mentions",id:"mentions",emptyText:"No one mentioned you :(",errorText:"Unable to load mentions.",instance:i,fetchItems:m,checkForUpdates:b,useItemID:!0,timelineStart:f,refresh:a})}function mn(e){const n={},r=[];for(let s=0,c=0;s<e.length;s++){const a=e[s],{status:h,account:d,type:l,createdAt:p}=a,g=new Date(p).toLocaleDateString();let u=l;(l==="favourite"||l==="reblog")&&(u="favourite+reblog");const m=`${h==null?void 0:h.id}-${u}-${g}`,b=n[m];if(u==="follow_request")r[c++]=a;else if(b!=null&&b.account){const f=b._accounts.find(y=>y.id===d.id);f?(f._types.push(l),f._types.sort().reverse()):(d._types=[l],b._accounts.push(d))}else{d._types=[l];let f=n[m]={...a,type:u,_accounts:[d]};r[c++]=f}}const i={},o=[];for(let s=0,c=0;s<r.length;s++){const a=r[s],{account:h,_accounts:d,type:l,createdAt:p}=a,g=new Date(p).toLocaleDateString();if(l==="favourite+reblog"&&h&&d.length===1){const u=`${h==null?void 0:h.id}-${l}-${g}`,m=i[u];if(m)m._statuses.push(a.status);else{let b=i[u]={...a,type:l,_statuses:[a.status]};o[c++]=b}}else o[c++]=a}return o}function qe(e){const{masto:n}=B();return n.v1.webPushSubscriptions.create(e)}function Os(){const{masto:e}=B();return e.v1.webPushSubscriptions.fetch()}function qs(e){const{masto:n}=B();return n.v1.webPushSubscriptions.update(e)}function Hs(){const{masto:e}=B();return e.v1.webPushSubscriptions.remove()}function de(){return"serviceWorker"in navigator&&"PushManager"in window}function gn(){return navigator.serviceWorker.getRegistration()}async function $e(){const e=await gn(),n=e?await e.pushManager.getSubscription():void 0;return{registration:e,subscription:n}}function bn(e){const n="=".repeat((4-e.length%4)%4),r=`${e}${n}`.replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(r),o=new Uint8Array(i.length);for(let s=0;s<i.length;++s)o[s]=i.charCodeAt(s);return o}async function js(){if(!de())return;const{subscription:e}=await $e();let n=null;try{n=await Os()}catch(r){if(!/(not found|unknown)/i.test(r.message))throw r}if(n&&e){const r=n.endpoint===e.endpoint,{vapidKey:i}=Vt(),o=n.serverKey===i;if(!r)throw new Error("Backend subscription endpoint changed");if(!o)throw new Error("Backend subscription key and vapid key changed")}if(e&&!n){const{vapidKey:r}=Vt(),{applicationServerKey:i}=e.options,o=bn(r).toString(),s=new Uint8Array(i).toString();if(!(o===s))throw await e.unsubscribe(),new Error("Subscription key and vapid key changed")}return{subscription:e,backendSubscription:n}}async function He({data:e,policy:n}){if(!de())return;let{registration:r,subscription:i}=await $e(),o=null;if(i)try{o=await qs({data:e,policy:n})}catch{o=await qe({subscription:i,data:e,policy:n})}else{const{vapidKey:s}=Vt();if(!s)throw new Error("No server key found");i=await r.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:bn(s)}),o=await qe({subscription:i,data:e,policy:n})}return{subscription:i,backendSubscription:o}}async function je(){if(!de())return;const{subscription:e}=await $e();e&&(await Hs(),await e.unsubscribe())}const Vs=30,Ws=new URLSearchParams;function Ks({columnMode:e}){St("Notifications","/notifications");const{masto:n,instance:r}=B(),i=dt(T),[o,s]=C("default"),[c]=e?[Ws]:Mt(),a=c.get("id"),h=c.get("access_token"),[d,l]=C(!1),[p,g]=C(!1),u=P(),{nearReachEnd:m,scrollDirection:b,reachStart:f,nearReachStart:y}=re({scrollableRef:u}),k=b==="end"&&!y,[S,v]=C([]),[L,N]=C([]),R=P();async function x(D){(D||!R.current)&&(R.current=n.v1.notifications.list({limit:Vs,excludeTypes:["follow_request"]}));const et=await R.current.next(),ct=et.value;if(ct!=null&&ct.length){ct.forEach(kt=>{vt(kt.status,r,{skipThreading:!0})});const nt=mn(ct);D?(T.notificationsLast=ct[0],T.notifications=nt):T.notifications.push(...nt)}return T.notificationsShowNew=!1,T.notificationsLastFetchTime=Date.now(),et}function K(){return n.v1.followRequests.list({limit:80})}const F=()=>{s("loading"),(async()=>{try{const D=await K();v(D),s("default")}catch{s("error")}})()};function E(){return Promise.resolve([])}const U=D=>{s("loading"),(async()=>{try{const et=x(D),ct=K(),nt=E();if(D){const pt=await nt;pt.sort((A,I)=>{const M=new Date(A.updatedAt||A.createdAt);return new Date(I.updatedAt||I.createdAt)-M}),N(pt);const q=await ct;v(q)}const{done:kt}=await et;l(!kt),s("default")}catch{s("error")}})()};_(()=>{U(!0)},[]),_(()=>{f&&U(!0)},[f]),_(()=>{m&&d&&U()},[m,d]);const Q=P(!1),W=sn(5e3),ut=ae(()=>{var D;i.settings.autoRefresh&&((D=u.current)==null?void 0:D.scrollTop)===0&&(!Q.current||W)&&!Gs()&&i.notificationsShowNew&&o!=="loading"&&U(!0)},[W,i.notificationsShowNew,i.settings.autoRefresh,o]);_(ut,[i.notificationsShowNew]);const lt=new Date,tt=new Date(lt-24*60*60*1e3);let G=new Date;const ft=!i.notifications.some(D=>new Date(D.createdAt).toDateString()===lt.toDateString()),at=P();return _(()=>{a&&(T.routeNotification={id:a,accessToken:atob(h)})},[a,h]),_(()=>{o==="default"&&(async()=>{const D=await gn();if(D){const et=await D.getNotifications()}})()},[o]),t("div",{id:"notifications-page",class:"deck-container",ref:u,tabIndex:"-1",onPointerEnter:()=>{Q.current=!0},onPointerLeave:()=>{Q.current=!1},children:t("div",{class:`timeline-deck deck ${p?"only-mentions":""}`,children:[t("header",{hidden:k,onClick:D=>{var et;D.target.closest("a, button")||(et=u.current)==null||et.scrollTo({top:0,behavior:"smooth"})},class:o==="loading"?"loading":"",children:[t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l",alt:"Home"})})]}),t("h1",{children:"Notifications"}),t("div",{class:"header-side"})]}),i.notificationsShowNew&&o!=="loading"&&t("button",{class:"updates-button shiny-pill",type:"button",onClick:()=>{var D;U(!0),(D=u.current)==null||D.scrollTo({top:0,behavior:"smooth"})},children:[t(w,{icon:"arrow-up"})," New notifications"]})]}),L.length>0&&t("div",{class:"shazam-container",children:t("div",{class:"shazam-container-inner",children:t("details",{class:"announcements",children:[t("summary",{children:[t("span",{children:[t(w,{icon:"announce",class:"announcement-icon",size:"l"})," ",t("b",{children:["Announcement",L.length>1?"s":""]})," ",t("small",{class:"insignificant",children:r})]}),L.length>1&&t("span",{class:"announcements-nav-buttons",children:L.map((D,et)=>t("button",{type:"button",class:"plain2 small",onClick:()=>{var ct;(ct=at.current)==null||ct.children[et].scrollIntoView({behavior:"smooth",block:"nearest"})},children:et+1}))})]}),t("ul",{class:`announcements-list-${L.length>1?"multiple":"single"}`,ref:at,children:L.map(D=>t("li",{children:t(Js,{announcement:D})}))})]})})}),S.length>0&&t("div",{class:"follow-requests",children:[t("h2",{class:"timeline-header",children:"Follow requests"}),S.length>5?t("details",{children:[t("summary",{children:[S.length," follow requests"]}),t("ul",{children:S.map(D=>t("li",{children:[t(zt,{account:D}),t(me,{accountID:D.id,onChange:()=>{}})]},D.id))})]}):t("ul",{children:S.map(D=>t("li",{children:[t(zt,{account:D}),t(me,{accountID:D.id,onChange:()=>{}})]},D.id))})]}),t("div",{id:"mentions-option",children:t("label",{children:[t("input",{type:"checkbox",checked:p,onChange:D=>{g(D.target.checked)}})," ","Only mentions"]})}),t("h2",{class:"timeline-header",children:"Today"}),ft&&!!i.notifications.length&&t("p",{class:"ui-state insignificant",children:o==="default"?"You're all caught up.":t($,{children:"…"})}),i.notifications.length?t($,{children:i.notifications.map(D=>{if(p&&D.type!=="mention")return null;const et=new Date(D.createdAt),ct=et.toDateString()!==G.toDateString();ct&&(G=et);const nt=et.toDateString()===tt.toDateString()?"Yesterday":Et(G,{hideTime:!0});return t($,{children:[ct&&t("h2",{class:"timeline-header",children:nt}),t(Ce,{instance:r,notification:D,reload:()=>{U(!0),F()}},D.id)]})})}):t($,{children:[o==="loading"&&t($,{children:t("ul",{class:"timeline flat",children:Array.from({length:5}).map((D,et)=>t("li",{class:"notification skeleton",children:[t("div",{class:"notification-type",children:t(w,{icon:"notification",size:"xl"})}),t("div",{class:"notification-content",children:t("p",{children:"███████████ ████"})})]}))})}),o==="error"&&t("p",{class:"ui-state",children:["Unable to load notifications",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>U(!0),children:"Try again"})]})]}),d&&t("button",{type:"button",class:"plain block",disabled:o==="loading",onClick:()=>U(),style:{marginBlockEnd:"6em"},children:o==="loading"?t(wt,{abrupt:!0}):t($,{children:"Show more…"})})]})})}function Gs(){return!!document.querySelector(".deck-backdrop, #modal-container > *")}function Js({announcement:e}){const{instance:n}=B(),{contact:r}=An(),i=r==null?void 0:r.account,{id:o,content:s,startsAt:c,endsAt:a,published:h,allDay:d,publishedAt:l,updatedAt:p,read:g,mentions:u,statuses:m,tags:b,emojis:f,reactions:y}=e,k=new Date(l),S=Et(k),v=new Date(p),L=Et(v);return t("div",{class:"announcement-block",children:[t(zt,{account:i}),t("div",{class:"announcement-content",onClick:We({mentions:u,instance:n}),dangerouslySetInnerHTML:{__html:pe(s,{emojis:f})}}),t("p",{class:"insignificant",children:[t("time",{datetime:k.toISOString(),children:Et(k)}),p&&L!==S&&t($,{children:[" ","•"," ",t("span",{class:"ib",children:["Updated"," ",t("time",{datetime:v.toISOString(),children:Et(v)})]})]})]}),t("div",{class:"announcement-reactions",hidden:!0,children:y.map(N=>{const{name:R,count:x,me:K,staticUrl:F,url:E}=N;return t("button",{type:"button",class:`plain4 small ${K?"reacted":""}`,children:[E||F?t("img",{src:E||F,alt:R,width:"16",height:"16"}):t("span",{children:R})," ",t("span",{class:"count",children:Rt(x)})]})})})]})}const yn=Ie(Ks),Ys=20;function ee({local:e,columnMode:n,...r}){const i=dt(T),o=!!e,s=n?{}:Ot(),{masto:c,instance:a}=B({instance:(r==null?void 0:r.instance)||s.instance}),h=`${o?"Local":"Federated"} timeline (${a})`;St(h,o?"/:instance?/p/l":"/:instance?/p");const d=P(),l=P();async function p(u){(u||!l.current)&&(l.current=c.v1.timelines.listPublic({limit:Ys,local:o}));const m=await l.current.next();let{value:b}=m;return b!=null&&b.length&&(u&&(d.current=b[0].id),b=Pt(b,"public"),b.forEach(f=>{vt(f,a)})),{...m,value:b}}async function g(){try{const u=await c.v1.timelines.listPublic({limit:1,local:o,since_id:d.current}).next();let{value:m}=u;return m=Pt(m,"public"),!!(m!=null&&m.length)}catch{return!1}}return t(Dt,{title:h,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:o?"Local timeline":"Federated timeline"}),t("div",{children:a})]}),id:"public",instance:a,emptyText:"No one has posted anything yet.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,useItemID:!0,headerStart:t($,{}),boostsCarousel:i.settings.boostsCarousel,allowFilters:!0,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:[t(Z,{href:o?`/#/${a}/p`:`/#/${a}/p/l`,children:o?t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Federated"})]}):t($,{children:[t(w,{icon:"transfer"})," ",t("span",{children:"Switch to Local"})]})}),t(xt,{}),t(Z,{onClick:()=>{let u=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(u)){u&&alert("Invalid instance");return}u&&(u=u.toLowerCase().trim(),location.hash=o?`/${u}/p/l`:`/${u}/p`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})]})},a+o)}const Xs=20;function wn({columnMode:e,...n}){const r=dt(T),i=e?{}:Ot(),{masto:o,instance:s}=B({instance:(n==null?void 0:n.instance)||i.instance}),c=`Trending (${s})`;St(c,"/:instance?/trending");const a=P(),[h,d]=C([]),l=P();async function p(m){if(m||!l.current){l.current=o.v1.trends.listStatuses({limit:Xs});try{const y=o.v1.trends.listTags(),{value:k}=await y.next();d(k)}catch{}}const b=await l.current.next();let{value:f}=b;return f!=null&&f.length&&(m&&(a.current=f[0].id),f=Pt(f,"public"),f.forEach(y=>{vt(y,s)})),{...b,value:f}}async function g(){try{const m=await o.v1.trends.listStatuses({limit:1}).next();let{value:b}=m;return b=Pt(b,"public"),b!=null&&b.length&&b[0].id!==a.current?(a.current=b[0].id,!0):!1}catch{return!1}}const u=yt(()=>h.length?t("div",{class:"filter-bar",children:[t(w,{icon:"chart",class:"insignificant",size:"l"}),h.map((m,b)=>{const{name:f,history:y}=m,k=y.reduce((S,v)=>S+ +v.uses,0);return t(H,{to:`/${s}/t/${f}`,children:[t("span",{children:[t("span",{class:"more-insignificant",children:"#"}),f]}),t("span",{class:"filter-count",children:k.toLocaleString()})]})})]}):null,[h]);return t(Dt,{title:c,titleComponent:t("h1",{class:"header-account",children:[t("b",{children:"Trending"}),t("div",{children:s})]}),id:"trending",instance:s,emptyText:"No trending posts.",errorText:"Unable to load posts",fetchItems:p,checkForUpdates:g,checkForUpdatesInterval:5*60*1e3,useItemID:!0,headerStart:t($,{}),boostsCarousel:r.settings.boostsCarousel,allowFilters:!0,timelineStart:u,headerEnd:t(Jt,{portal:!0,overflow:"auto",viewScroll:"close",position:"anchor",menuButton:t("button",{type:"button",class:"plain",children:t(w,{icon:"more",size:"l"})}),children:t(Z,{onClick:()=>{let m=prompt('Enter a new instance e.g. "mastodon.social"');if(!/\./.test(m)){m&&alert("Invalid instance");return}m&&(m=m.toLowerCase().trim(),location.hash=`/${m}/trending`)},children:[t(w,{icon:"bus"})," ",t("span",{children:"Go to another instance…"})]})})},s)}function Zs(){St("Home","/");const e=dt(T),{shortcuts:n}=e,r=n.map(i=>{if(!i)return null;const{type:o,...s}=i,c={following:xe,notifications:yn,list:fn,public:ee,bookmarks:dn,favourites:un,hashtag:hn,mentions:pn,trending:wn}[o];return c?t(c,{...s,columnMode:!0},o+JSON.stringify(s)):null});return Ct(["1","2","3","4","5","6","7","8","9"],(i,o)=>{try{const s=parseInt(o.keys[0],10)-1;document.querySelectorAll("#columns > *")[s].focus()}catch{}}),t("div",{id:"columns",children:r})}function Qs(){var n;const e=dt(T);return _(()=>{(async()=>{const r=await Kt.drafts.keys();if(r.length){const i=Ye();r.filter(s=>s.startsWith(i)).length&&(T.showDrafts=!0)}})()},[]),t($,{children:(e.settings.shortcutsColumnsMode||e.settings.shortcutsViewMode==="multi-column")&&((n=e.shortcuts)!=null&&n.length)?t(Zs,{}):t(xe,{title:"Home",path:"/",id:"home",headerStart:!1,headerEnd:t(ti,{})})})}function ti(){const e=dt(T),n=P(),[r,i]=C(void 0);return t($,{children:[t(H,{ref:n,to:"/notifications",class:`button plain notifications-button ${e.notificationsShowNew?"has-badge":""} ${r}`,onClick:o=>{o.stopPropagation(),window.matchMedia("(min-width: calc(40em))").matches&&(o.preventDefault(),i(s=>s?void 0:"open"))},children:t(w,{icon:"notification",size:"l",alt:"Notifications"})}),t(si,{state:r,anchorRef:n,onClose:()=>i(void 0)})]})}const ei=30,ni=5;function si({anchorRef:e,state:n,onClose:r}){const{masto:i,instance:o}=B(),s=dt(T),[c,a]=C("default"),h=i.v1.notifications.list({limit:ei});async function d(){const m=await h.next(),b=m.value;if(b!=null&&b.length){b.forEach(y=>{vt(y.status,o,{skipThreading:!0})});const f=mn(b);T.notificationsLast=b[0],T.notifications=f}return T.notificationsShowNew=!1,T.notificationsLastFetchTime=Date.now(),m}const[l,p]=C(!1);function g(){return i.v1.followRequests.list({limit:1})}function u(){a("loading"),(async()=>{try{await d();const m=await g();p(!!(m!=null&&m.length)),a("default")}catch{a("error")}})()}return _(()=>{n==="open"&&u()},[n]),t(en,{menuClassName:"notifications-menu",state:n,anchorRef:e,onClose:r,portal:{target:document.body},overflow:"auto",viewScroll:"close",position:"anchor",align:"center",boundingBoxPadding:"8 8 8 8",children:[t("header",{children:t("h2",{children:"Notifications"})}),t("main",{children:s.notifications.length?t($,{children:s.notifications.slice(0,ni).map(m=>t(Ce,{instance:o,notification:m},m.id))}):c==="loading"?t("div",{class:"ui-state",children:t(wt,{abrupt:!0})}):c==="error"&&t("div",{class:"ui-state",children:[t("p",{children:"Unable to fetch notifications."}),t("p",{children:t("button",{type:"button",onClick:u,children:"Try again"})})]})}),t("footer",{children:[t(H,{to:"/mentions",class:"button plain",children:[t(w,{icon:"at"})," ",t("span",{children:"Mentions"})]}),t(H,{to:"/notifications",class:"button plain2",children:[l?t($,{children:[t("span",{class:"tag collapsed",children:"New"})," ",t("span",{children:"Follow Requests"})]}):t("b",{children:"See all"})," ",t(w,{icon:"arrow-right"})]})]})]})}const ii=Ie(Qs),oi=/\/@([^@\/]+)@?([^\/]+)?\/([^\/]+)\/?$/i,ci=/\/notes\/([^\/]+)\/?$/i;function vn(e){const{hostname:n,pathname:r}=new URL(e),[,i,o,s]=r.match(oi)||[];if(s)return`/${n}/s/${s}`;const[,c]=r.match(ci)||[];if(c)return`/${n}/s/${c}`}function ai(){const n=on().pathname.replace(/^\//,""),r=vn(n);return Nt(()=>{r&&setTimeout(()=>{window.location.hash=r+"?view=full"},300)},[r]),t("div",{class:"ui-state",tabIndex:"-1",children:[r?t($,{children:[t("h2",{children:"Redirecting…"}),t("p",{children:t("a",{href:`#${r}?view=full`,children:r})})]}):t($,{children:[t("h2",{children:"Unable to process URL"}),t("p",{children:t("a",{href:n,target:"_blank",children:n})})]}),t("hr",{}),t("p",{children:t(H,{to:"/",children:"Go home"})})]})}function li(){const{masto:e}=B();St("Lists","/l");const[n,r]=C("default"),[i,o]=ce(d=>d+1,0),[s,c]=C([]);_(()=>{r("loading"),(async()=>{try{const d=await e.v1.lists.list();c(d),r("default")}catch{r("error")}})()},[i]);const[a,h]=C(!1);return t("div",{id:"lists-page",class:"deck-container",tabIndex:"-1",children:[t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:[t(Yt,{}),t(H,{to:"/",class:"button plain",children:t(w,{icon:"home",size:"l"})})]}),t("h1",{children:"Lists"}),t("div",{class:"header-side",children:t("button",{type:"button",class:"plain",onClick:()=>h(!0),children:t(w,{icon:"plus",size:"l",alt:"New list"})})})]})}),t("main",{children:s.length>0?t("ul",{class:"link-list",children:s.map(d=>t("li",{children:t(H,{to:`/l/${d.id}`,children:t("span",{children:[t(w,{icon:"list"})," ",t("span",{children:d.title})]})})}))}):n==="loading"?t("p",{class:"ui-state",children:t(wt,{})}):n==="error"?t("p",{class:"ui-state",children:"Unable to load lists."}):t("p",{class:"ui-state",children:"No lists yet."})})]}),a&&t(bt,{class:"light",onClick:d=>{d.target===d.currentTarget&&h(!1)},children:t(Te,{list:a==null?void 0:a.list,onClose:d=>{d.state==="success"&&o(),h(!1)}})})]})}const ri=""+new URL("instances-48462af0.json",import.meta.url).href,{VITE_CLIENT_NAME:di,VITE_WEBSITE:ui}={VITE_CLIENT_NAME:"Phanpy",VITE_CLIENT_ID:"social.phanpy",VITE_WEBSITE:"https://phanpy.social",VITE_APP_ENV:"production",BASE_URL:"./",MODE:"production",DEV:!1,PROD:!0,SSR:!1},Le="read write follow push";async function hi({instanceURL:e}){const n=new URLSearchParams({client_name:di,redirect_uris:location.origin+location.pathname,scopes:Le,website:ui});return await(await fetch(`https://${e}/api/v1/apps`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:n.toString()})).json()}async function fi({instanceURL:e,client_id:n}){const r=new URLSearchParams({client_id:n,scope:Le,redirect_uri:location.origin+location.pathname,response_type:"code"});return`https://${e}/oauth/authorize?${r.toString()}`}async function pi({instanceURL:e,client_id:n,client_secret:r,code:i}){const o=new URLSearchParams({client_id:n,client_secret:r,redirect_uri:location.origin+location.pathname,grant_type:"authorization_code",code:i,scope:Le});return await(await fetch(`https://${e}/oauth/token`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o.toString()})).json()}function mi(){St("Log in");const e=P(),n=J.local.get("instanceURL"),[r,i]=C("default"),[o]=Mt(),s=o.get("instance"),[c,a]=C(s||(n==null?void 0:n.toLowerCase())||""),[h,d]=C([]);_(()=>{(async()=>{try{const m=await(await fetch(ri)).json();d(m)}catch{}})()},[]);const l=u=>{J.local.set("instanceURL",u),(async()=>{i("loading");try{const{client_id:m,client_secret:b,vapid_key:f}=await hi({instanceURL:u});m&&b?(J.session.set("clientID",m),J.session.set("clientSecret",b),J.session.set("vapidKey",f),location.href=await fi({instanceURL:u,client_id:m})):alert("Failed to register application"),i("default")}catch{i("error")}})()},p=u=>{u.preventDefault();const{elements:m}=u.target;let b=m.instanceURL.value.toLowerCase();b=b.replace(/^https?:\/\//,"").replace(/\/+$/,""),b=b.replace(/^@?[^@]+@/,""),/\./.test(b)||(b=h.find(f=>f.includes(b))),l(b)},g=c?h.filter(u=>u.includes(c)).sort((u,m)=>{const b=u.toLowerCase().startsWith(c.toLowerCase()),f=m.toLowerCase().startsWith(c.toLowerCase());return b&&!f?-1:!b&&f?1:0}).slice(0,10):[];return t("main",{id:"login",style:{textAlign:"center"},children:t("form",{onSubmit:p,children:[t("h1",{children:"Log in"}),t("label",{children:[t("p",{children:"Instance"}),t("input",{value:c,required:!0,type:"text",class:"large",id:"instanceURL",ref:e,disabled:r==="loading",autocorrect:"off",autocapitalize:"off",autocomplete:"off",spellcheck:!1,placeholder:"instance domain",onInput:u=>{a(u.target.value)}}),(g==null?void 0:g.length)>0?t("ul",{id:"instances-suggestions",children:g.map(u=>t("li",{children:t("button",{type:"button",class:"plain4",onClick:()=>{l(u)},children:u})}))}):t("div",{id:"instances-eg",children:"e.g. “mastodon.social’"})]}),r==="error"&&t("p",{class:"error",children:"Failed to log in. Please try again or another instance."}),t("div",{children:[t("button",{class:"large",disabled:r==="loading",children:"Log in"})," "]}),t(wt,{hidden:r!=="loading"}),t("hr",{}),t("p",{children:t("a",{href:"https://joinmastodon.org/servers",target:"_blank",children:"Don't have an account? Create one!"})}),t("p",{children:t(H,{to:"/",children:"Go home"})})]})})}const Zt=5,fe=40;function gi(e){const n=Ot(),{masto:r,instance:i,authenticated:o}=B({instance:n.instance}),[s,c]=C("default"),[a]=Mt(),h=P(),d=(e==null?void 0:e.query)||a.get("q"),l=(e==null?void 0:e.type)||a.get("type");St(d?`Search: ${d}${l?` (${{statuses:"Posts",accounts:"Accounts",hashtags:"Hashtags"}[l]})`:""}`:"Search","/search");const[p,g]=C(!1),u=P(0);_(()=>{u.current=0},[d,l]);const m=P();Nt(()=>{var R,x;(x=(R=m.current)==null?void 0:R.scrollTo)==null||x.call(R,0,0)},[d,l]);const[b,f]=C([]),[y,k]=C([]),[S,v]=C([]);_(()=>{f([]),k([]),v([])},[d]);const L={statuses:f,accounts:k,hashtags:v};function N(R){c("loading"),R&&!l&&(f(b.slice(0,Zt)),k(y.slice(0,Zt)),v(S.slice(0,Zt))),(async()=>{var K,F;const x={q:d,resolve:o,limit:Zt};l&&(x.limit=fe,x.type=l,x.offset=u.current);try{const E=await r.v2.search(x);if(l)if(R){L[l](E[l]);const U=(K=E[l])==null?void 0:K.length;u.current=fe,g(!!U)}else{L[l](Q=>[...Q,...E[l]]);const U=(F=E[l])==null?void 0:F.length;u.current=u.current+fe,g(!!U)}else f(E.statuses),k(E.accounts),v(E.hashtags),u.current=0,g(!1);c("default")}catch{c("error")}})()}return _(()=>{var R,x,K,F;d?((x=(R=h.current)==null?void 0:R.setValue)==null||x.call(R,d),N(!0)):(F=(K=h.current)==null?void 0:K.focus)==null||F.call(K)},[d,l,i]),Ct("/",R=>{var x,K;(K=(x=h.current)==null?void 0:x.focus)==null||K.call(x)},{preventDefault:!0}),t("div",{id:"search-page",class:"deck-container",ref:m,children:t("div",{class:"timeline-deck deck",children:[t("header",{children:t("div",{class:"header-grid",children:[t("div",{class:"header-side",children:t(Yt,{})}),t(ln,{ref:h}),t("div",{class:"header-side",children:" "})]})}),t("main",{children:[!!d&&t("div",{class:"filter-bar",children:[!!l&&t(H,{to:`/search${d?`?q=${encodeURIComponent(d)}`:""}`,children:"‹ All"}),[{label:"Accounts",type:"accounts",to:`/search?q=${encodeURIComponent(d)}&type=accounts`},{label:"Hashtags",type:"hashtags",to:`/search?q=${encodeURIComponent(d)}&type=hashtags`},{label:"Posts",type:"statuses",to:`/search?q=${encodeURIComponent(d)}&type=statuses`}].sort((R,x)=>R.type===l?-1:x.type===l?1:0).map(R=>t(H,{to:R.to,children:R.label}))]}),d?t($,{children:[(!l||l==="accounts")&&t($,{children:[l!=="accounts"&&t("h2",{class:"timeline-header",children:"Accounts"}),y.length>0?t($,{children:[t("ul",{class:"timeline flat accounts-list",children:y.map(R=>t("li",{children:t(zt,{account:R,instance:i,showStats:!0})},R.id))}),l!=="accounts"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${d}&type=accounts`,children:["See more accounts ",t(w,{icon:"arrow-right"})]})})]}):!l&&(s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No accounts found."}))]}),(!l||l==="hashtags")&&t($,{children:[l!=="hashtags"&&t("h2",{class:"timeline-header",children:"Hashtags"}),S.length>0?t($,{children:[t("ul",{class:"link-list hashtag-list",children:S.map(R=>t("li",{children:t(H,{to:i?`/${i}/t/${R.name}`:`/t/${R.name}`,children:[t(w,{icon:"hashtag"}),t("span",{children:R.name})]})},R.name))}),l!=="hashtags"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${d}&type=hashtags`,children:["See more hashtags ",t(w,{icon:"arrow-right"})]})})]}):!l&&(s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No hashtags found."}))]}),(!l||l==="statuses")&&t($,{children:[l!=="statuses"&&t("h2",{class:"timeline-header",children:"Posts"}),b.length>0?t($,{children:[t("ul",{class:"timeline",children:b.map(R=>t("li",{children:t(H,{class:"status-link",to:i?`/${i}/s/${R.id}`:`/s/${R.id}`,children:t(gt,{status:R})})},R.id))}),l!=="statuses"&&t("div",{class:"ui-state",children:t(H,{class:"plain button",to:`/search?q=${d}&type=statuses`,children:["See more posts ",t(w,{icon:"arrow-right"})]})})]}):!l&&(s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"No posts found."}))]}),!!l&&(s==="default"?p?t(le,{onChange:R=>{R&&N()},children:t("button",{type:"button",class:"plain block",onClick:()=>N(),style:{marginBlockEnd:"6em"},children:"Show more…"})}):t("p",{class:"ui-state insignificant",children:"The end."}):s==="loading"&&t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}))]}):s==="loading"?t("p",{class:"ui-state",children:t(wt,{abrupt:!0})}):t("p",{class:"ui-state",children:"Enter your search term or paste a URL above to get started."})]})]})})}const Sn=""+new URL("logo-f0531a6b.svg",import.meta.url).href,Ve=16,_t=[16,17,18,19,20];function bi({onClose:e}){const n=dt(T),r=J.local.get("theme")||"auto",i=P(),o=n.settings.contentTranslationTargetLanguage||null,s=Mn(),c=Dn(s),a=J.local.get("textSize")||Ve,[h,d]=C(J.account.get("preferences")||{});return t("div",{id:"settings-container",class:"sheet",tabIndex:"-1",children:[!!e&&t("button",{type:"button",class:"sheet-close",onClick:e,children:t(w,{icon:"x"})}),t("header",{children:t("h2",{children:"Settings"})}),t("main",{children:[t("section",{children:t("ul",{children:[t("li",{children:[t("div",{children:t("label",{children:"Appearance"})}),t("div",{children:t("form",{ref:i,onInput:l=>{l.preventDefault();const g=new FormData(i.current).get("theme"),u=document.documentElement;g==="auto"?u.classList.remove("is-light","is-dark"):(u.classList.toggle("is-light",g==="light"),u.classList.toggle("is-dark",g==="dark")),document.querySelector('meta[name="color-scheme"]').setAttribute("content",g==="auto"?"dark light":g),g==="auto"?J.local.del("theme"):J.local.set("theme",g)},children:t("div",{class:"radio-group",children:[t("label",{children:[t("input",{type:"radio",name:"theme",value:"light",defaultChecked:r==="light"}),t("span",{children:"Light"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"dark",defaultChecked:r==="dark"}),t("span",{children:"Dark"})]}),t("label",{children:[t("input",{type:"radio",name:"theme",value:"auto",defaultChecked:r!=="light"&&r!=="dark"}),t("span",{children:"Auto"})]})]})})})]}),t("li",{children:[t("div",{children:t("label",{children:"Text size"})}),t("div",{class:"range-group",children:[t("span",{style:{fontSize:_t[0]},children:"A"})," ",t("input",{type:"range",min:_t[0],max:_t[_t.length-1],step:"1",value:a,list:"sizes",onChange:l=>{const p=parseInt(l.target.value,10);document.documentElement.style.setProperty("--text-size",`${p}px`),p===Ve?J.local.del("textSize"):J.local.set("textSize",l.target.value)}})," ",t("span",{style:{fontSize:_t[_t.length-1]},children:"A"}),t("datalist",{id:"sizes",children:_t.map(l=>t("option",{value:l}))})]})]})]})}),t("h3",{children:"Posting"}),t("section",{children:t("ul",{children:t("li",{children:[t("div",{children:t("label",{for:"posting-privacy-field",children:"Default visibility"})}),t("div",{children:t("select",{id:"posting-privacy-field",value:h["posting:default:visibility"]||"public",onChange:l=>{const{value:p}=l.target,{masto:g}=B();(async()=>{try{await g.v1.accounts.updateCredentials({source:{privacy:p}}),d({...h,"posting:default:visibility":p}),J.account.set("preferences",{...h,"posting:default:visibility":p})}catch{alert("Failed to update posting privacy")}})()},children:[t("option",{value:"public",children:"Public"}),t("option",{value:"unlisted",children:"Unlisted"}),t("option",{value:"private",children:"Followers only"})]})})]})})}),t("h3",{children:"Experiments"}),t("section",{children:t("ul",{children:[t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.autoRefresh,onChange:l=>{T.settings.autoRefresh=l.target.checked}})," ","Auto refresh timeline posts"]})}),t("li",{children:t("label",{children:[t("input",{type:"checkbox",checked:n.settings.boostsCarousel,onChange:l=>{T.settings.boostsCarousel=l.target.checked}})," ","Boosts carousel"]})}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslation,onChange:l=>{const{checked:p}=l.target;T.settings.contentTranslation=p,p||(T.settings.contentTranslationTargetLanguage=null)}})," ","Post translation"]}),t("div",{class:`sub-section ${n.settings.contentTranslation?"":"more-insignificant"}`,children:[t("div",{children:t("label",{children:["Translate to"," ",t("select",{value:o||"",disabled:!n.settings.contentTranslation,onChange:l=>{T.settings.contentTranslationTargetLanguage=l.target.value||null},children:[t("option",{value:"",children:["System language (",c,")"]}),t("option",{disabled:!0,children:"──────────"}),Me.map(l=>t("option",{value:l.code,children:l.name}))]})]})}),t("hr",{}),t("p",{class:"checkbox-fieldset",children:['Hide "Translate" button for',n.settings.contentTranslationHideLanguages.length>0&&t($,{children:[" ","(",n.settings.contentTranslationHideLanguages.length,")"]}),":",t("div",{class:"checkbox-fields",children:Me.map(l=>t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationHideLanguages.includes(l.code),onChange:p=>{const{checked:g}=p.target;g?T.settings.contentTranslationHideLanguages.push(l.code):T.settings.contentTranslationHideLanguages=n.settings.contentTranslationHideLanguages.filter(u=>u!==l.code)}})," ",l.name]}))})]}),t("p",{class:"insignificant",children:t("small",{children:["Note: This feature uses an external API to translate, powered by"," ",t("a",{href:"https://github.com/thedaviddelta/lingva-translate",target:"_blank",children:"Lingva Translate"}),"."]})}),t("hr",{}),t("div",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.contentTranslationAutoInline,disabled:!n.settings.contentTranslation,onChange:l=>{T.settings.contentTranslationAutoInline=l.target.checked}})," ","Auto inline translation"]}),t("p",{class:"insignificant",children:t("small",{children:["Automatically show translation for posts in timeline. Only works for ",t("b",{children:"short"})," posts without content warning, media and poll."]})})]})]})]}),t("li",{children:[t("label",{children:[t("input",{type:"checkbox",checked:n.settings.cloakMode,onChange:l=>{T.settings.cloakMode=l.target.checked}})," ","Cloak mode"," ",t("span",{class:"insignificant",children:["(",t("samp",{children:"Text"})," → ",t("samp",{children:"████"}),")"]})]}),t("div",{class:"sub-section insignificant",children:t("small",{children:"Replace text as blocks, useful when taking screenshots, for privacy reasons."})})]}),t("li",{children:t("button",{type:"button",class:"light",onClick:()=>{T.showDrafts=!0,T.showSettings=!1},children:"Unsent drafts"})})]})}),t(yi,{onClose:e}),t("h3",{children:"About"}),t("section",{children:[t("div",{style:{display:"flex",gap:8,lineHeight:1.25,alignItems:"center",marginTop:8},children:[t("img",{src:Sn,alt:"",width:"64",height:"64",style:{aspectRatio:"1/1",verticalAlign:"middle",background:"#b7cdf9",borderRadius:12}}),t("div",{children:[t("b",{children:"Phanpy"})," ",t("a",{href:"https://hachyderm.io/@phanpy",onClick:l=>{l.preventDefault(),T.showAccount="phanpy@hachyderm.io"},children:"@phanpy"}),t("br",{}),t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",onClick:l=>{l.preventDefault(),T.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"})]})]}),t("p",{children:t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"})}),t("p",{children:[t("span",{class:"insignificant",children:"Last build:"})," ",t(Se,{datetime:new Date("2023-09-06T12:59:14.094Z")})," ",t($,{children:["(",t("a",{href:"https://github.com/cheeaun/phanpy/commit/6333084",target:"_blank",children:t("code",{children:"6333084"})}),")"]})]})]})]})]})}function yi({onClose:e}){if(!de())return null;const{instance:n}=B(),[r,i]=C("default"),o=P(),[s,c]=C(!1),[a,h]=C(!1),d=P();_(()=>{(async()=>{i("loading");try{const{subscription:p,backendSubscription:g}=await js();if(g!=null&&g.policy&&g.policy!=="none"){c(!0);const{alerts:u,policy:m}=g;d.current=m;const{elements:b}=o.current,f=b.namedItem(m);f&&(f.value=m),Object.keys(u).forEach(y=>{const k=b.namedItem(y);(k==null?void 0:k.type)==="checkbox"&&(k.checked=!0)})}i("default")}catch(p){/outside.*authorized/i.test(p.message)?h(!0):alert((p==null?void 0:p.message)||p),i("error")}})()},[]);const l=r==="loading";return t("form",{ref:o,onChange:()=>{const p=Object.fromEntries(new FormData(o.current)),g=!!p["policy-allow"],u={policy:p.policy,data:{alerts:{mention:!!p.mention,favourite:!!p.favourite,reblog:!!p.reblog,follow:!!p.follow,follow_request:!!p.followRequest,poll:!!p.poll,update:!!p.update,status:!!p.status}}};let m=0;Object.keys(u.data.alerts).forEach(f=>{u.data.alerts[f]?m++:delete u.data.alerts[f]});const b=d.current!==u.policy;g&&m>0?b?je().then(()=>{He(u)}).catch(f=>{alert("Failed to update subscription. Please try again.")}):He(u).catch(f=>{alert("Failed to update subscription. Please try again.")}):je().catch(f=>{alert("Failed to remove subscription. Please try again.")})},children:[t("h3",{children:"Push Notifications (beta)"}),t("section",{children:t("ul",{children:t("li",{children:[t("label",{children:[t("input",{type:"checkbox",disabled:l||a,name:"policy-allow",checked:s,onChange:async p=>{const{checked:g}=p.target;if(g){const u=await Notification.requestPermission();u==="granted"?c(!0):(c(!1),u==="denied"&&alert("Push notifications are blocked. Please enable them in your browser settings."))}else c(!1)}})," ","Allow from"," ",t("select",{name:"policy",disabled:l||a||!s,children:[{value:"all",label:"anyone"},{value:"followed",label:"people I follow"},{value:"follower",label:"followers"}].map(p=>t("option",{value:p.value,children:p.label}))})]}),t("div",{class:"shazam-container no-animation",style:{width:"100%"},hidden:!s,children:t("div",{class:"shazam-container-inner",children:t("div",{class:"sub-section",children:t("ul",{children:[{value:"mention",label:"Mentions"},{value:"favourite",label:"Favourites"},{value:"reblog",label:"Boosts"},{value:"follow",label:"Follows"},{value:"followRequest",label:"Follow requests"},{value:"poll",label:"Polls"},{value:"update",label:"Post edits"},{value:"status",label:"New posts"}].map(p=>t("li",{children:t("label",{children:[t("input",{type:"checkbox",name:p.value})," ",p.label]})}))})})})}),a&&t("div",{class:"sub-section",children:t("p",{children:["Push permission was not granted since your last login. You'll need to"," ",t(H,{to:`/login?instance=${n}`,onClick:e,children:[t("b",{children:"log in"})," again to grant push permission"]}),"."]})})]})})}),t("p",{class:"section-postnote",children:t("small",{children:["NOTE: Push notifications only work for ",t("b",{children:"one account"}),"."]})})]})}const Qt=40,wi=10,vi=5;let be={},ne={};function ye(e){delete ne[e],delete T.scrollPositions[e]}function Si(e){const{id:n}=e,{masto:r,instance:i}=B({instance:e.instance}),o=dt(T),[s,c]=Mt(),a=s.get("media"),h=s.get("media-only"),d=parseInt(a||h,10);let l=d>0;const p=s.get("mediaStatusID"),g=Qe(p,i);p&&!g&&(l=!1);const u=l&&!!h,m=ke(n,i),[b,f]=C(T.statuses[m]);_(()=>{T.statuses[m]&&f(T.statuses[m])},[m]);const y=yt(()=>{const{prevLocation:S}=T,v=((S==null?void 0:S.pathname)||"")+((S==null?void 0:S.search)||""),L=se("/:instance/s/:id",v)||se("/s/:id",v);return!v||L?"/":v},[]);_(()=>{!b&&l&&(async()=>{try{const S=await r.v1.statuses.fetch(n);vt(S,i),f(S)}catch{alert("Unable to load post."),location.hash=y}})()},[l]);const k=p?g==null?void 0:g.mediaAttachments:b==null?void 0:b.mediaAttachments;return t("div",{class:"deck-backdrop",children:[l?k!=null&&k.length?t(an,{mediaAttachments:k,statusID:p||n,instance:i,index:d-1,onClose:()=>{!window.matchMedia("(min-width: calc(40em + 350px))").matches&&o.prevLocation?history.back():u?location.hash=y:(s.delete("media"),s.delete("mediaStatusID"),c(s))}}):t("div",{class:"media-modal-container loading",children:t(wt,{abrupt:!0})}):t(H,{to:y}),!u&&t(ki,{id:n,instance:e.instance,closeLink:y})]})}function ki({id:e,closeLink:n="/",instance:r}){var A;const[i,o]=Mt(),s=i.get("media"),c=parseInt(s,10)>0,[a,h]=C(i.get("view")),d=!!parseInt(i.get("translate")),{masto:l,instance:p}=B({instance:r}),{masto:g,instance:u,authenticated:m}=B(),b=p===u,f=dt(T),[y,k]=C([]),[S,v]=C("default"),L=P(),N=ke(e,p),R=P(0),x=P();_(()=>{var I;(I=x.current)==null||I.focus()},[]),_(()=>{var M;const I=Kn(()=>{if(!x.current)return;const{scrollTop:O}=x.current;S!=="loading"&&(T.scrollPositions[e]=O)},50);return(M=x.current)==null||M.addEventListener("scroll",I,{passive:!0}),I(),()=>{var O;I.cancel(),(O=x.current)==null||O.removeEventListener("scroll",I)}},[e,S!=="loading"]);const K=P(),F=({reloadHero:I}={})=>{v("loading");let M;const O=ne[e];if(O){const Y=O.filter(X=>T.statuses[N]);k(Y)}else k([{id:e}]);return(async()=>{var st,Lt;const Y=()=>Ue(()=>l.v1.statuses.fetch(e),{retries:4}),X=Ue(()=>l.v1.statuses.fetchContext(e),{retries:8}),j=!!f.statuses[N];let z=f.statuses[N];if(!(j&&!I))try{z=await Y(),vt(z,p),await new Promise(it=>{setTimeout(it,100)})}catch{v("error");return}try{let it=function(V){return V==null?void 0:V.map(mt=>({id:mt.id,account:mt.account,repliesCount:mt.repliesCount,content:mt.content,weight:Gt(mt),replies:it(mt.__replies)}))};const ht=await X,{ancestors:It,descendants:$t}=ht;R.current=($t==null?void 0:$t.length)||0;const Ut=new Set;It.forEach(V=>{vt(V,p,{skipThreading:!0}),V.inReplyToId&&!It.find(mt=>mt.id===V.inReplyToId)&&Ut.add(V.inReplyToId)});const ue=It.every(V=>V.account.id===z.account.id),qt=[];$t.forEach(V=>{if(vt(V,p,{skipThreading:!0}),V.inReplyToId&&!$t.find(mt=>mt.id===V.inReplyToId)&&V.inReplyToId!==z.id&&Ut.add(V.inReplyToId),V.inReplyToAccountId===V.account.id)qt.push(V);else if(V.inReplyToId===z.id)qt.push(V);else if(!V.inReplyToAccountId&&qt.find(mt=>mt.id===V.inReplyToId)&&V.account.id===z.account.id)qt.push(V);else{const mt=$t.find(In=>In.id===V.inReplyToId);mt&&(mt.__replies||(mt.__replies=[]),mt.__replies.push(V))}}),Ut.size;const Wt=[...It.map(V=>({id:V.id,ancestor:!0,isThread:ue,accountID:V.account.id,account:V.account,repliesCount:V.repliesCount,weight:Gt(V)})),{id:e,accountID:z.account.id,weight:Gt(z)},...qt.map(V=>({id:V.id,account:V.account,accountID:V.account.id,descendant:!0,thread:V.account.id===z.account.id,weight:Gt(V),replies:it(V.__replies)}))];v("default"),K.current={offsetTop:(st=L.current)==null?void 0:st.offsetTop,scrollTop:(Lt=x.current)==null?void 0:Lt.scrollTop};const Re=Wt.findIndex(V=>V.id===e);Re>=lt&&tt(Re+1),k(Wt),ne[e]=Wt,En(z,p)}catch{v("error")}})(),()=>{clearTimeout(M)}};_(F,[e,l]),_(()=>{var M,O;if(!y.length)return;const I=f.scrollPositions[e];if(I)x.current.scrollTop=I;else if(K.current){const Y={offsetTop:(M=L.current)==null?void 0:M.offsetTop,scrollTop:(O=x.current)==null?void 0:O.scrollTop},X=Y.offsetTop-K.current.offsetTop+Y.scrollTop;x.current.scrollTop=X}else y.length===1&&(x.current.scrollTop=0);K.current=null},[y]),_(()=>{f.reloadStatusPage<=0||(async()=>{try{const{instanceURL:I}=Vt(),M=`https://${I}/api/v1/statuses/${e}/context`;return await(await caches.open("api")).delete(M,{ignoreVary:!0}),F({reloadHero:!0})}catch{}})()},[f.reloadStatusPage]),_(()=>()=>{T.scrollPositions={},T.reloadStatusPage=0,ne={},be={},we.clear()},[]);const E=f.statuses[N]||f.statuses[e],U=yt(()=>{if(!E)return"";const{account:I}=E,M=document.createElement("div");return M.innerHTML=I.displayName,M.innerText.trim()},[E]),Q=yt(()=>{if(!E)return"";let I=Ze(E);return I.length>64&&(I=I.slice(0,64)+"…"),I},[E]);St(U&&Q?`${U}: "${Q}"`:"Status","/:instance?/s/:id");const W=yt(()=>{if(!E)return;const{url:I}=E;if(I)return new URL(I).hostname},[E]),ut=yt(()=>{if(W)return W===p},[W,p]),[lt,tt]=C(Qt),G=yt(()=>y.length-lt,[y.length,lt]),ft=y.some(I=>I.descendant),at=y.filter(I=>I.ancestor),[D,et]=C(!0),ct=nn(et,100),nt=yt(()=>{if(!L.current||D)return null;const{top:I}=L.current.getBoundingClientRect();return I>0?"down":"up"},[D]);Ct("esc",()=>{location.hash=n},{enabled:!c}),Ct("backspace",()=>{location.hash=n}),Ct("j",()=>{var Y,X;const I=document.activeElement.closest(".status-link, .status-focus"),M=I==null?void 0:I.getBoundingClientRect(),O=Array.from(x.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(I&&M.top<x.current.clientHeight&&M.bottom>0){const j=O.indexOf(I);let z=O[j+1];z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=O.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),Ct("k",()=>{var Y,X;const I=document.activeElement.closest(".status-link, .status-focus"),M=I==null?void 0:I.getBoundingClientRect(),O=Array.from(x.current.querySelectorAll(".status-link:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *), .status-focus:not(details:not([open]) > summary ~ *, details:not([open]) > summary ~ * *)"));if(I&&M.top<x.current.clientHeight&&M.bottom>0){const j=O.indexOf(I);let z=O[j-1];z&&(z.focus(),(Y=z.scrollIntoViewIfNeeded)==null||Y.call(z))}else{const j=O.find(z=>{const st=z.getBoundingClientRect();return st.top>=44&&st.left>=0});j&&(j.focus(),(X=j.scrollIntoViewIfNeeded)==null||X.call(j))}}),Ct("x",()=>{const I=document.activeElement.closest(".status-link, .status-focus");if(I){const M=I.nextElementSibling;M&&M.tagName.toLowerCase()==="details"&&(M.open=!M.open)}});const{nearReachStart:kt}=re({scrollableRef:x,distanceFromStartPx:16}),pt=P(c?"media+status":"status"),q=ae((I,M,O,Y)=>{I.preventDefault(),I.stopPropagation(),o({media:M+1,mediaStatusID:Y.id})},[e]);return t("div",{tabIndex:"-1",ref:x,class:`status-deck deck contained ${y.length>1?"padded-bottom":""} ${pt.current==="status"?"slide-in":""} ${a?`deck-view-${a}`:""}`,onAnimationEnd:I=>{pt.current==="status"&&(pt.current=null)},children:[t("header",{class:`${D?"inview":""} ${S==="loading"?"loading":""}`,onDblClick:I=>{T.reloadStatusPage++},children:t("div",{class:"header-grid header-grid-2",children:[t("h1",{children:[!!/\/s\//i.test((A=f.prevLocation)==null?void 0:A.pathname)&&t("button",{type:"button",class:"plain deck-back",onClick:()=>{history.back()},children:t(w,{icon:"chevron-left",size:"xl"})}),!D&&E&&S!=="loading"?t($,{children:[t("span",{class:"hero-heading",children:[t(ve,{account:E.account,instance:p,showAvatar:!0,short:!0})," ",t("span",{class:"insignificant",children:["•"," ",t(Se,{datetime:E.createdAt,format:"micro"})]})]})," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),L.current.scrollIntoView({behavior:"smooth",block:"start"})},title:"Go to main post",children:t(w,{icon:nt==="down"?"arrow-down":"arrow-up"})})]}):t($,{children:["Post"," ",t("button",{type:"button",class:"ancestors-indicator light small",onClick:I=>{I.preventDefault(),I.stopPropagation(),x.current.scrollTo({top:0,behavior:"smooth"})},hidden:!at.length||kt,title:`${at.length} posts above ‒ Go to top`,children:[t(w,{icon:"arrow-up"}),at.filter((I,M,O)=>O.findIndex(Y=>Y.accountID===I.accountID)===M).slice(0,3).map(I=>t(Ft,{url:I.account.avatar,alt:I.account.displayName},I.account.id)),at.length>3&&t($,{children:[" ",t("span",{class:"insignificant",children:Rt(at.length)})]})]})]})]}),t("div",{class:"header-side",children:[t(Bt,{align:"end",portal:{target:x.current},menuButton:t("button",{type:"button",class:"button plain4",children:t(w,{icon:"more",alt:"Actions",size:"xl"})}),children:[t(Z,{disabled:S==="loading",onClick:()=>{T.reloadStatusPage++},children:[t(w,{icon:"refresh"}),t("span",{children:"Refresh"})]}),t(Z,{className:"menu-switch-view",onClick:()=>{h(a==="full"?null:"full"),i.delete("media"),i.delete("media-only"),a==="full"?i.delete("view"):i.set("view","full"),o(i)},children:[t(w,{icon:{"":"layout5",full:"layout4"}[a||""]}),t("span",{children:["Switch to ",a==="full"?"Side Peek":"Full"," view"]})]}),t(Z,{onClick:()=>{Array.from(x.current.querySelectorAll("button.spoiler:not(.spoiling)")).forEach(M=>{M.click()})},children:[t(w,{icon:"eye-open"})," ",t("span",{children:"Show all sensitive content"})]}),t(xt,{}),t(Gn,{className:"plain",children:"Experimental"}),t(Z,{disabled:ut,onClick:()=>{const I=vn(E.url);I?location.hash=I:alert("Unable to switch")},children:[t(w,{icon:"transfer"}),t("small",{class:"menu-double-lines",children:["Switch to post's instance (",t("b",{children:W}),")"]})]})]}),t(H,{class:"button plain deck-close",to:n,children:t(w,{icon:"x",size:"xl"})})]})]})}),y.length&&E?t("ul",{class:`timeline flat contextual grow ${S==="loading"?"loading":""}`,children:[y.slice(0,lt).map(I=>{const{id:M,ancestor:O,isThread:Y,descendant:X,thread:j,replies:z,repliesCount:st,weight:Lt}=I,it=M===e;return t("li",{ref:it?L:null,class:`${O?"ancestor":""} ${X?"descendant":""} ${j?"thread":""} ${it?"hero":""}`,children:[it?t($,{children:[t(le,{threshold:.1,onChange:ct,class:"status-focus",tabIndex:0,children:t(gt,{statusID:M,instance:p,withinContext:!0,size:"l",enableTranslate:!0,forceTranslate:d})}),S!=="loading"&&!m?t("div",{class:"post-status-banner",children:[t("p",{children:"You're not logged in. Interactions (reply, boost, etc) are not possible."}),t(H,{to:"/login",class:"button",children:"Log in"})]}):!b&&t("div",{class:"post-status-banner",children:[t("p",{children:["This post is from another instance (",t("b",{children:p}),"). Interactions (reply, boost, etc) are not possible."]}),t("button",{type:"button",disabled:S==="loading",onClick:()=>{v("loading"),(async()=>{try{const ht=await g.v2.search({q:E.url,type:"statuses",resolve:!0,limit:1});if(ht.statuses.length){const It=ht.statuses[0];location.hash=u?`/${u}/s/${It.id}`:`/s/${It.id}`}else throw new Error("No results")}catch(ht){v("default"),alert("Error: "+ht)}})()},children:[t(w,{icon:"transfer"})," Switch to my instance to enable interactions"]})]})]}):t(H,{class:"status-link",to:p?`/${p}/s/${M}`:`/s/${M}`,onClick:()=>{ye(M)},children:[t(gt,{statusID:M,instance:p,withinContext:!0,size:j||O?"m":"s",enableTranslate:!0,onMediaClick:q,onStatusLinkClick:()=>{ye(M)}}),O&&Y&&st>1&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:st,children:Rt(st)})]})," "]}),X&&(z==null?void 0:z.length)>0&&t(kn,{instance:p,replies:z,hasParentThread:j,level:1,accWeight:Lt,openAll:R.current<wi}),S==="loading"&&it&&!!(E!=null&&E.repliesCount)&&!ft&&t("div",{class:"status-loading",children:t(wt,{})}),S==="error"&&it&&!!(E!=null&&E.repliesCount)&&!ft&&t("div",{class:"status-error",children:["Unable to load replies.",t("br",{}),t("button",{type:"button",class:"plain",onClick:()=>{T.reloadStatusPage++},children:"Try again"})]})]},M)}),G>0&&t("li",{children:t("button",{type:"button",class:"plain block show-more",disabled:S==="loading",onClick:()=>tt(I=>I+Qt),style:{marginBlockEnd:"6em"},children:[t("div",{class:"ib",children:y.slice(lt,lt+5).map(I=>t(Ft,{url:I.account.avatarStatic},I.id))})," ",t("div",{class:"ib",children:["Show more…"," ",t("span",{class:"tag",children:G>Qt?`${Qt}+`:G})]})]})})]}):t($,{children:[S==="loading"&&t("ul",{class:"timeline flat contextual grow loading",children:t("li",{children:t(gt,{skeleton:!0,size:"l"})})}),S==="error"&&t("p",{class:"ui-state",children:["Unable to load post",t("br",{}),t("br",{}),t("button",{type:"button",onClick:()=>{T.reloadStatusPage++},children:"Try again"})]})]})]})}function kn({replies:e,instance:n,hasParentThread:r,level:i,accWeight:o,openAll:s}){const[c,a]=Mt(),h=y=>y.reduce((k,S)=>{const{repliesCount:v,replies:L}=S,N=(L==null?void 0:L.length)||v;return k+N+h(L||[])},0),d=e.length+h(e),l=e.length===d,p=e.map(y=>y.account).filter((y,k,S)=>S.findIndex(v=>v.id===y.id)===k).slice(0,3),g=yt(()=>e==null?void 0:e.reduce((y,k)=>y+(k==null?void 0:k.weight),o),[o,e==null?void 0:e.length]);let u=!1;(s||g<=vi||!r&&d===1&&Gt(e[0])<2)&&(u=!0);const m=be[e[0].id],b=ae((y,k,S,v)=>{y.preventDefault(),y.stopPropagation(),a({media:k+1,mediaStatusID:v.id})},[]),f=P();return Nt(()=>{var k;function y(S){S.target.dataset.scrollLeft=S.target.scrollLeft}return(k=f.current)==null||k.addEventListener("scroll",y,{passive:!0}),()=>{var S;(S=f.current)==null||S.removeEventListener("scroll",y)}},[]),t("details",{ref:f,class:"replies",open:m||u,onToggle:y=>{const{open:k}=y.target;be[e[0].id]=k},style:{"--comments-level":i},"data-comments-level":i,"data-comments-level-overflow":i>4,children:[t("summary",{class:"replies-summary",hidden:u,children:[t("span",{class:"avatars",children:p.map(y=>t(Ft,{url:y.avatarStatic,title:`${y.displayName} @${y.username}`,squircle:y==null?void 0:y.bot},y.id))}),t("span",{children:[t("span",{title:e.length,children:Rt(e.length)})," ","repl",e.length===1?"y":"ies"]}),!l&&d>1&&t($,{children:[" ","·"," ",t("span",{children:[t("span",{title:d,children:Rt(d)})," ","comment",d===1?"":"s"]})]})]}),t("ul",{children:e.map(y=>{var k,S;return t("li",{children:[t(H,{class:"status-link",to:n?`/${n}/s/${y.id}`:`/s/${y.id}`,onClick:()=>{ye(y.id)},children:[t(gt,{statusID:y.id,instance:n,withinContext:!0,size:"s",enableTranslate:!0,onMediaClick:b}),!((k=y.replies)!=null&&k.length)&&y.repliesCount>0&&t("div",{class:"replies-link",children:[t(w,{icon:"comment"})," ",t("span",{title:y.repliesCount,children:Rt(y.repliesCount)})]})]}),((S=y.replies)==null?void 0:S.length)&&t(kn,{instance:n,replies:y.replies,level:i+1,accWeight:u?g:y.weight,openAll:s})]},y.id)})})]})}const Ii=140,Ti=35,Ci=70,xi=140,we=new Map;function Gt(e){var u,m;const n=we.get(e.id);if(n)return n;const{spoilerText:r,content:i,mediaAttachments:o,poll:s,card:c}=e,a=Nn(r+i),h=o!=null&&o.length?Ii:0,d=(((u=s==null?void 0:s.options)==null?void 0:u.length)||0)*Ti,l=c&&(o!=null&&o.length||(m=s==null?void 0:s.options)!=null&&m.length)?0:Ci,g=(a+h+d+l)/xi;return we.set(e.id,g),g}const $i=Ie(Si);function Li(){const e=Ot(),{id:n,instance:r}=e;return t($i,{id:n,instance:r})}const Ri=""+new URL("boosts-carousel-c271525c.jpg",import.meta.url).href,Ai=""+new URL("grouped-notifications-3dcc5ef2.jpg",import.meta.url).href,Mi=""+new URL("multi-column-962e6b3c.jpg",import.meta.url).href,Di=""+new URL("multi-hashtag-timeline-24789e5e.jpg",import.meta.url).href,Ei=""+new URL("nested-comments-thread-38ddecea.jpg",import.meta.url).href,Ni=""+new URL("logo-text-810e685b.svg",import.meta.url).href;function Pi(){return St(null,["/","/welcome"]),t("main",{id:"welcome",children:[t("div",{class:"hero-container",children:[t("h1",{children:[t("img",{src:Sn,alt:"",width:"200",height:"200",style:{aspectRatio:"1/1",marginBlockEnd:-16}}),t("img",{src:Ni,alt:"Phanpy",width:"250"})]}),t("p",{children:t("big",{children:t("b",{children:t(H,{to:"/login",class:"button",children:"Log in"})})})}),t("p",{class:"desc",children:"A minimalistic opinionated Mastodon web client."})]}),t("div",{id:"why-container",children:t("div",{class:"sections",children:[t("section",{children:[t("img",{src:Ri,alt:"Screenshot of Boosts Carousel",loading:"lazy"}),t("h4",{children:"Boosts Carousel"}),t("p",{children:"Visually separate original posts and re-shared posts (boosted posts)."})]}),t("section",{children:[t("img",{src:Ei,alt:"Screenshot of nested comments thread",loading:"lazy"}),t("h4",{children:"Nested comments thread"}),t("p",{children:"Effortlessly follow conversations. Semi-collapsible replies."})]}),t("section",{children:[t("img",{src:Ai,alt:"Screenshot of grouped notifications",loading:"lazy"}),t("h4",{children:"Grouped notifications"}),t("p",{children:"Similar notifications are grouped and collapsed to reduce clutter."})]}),t("section",{children:[t("img",{src:Mi,alt:"Screenshot of multi-column UI",loading:"lazy"}),t("h4",{children:"Single or multi-column"}),t("p",{children:"By default, single column for zen-mode seekers. Configurable multi-column for power users."})]}),t("section",{children:[t("img",{src:Di,alt:"Screenshot of multi-hashtag timeline with a form to add more hashtags",loading:"lazy"}),t("h4",{children:"Multi-hashtag timeline"}),t("p",{children:"Up to 5 hashtags combined into a single timeline."})]})]})}),t("hr",{}),t("p",{children:[t("a",{href:"https://github.com/cheeaun/phanpy",target:"_blank",children:"Built"})," ","by"," ",t("a",{href:"https://mastodon.social/@cheeaun",target:"_blank",onClick:e=>{e.preventDefault(),T.showAccount="cheeaun@mastodon.social"},children:"@cheeaun"}),"."," ",t("a",{href:"https://github.com/cheeaun/phanpy/blob/main/PRIVACY.MD",target:"_blank",children:"Privacy Policy"}),"."]})]})}const Ui=window.alert;window.__nativeAlert||(window.__nativeAlert=Ui);window.alert=function(e){e instanceof Error&&(e!=null&&e.message)&&(e=e.message),typeof e!="string"&&(e=JSON.stringify(e));const n=Jn({text:e,className:"alert",gravity:"top",position:"center",duration:1e4,offset:{y:48},onClick:()=>{n.hideToast()}});n.showToast()};window.__STATES__=T;setTimeout(()=>{var e,n,r,i;for(const o in Xt)Array.isArray(Xt[o])?(n=(e=Xt[o])[0])==null||n.call(e):(i=(r=Xt)[o])==null||i.call(r)},5e3);function _i(){var u,m,b,f,y,k,S;const e=dt(T),[n,r]=C(!1),[i,o]=C("loading"),s=tn();Nt(()=>{const v=J.local.get("theme");v&&(document.documentElement.classList.add(`is-${v}`),document.querySelector('meta[name="color-scheme"]').setAttribute("content",v==="auto"?"dark light":v));const L=J.local.get("textSize");L&&document.documentElement.style.setProperty("--text-size",`${L}px`)},[]),_(()=>{const v=J.local.get("instanceURL"),L=decodeURIComponent((window.location.search.match(/code=([^&]+)/)||[,""])[1]);if(L){window.history.replaceState({},document.title,c.pathname||"/");const N=J.session.get("clientID"),R=J.session.get("clientSecret"),x=J.session.get("vapidKey");(async()=>{o("loading");const{access_token:K}=await pi({instanceURL:v,client_id:N,client_secret:R,code:L}),F=Pn({instance:v,accessToken:K});await Promise.allSettled([De(F,v),Un(F,v,K,x)]),_n(),Ee(F),r(!0),o("default")})()}else{const N=Vt();if(N){J.session.set("currentAccount",N.info.id);const{masto:R,instance:x}=B({account:N});Ee(R),o("loading"),(async()=>{try{await De(R,x)}catch{}finally{r(!0),o("default")}})()}else o("default")}},[]);let c=on();T.currentLocation=c.pathname;const a=()=>{let v=setTimeout(()=>{if(!document.getElementById("columns")){if(document.querySelector(".deck-backdrop"))return;const R=document.querySelectorAll(".deck-container"),x=R[R.length-1];x&&x.tabIndex===-1&&x.focus()}},100);return()=>clearTimeout(v)};_(a,[c]);const h=e.showCompose||e.showSettings||e.showAccounts||e.showAccount||e.showDrafts||e.showMediaModal||e.showShortcutsSettings;_(()=>{h||a()},[h]);const{prevLocation:d}=e,l=P(d||null);if(se("/:instance/s/:id",c.pathname)||se("/s/:id",c.pathname)?l.current||(l.current=d):l.current=null,/\/https?:/.test(c.pathname))return t(ai,{});const g=yt(()=>{const{pathname:v}=c;return!/^\/(login|welcome)/.test(v)},[c]);return _(()=>{const v=document.getElementById("app");v&&(v.dataset.shortcutsViewMode=e.settings.shortcutsViewMode)},[e.settings.shortcutsViewMode]),_(()=>{document.body.classList.toggle("cloak",e.settings.cloakMode)},[e.settings.cloakMode]),t($,{children:[t(he,{location:g||c,children:[t(rt,{path:"/",element:n?t(ii,{}):i==="loading"?t(wt,{id:"loader-root"}):c.pathname==="/"&&t(ee,{local:!0,instance:"stargate.pbcarrara.com.br"})}),t(rt,{path:"/login",element:t(mi,{})}),t(rt,{path:"/welcome",element:t(Pi,{})})]}),t(he,{location:l.current||c,children:[n&&t(rt,{path:"/notifications",element:t(yn,{})}),n&&t(rt,{path:"/mentions",element:t(pn,{})}),n&&t(rt,{path:"/following",element:t(xe,{})}),n&&t(rt,{path:"/b",element:t(dn,{})}),n&&t(rt,{path:"/f",element:t(un,{})}),n&&t(rt,{path:"/l",children:[t(rt,{index:!0,element:t(li,{})}),t(rt,{path:":id",element:t(fn,{})})]}),n&&t(rt,{path:"/ft",element:t(Ms,{})}),t(rt,{path:"/:instance?/t/:hashtag",element:t(hn,{})}),t(rt,{path:"/:instance?/a/:id",element:t(xs,{})}),t(rt,{path:"/:instance?/p",children:[t(rt,{index:!0,element:t(ee,{})}),t(rt,{path:"l",element:t(ee,{local:!0})})]}),t(rt,{path:"/:instance?/trending",element:t(wn,{})}),t(rt,{path:"/:instance?/search",element:t(gi,{})})]}),i==="default"&&t(he,{children:t(rt,{path:"/:instance?/s/:id",element:t(Li,{})})}),n&&t(cs,{}),n&&!e.settings.shortcutsColumnsMode&&e.settings.shortcutsViewMode!=="multi-column"&&t(ws,{}),!!e.showCompose&&t(bt,{children:t(zn,{replyToStatus:typeof e.showCompose!="boolean"?e.showCompose.replyToStatus:((u=window.__COMPOSE__)==null?void 0:u.replyToStatus)||null,editStatus:((m=T.showCompose)==null?void 0:m.editStatus)||((b=window.__COMPOSE__)==null?void 0:b.editStatus)||null,draftStatus:((f=T.showCompose)==null?void 0:f.draftStatus)||((y=window.__COMPOSE__)==null?void 0:y.draftStatus)||null,onClose:v=>{const{newStatus:L,instance:N}=v||{};T.showCompose=!1,window.__COMPOSE__=null,L&&(T.reloadStatusPage++,ot({text:"Post published. Check it out.",delay:1e3,duration:1e4,onClick:R=>{R.hideToast(),T.prevLocation=c,s(N?`/${N}/s/${L.id}`:`/s/${L.id}`)}}))}})}),!!e.showSettings&&t(bt,{onClick:v=>{v.target===v.currentTarget&&(T.showSettings=!1)},children:t(bi,{onClose:()=>{T.showSettings=!1}})}),!!e.showAccounts&&t(bt,{onClick:v=>{v.target===v.currentTarget&&(T.showAccounts=!1)},children:t($s,{onClose:()=>{T.showAccounts=!1}})}),!!e.showAccount&&t(bt,{class:"light",onClick:v=>{v.target===v.currentTarget&&(T.showAccount=!1)},children:t(is,{account:((k=e.showAccount)==null?void 0:k.account)||e.showAccount,instance:(S=e.showAccount)==null?void 0:S.instance,onClose:({destination:v}={})=>{T.showAccount=!1,v&&(T.showAccounts=!1)}})}),!!e.showDrafts&&t(bt,{onClick:v=>{v.target===v.currentTarget&&(T.showDrafts=!1)},children:t(as,{onClose:()=>T.showDrafts=!1})}),!!e.showMediaModal&&t(bt,{onClick:v=>{(v.target===v.currentTarget||v.target.classList.contains("media"))&&(T.showMediaModal=!1)},children:t(an,{mediaAttachments:e.showMediaModal.mediaAttachments,instance:e.showMediaModal.instance,index:e.showMediaModal.index,statusID:e.showMediaModal.statusID,onClose:()=>{T.showMediaModal=!1}})}),!!e.showShortcutsSettings&&t(bt,{class:"light",onClick:v=>{v.target===v.currentTarget&&(T.showShortcutsSettings=!1)},children:t(gs,{onClose:()=>T.showShortcutsSettings=!1})}),t(ds,{}),t(os,{isLoggedIn:n}),t(us,{onClose:a})]})}Yn(t(Xn,{children:t(_i,{})}),document.getElementById("app"));setTimeout(()=>{try{Object.keys(localStorage).forEach(e=>{e.startsWith("iconify")&&localStorage.removeItem(e)}),Object.keys(sessionStorage).forEach(e=>{e.startsWith("iconify")&&sessionStorage.removeItem(e)}),localStorage.removeItem("settings:boostsCarousel")}catch{}},5e3);window.__CLOAK__=()=>{document.body.classList.toggle("cloak")};
//# sourceMappingURL=main-b037d744.js.map
